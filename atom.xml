<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LLIEI0X</title>
  
  <subtitle>â˜” slow to respond |ğŸŒµ Live long and prosper</subtitle>
  <link href="https://liei.cc/atom.xml" rel="self"/>
  
  <link href="https://liei.cc/"/>
  <updated>2020-08-01T15:15:15.000Z</updated>
  <id>https://liei.cc/</id>
  
  <author>
    <name>lliei0x</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>OpenLDAP å¿«é€Ÿè½åœ°å®è·µ-è¿›é˜¶</title>
    <link href="https://liei.cc/2020/openldap-high-ranking.html"/>
    <id>https://liei.cc/2020/openldap-high-ranking.html</id>
    <published>2020-08-01T15:15:15.000Z</published>
    <updated>2020-08-01T15:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¤‡ä»½ä¸æ¢å¤"><a href="#å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="å¤‡ä»½ä¸æ¢å¤"></a>å¤‡ä»½ä¸æ¢å¤</h2><blockquote><p>ä¸»è¦ä»‹ç»å¦‚ä½•å¤‡ä»½ OpenLDAP çš„é…ç½®ç›®å½•å’Œæ•°æ®ç›®å½•ï¼Œå¹¶å°†å…¶æ¢å¤åˆ°å¦ä¸€ä¸ª OpenLDAP æœåŠ¡ä¸­</p></blockquote><h3 id="OpenLDAP-çš„å¤‡ä»½"><a href="#OpenLDAP-çš„å¤‡ä»½" class="headerlink" title="OpenLDAP çš„å¤‡ä»½"></a>OpenLDAP çš„å¤‡ä»½</h3><p>OpenLDAP çš„å¤‡ä»½å¯ä»¥é€šè¿‡æœåŠ¡ç«¯çš„ <code>slapcat</code> å‘½ä»¤æˆ–å®¢æˆ·ç«¯çš„ <code>ldapsearch</code> å‘½ä»¤ä¸¤ç§æ–¹å¼è¿›è¡Œã€‚ä¸‹é¢å±•ç¤ºäº†å¦‚ä½•åœ¨ OpenLDAP æœåŠ¡ç«¯ä½¿ç”¨ <code>slapcat</code> å¯¹é…ç½®ç›®å½•å’Œæ•°æ®ç›®å½•è¿›è¡Œå¯¼å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ slapcat -n 0 -l ./config.`date &#x27;+%Y-%m-%d&#x27;`.ldif</span><br><span class="line">$ slapcat -n 2 -l ./data.`date &#x27;+%Y-%m-%d&#x27;`.ldif</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>-n</code> è¡¨ç¤ºè¦å¯¼å‡ºçš„ OpenLDAP æ•°æ®åº“ç¼–å·</p><h3 id="OpenLDAP-çš„æ¢å¤"><a href="#OpenLDAP-çš„æ¢å¤" class="headerlink" title="OpenLDAP çš„æ¢å¤"></a>OpenLDAP çš„æ¢å¤</h3><div class="tag-plugin timeline"><div class="timenode" index="0"><div class="header"><p>åœ¨å¼€å§‹æ¢å¤ä¹‹å‰ï¼Œéœ€è¦å…ˆæš‚åœ OpenLDAP æœåŠ¡</p></div><div class="body fs14"><p>$ systemctl stop slapd</p></div></div><div class="timenode" index="1"><div class="header"><p>OpenLDAP é…ç½®ç›®å½•ä¸€èˆ¬ä½äº <code>/etc/openldap/slapd.d</code>ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†åŸæœ‰é…ç½®åˆ é™¤ï¼Œç„¶åä½¿ç”¨ <code>slapadd</code> å¯¼å…¥æ–°çš„é…ç½®</p></div><div class="body fs14"><p>$ rm -rf &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;*<br>$ slapadd -n 0 -F &#x2F;etc&#x2F;openldap&#x2F;slapd.d -l .&#x2F;config.2019-01-04.ldif<br>$ chown -R ldap:ldap &#x2F;etc&#x2F;openldap&#x2F;slapd.d</p></div></div><div class="timenode" index="2"><div class="header"><p>2020-04-20 OpenLDAP æ•°æ®ç›®å½•ä¸€èˆ¬ä½äº <code>/var/lib/ldap</code>ï¼ŒåŒæ ·çš„æˆ‘ä»¬éœ€è¦å…ˆå°†åŸæœ‰æ•°æ®åˆ é™¤ï¼Œç„¶åä½¿ç”¨ <code>slapadd</code> å¯¼å…¥æ–°çš„æ•°æ®</p></div><div class="body fs14"><p>$ rm -rf &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;*<br>$ slapadd -n 2 -F &#x2F;etc&#x2F;openldap&#x2F;slapd.d -l .&#x2F;data.2019-01-04.ldif<br>$ chown -R ldap:ldap &#x2F;var&#x2F;lib&#x2F;ldap</p></div></div><div class="timenode" index="3"><div class="header"><p>æœ€åï¼Œé‡å¯ OpenLDAP æœåŠ¡å³å¯</p></div><div class="body fs14"><p>$ systemctl start slapd</p></div></div></div><h2 id="æ·»åŠ -memberof-æ”¯æŒ"><a href="#æ·»åŠ -memberof-æ”¯æŒ" class="headerlink" title="æ·»åŠ  memberof æ”¯æŒ"></a>æ·»åŠ  memberof æ”¯æŒ</h2><blockquote><p>å¦‚æœä½¿ç”¨ LDAP ä»…ä»…ä½œä¸ºç”¨æˆ·ç»Ÿä¸€ç™»å½•ä¸­å¿ƒï¼Œåˆ™å‚è€ƒå®‰è£…æ–‡æ¡£å³å¯ï¼›å¦‚æœ ldap è¦ä¸ç¬¬ä¸‰æ–¹è½¯ä»¶ç»“åˆï¼Œä¾‹å¦‚ confluenceã€gitlab ç­‰ç»“åˆï¼Œåˆ™éœ€è¦å¼€å¯ memberof æ”¯æŒ</p></blockquote><ol><li>å¼€å¯ memberof æ”¯æŒã€‚</li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">vim</span> <span class="number">1</span><span class="string">-load-memberof.ldif</span></span><br><span class="line"></span><br><span class="line"><span class="string">å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="attr">dn:</span> <span class="string">cn=module,cn=config</span></span><br><span class="line"><span class="attr">objectClass:</span> <span class="string">olcModuleList</span></span><br><span class="line"><span class="attr">cn:</span> <span class="string">module</span> </span><br><span class="line"><span class="attr">olcModuleLoad:</span> <span class="string">memberof.la</span></span><br><span class="line"><span class="attr">olcModulepath:</span> <span class="string">/usr/lib64/openldap</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ldapåº“è·¯å¾„ä¸æ“ä½œç³»ç»Ÿç‰ˆæœ¬æ˜¯ç›¸å…³çš„ï¼Œæ­¤å¤„æ˜¯64ä½æ“ä½œç³»ç»Ÿã€‚</span></span><br></pre></td></tr></table></figure><ol start="2"><li>æ–°å¢ç”¨æˆ·æ”¯æŒ memberof é…ç½®ã€‚</li></ol><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">vim</span> <span class="number">2</span><span class="string">-use-memberof.ldif</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dn:</span> <span class="string">olcOverlay=memberof,olcDatabase=&#123;2&#125;hdb,cn=config</span></span><br><span class="line"><span class="attr">objectClass:</span> <span class="string">olcConfig</span></span><br><span class="line"><span class="attr">objectClass:</span> <span class="string">olcMemberOf</span></span><br><span class="line"><span class="attr">objectClass:</span> <span class="string">olcOverlayConfig</span></span><br><span class="line"><span class="attr">objectClass:</span> <span class="string">top</span></span><br><span class="line"><span class="attr">olcOverlay:</span> <span class="string">memberof</span></span><br></pre></td></tr></table></figure><ol start="3"><li>å¯¼å…¥ç›¸å…³é…ç½®ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f 1-chrootpw.ldif</span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f 2-chdomain.ldif</span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f 3-load-memberof.ldif</span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -f 4-use-memberof.ldif</span><br></pre></td></tr></table></figure><ol start="4"><li>æŸ¥çœ‹å½“å‰ dn ä¸‹åŒ…å« cn&#x3D;config é…ç½®åˆ—è¡¨ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ldapsearch -Q -LLL -Y EXTERNAL -H ldapi:/// -b cn=config dn</span><br></pre></td></tr></table></figure><ol start="5"><li>æŸ¥çœ‹ç”¨æˆ·çš„ memberof ä¿¡æ¯ã€‚</li></ol><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ldapsearch -LL -Y EXTERNAL -H ldapi:/// <span class="string">&quot;(uid=xxxxxx)&quot;</span> -b dc=xxx,dc=com dn memberof</span><br></pre></td></tr></table></figure><h2 id="å¼€å¯æ—¥å¿—"><a href="#å¼€å¯æ—¥å¿—" class="headerlink" title="å¼€å¯æ—¥å¿—"></a>å¼€å¯æ—¥å¿—</h2><div class="tag-plugin timeline"><div class="timenode" index="0"><div class="header"><p>æŸ¥çœ‹ç°åœ¨çš„æ—¥å¿—é…ç½®</p></div><div class="body fs14"><p>[root@slave3] ~$ cat &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;cn=config.ldif |grep olcLogLevel<br>state</p></div></div><div class="timenode" index="1"><div class="header"><p>å¿…é¡»å…ˆåˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶è°ƒæ•´æƒé™ï¼Œå†ä¿®æ”¹ rsyslog.conf</p></div><div class="body fs14"><p>mkdir -p &#x2F;var&#x2F;log&#x2F;slapd</p><p>touch &#x2F;var&#x2F;log&#x2F;slapd&#x2F;slapd.log</p><p>chown ldap:ldap &#x2F;var&#x2F;log&#x2F;slapd&#x2F;</p><p>echo â€œlocal4.* &#x2F;var&#x2F;log&#x2F;slapd&#x2F;slapd.logâ€ &gt;&gt; &#x2F;etc&#x2F;rsyslog.conf</p></div></div><div class="timenode" index="2"><div class="header"><p>é‡å¯ä½¿å…¶ç”Ÿæ•ˆ</p></div><div class="body fs14"><p><code>systemctl restart rsyslog</code></p></div></div><div class="timenode" index="3"><div class="header"><p>ä¿®æ”¹æ•°æ•°æ®åº“é…ç½®æ–‡ä»¶</p></div><div class="body fs14"><p>[root@test1] ~$ cat log.ldif<br>dn: cn&#x3D;config<br>changetype: modify<br>add: olcLogLevel<br>olcLogLevel: 32</p><p>[root@test1] ~$ ldapmodify -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f log.ldif</p></div></div><div class="timenode" index="4"><div class="header"><p>æœ€å¥½è¿›è¡Œæ—¥å¿—åˆ‡å‰²é…ç½®ï¼Œé˜²æ­¢æ–‡ä»¶è¿‡å¤§ï¼Œä¸ä¾¿æ’æŸ¥æ•…éšœ</p></div><div class="body fs14"><p><code>vi /etc/logrotate.d/ldap</code></p><p>&#x2F;var&#x2F;log&#x2F;slapd&#x2F;slapd.log{<br>    daily          # æ¯å¤©è½®è¯¢ä¸€æ¬¡<br>    rotate  5      # ä¿å­˜5ä¸ªå†å²æ—¥å¿—æ–‡ä»¶ï¼Œè¶…è¿‡çš„åˆ é™¤<br>    size 100M<br>    copytruncate   # å¤åˆ¶æºæ—¥å¿—å†…å®¹åï¼Œæ¸…ç©ºæ–‡ä»¶ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°æ–‡ä»¶<br>    dateext        # åˆ‡å‰²æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶åå¸¦æœ‰æ—¥æœŸ<br>    missingok      # å¦‚æœæŒ‡å®šçš„ç›®å½•ä¸å­˜åœ¨ï¼Œä¼šæŠ¥é”™ï¼Œæ­¤é€‰é¡¹ç”¨æ¥æŠ‘åˆ¶æŠ¥é”™<br>}</p></div></div></div><div class="tag-plugin note" color="orange"><div class="body"><p>å¦‚æœä½ æ˜¯ä½¿ç”¨æ—§ç‰ˆä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œå¦‚ä¸‹å¯ç”¨æ—¥å¿—åŠŸèƒ½</p></div></div><div class="tag-plugin timeline"><div class="timenode" index="0"><div class="header"><p>ä¿®æ”¹ <code>slapd.conf</code></p></div><div class="body fs14"><p>[root@backup2] &#x2F;etc&#x2F;openldap$ vim slapd.conf</p><p>#æœ«å°¾æ·»åŠ ä¸€è¡Œ<br>loglevel        -1</p></div></div><div class="timenode" index="1"><div class="header"><p>ä¿®æ”¹ rsyslog.confï¼Œå¹¶é‡å¯</p></div><div class="body fs14"><p>[root@backup2] &#x2F;etc&#x2F;openldap$ vim &#x2F;etc&#x2F;rsyslog.conf</p><p>#æœ«å°¾æ·»åŠ å¦‚ä¸‹ä¸€è¡Œï¼š<br>local4.*         &#x2F;var&#x2F;log&#x2F;slapd.log</p><p>[root@backup2] &#x2F;etc&#x2F;openldap$ systemctl restart rsyslog</p></div></div><div class="timenode" index="2"><div class="header"><p>ç”Ÿæˆé…ç½®</p></div><div class="body fs14"><p>[root@backup2] &#x2F;etc&#x2F;openldap$ rm -rf &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;*<br>[root@backup2] &#x2F;etc&#x2F;openldap$ slaptest -f &#x2F;etc&#x2F;openldap&#x2F;slapd.conf -F &#x2F;etc&#x2F;openldap&#x2F;slapd.d&#x2F;<br>[root@backup2] &#x2F;etc&#x2F;openldap$ systemctl start slapd.service<br>123</p></div></div></div><div class="tag-plugin note" color="green"><div class="title"><strong>æ¥æŸ¥çœ‹æ—¥å¿—</strong></div><div class="body"><p>é€šè¿‡ <code>tailf /var/log/slapd.log</code> æ¥æŸ¥çœ‹æ—¥å¿—</p></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å¤‡ä»½ä¸æ¢å¤&quot;&gt;&lt;a href=&quot;#å¤‡ä»½ä¸æ¢å¤&quot; class=&quot;headerlink&quot; title=&quot;å¤‡ä»½ä¸æ¢å¤&quot;&gt;&lt;/a&gt;å¤‡ä»½ä¸æ¢å¤&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸»è¦ä»‹ç»å¦‚ä½•å¤‡ä»½ OpenLDAP çš„é…ç½®ç›®å½•å’Œæ•°æ®ç›®å½•ï¼Œå¹¶å°†å…¶æ¢å¤åˆ°å¦ä¸€ä¸ª OpenLD</summary>
      
    
    
    
    <category term="æŠ˜è…¾ä¸æ­¢" scheme="https://liei.cc/blog/categories/%E6%8A%98%E8%85%BE%E4%B8%8D%E6%AD%A2/"/>
    
    
    <category term="OpenLDAP" scheme="https://liei.cc/blog/tags/openldap/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes æ§åˆ¶å™¨çš„è¿›åŒ–ä¹‹æ—…</title>
    <link href="https://liei.cc/2020/kubernetes-operator.html"/>
    <id>https://liei.cc/2020/kubernetes-operator.html</id>
    <published>2020-07-25T15:15:15.000Z</published>
    <updated>2020-07-25T15:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æˆ‘æ˜¯ä¸€å † Kubernetes æ§åˆ¶å™¨ã€‚</p><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆæ˜¯ä¸€å †ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯ä¸€ä¸ªäººï¼Œæˆ‘åªæ˜¯ä¼—å¤šæ§åˆ¶å™¨ä¸­çš„ä¸€å‘˜ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠæˆ‘çœ‹æˆæ˜¯ä¼—å¤šæ§åˆ¶å™¨çš„é›†åˆã€‚æˆ‘çš„èŒè´£å°±æ˜¯ç›‘æ§é›†ç¾¤å†…èµ„æºçš„å®é™…çŠ¶æ€ï¼Œä¸€æ—¦å‘ç°å…¶ä¸æœŸæœ›çš„çŠ¶æ€ä¸ç›¸ç¬¦ï¼Œå°±é‡‡å–è¡ŒåŠ¨ä½¿å…¶ç¬¦åˆæœŸæœ›çŠ¶æ€ã€‚</p><p>æƒ³å½“åˆï¼ŒKubernetes è€å¤§å“¥åˆ›é€ æˆ‘æ—¶ï¼Œåªæ˜¯æ‰“ç®—è®©æˆ‘ç”¨<strong>æ§åˆ¶å¾ªç¯</strong>ç®€å•ç»´æŠ¤ä¸‹èµ„æºçš„çŠ¶æ€ã€‚ä½†æˆ‘åæ¥çš„å‘å±•ï¼Œè¿œè¿œè¶…å‡ºäº†ä»–çš„æƒ³è±¡ã€‚</p></blockquote><span id="more"></span><h2 id="1-æ§åˆ¶å¾ªç¯"><a href="#1-æ§åˆ¶å¾ªç¯" class="headerlink" title="1. æ§åˆ¶å¾ªç¯"></a>1. æ§åˆ¶å¾ªç¯</h2><p>æ‰€è°“æ§åˆ¶å¾ªç¯å°±æ˜¯ä¸€ä¸ªç”¨æ¥è°ƒèŠ‚ç³»ç»ŸçŠ¶æ€çš„å‘¨æœŸæ€§æ“ä½œï¼Œåœ¨ Kubernetes ä¸­ä¹Ÿå«<strong>è°ƒè°å¾ªç¯</strong>ï¼ˆReconcile Loopï¼‰ã€‚æˆ‘çš„æ‰‹ä¸‹æ§åˆ¶ç€å¾ˆå¤šç§ä¸åŒç±»å‹çš„èµ„æºï¼Œæ¯”å¦‚ Podï¼ŒDeploymentï¼ŒService ç­‰ç­‰ã€‚å°±æ‹¿ <code>Deployment</code> æ¥è¯´å§ï¼Œæˆ‘çš„æ§åˆ¶å¾ªç¯ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li>ä» <code>API Server</code> ä¸­è·å–åˆ°æ‰€æœ‰å±äºè¯¥ Deployment çš„ Podï¼Œç„¶åç»Ÿè®¡ä¸€ä¸‹å®ƒä»¬çš„æ•°é‡ï¼Œå³å®ƒä»¬çš„å®é™…çŠ¶æ€ã€‚</li><li>æ£€æŸ¥ Deployment çš„ <code>Replicas</code> å­—æ®µï¼Œçœ‹çœ‹æœŸæœ›çŠ¶æ€æ˜¯å¤šå°‘ä¸ª Podã€‚</li><li>å°†è¿™ä¸¤ä¸ªçŠ¶æ€åšæ¯”è¾ƒï¼Œå¦‚æœæœŸæœ›çŠ¶æ€çš„ Pod æ•°é‡æ¯”å®é™…çŠ¶æ€å¤šï¼Œå°±åˆ›å»ºæ–° Podï¼Œå¤šå‡ ä¸ªå°±åˆ›å»ºå‡ ä¸ªæ–°çš„ï¼›å¦‚æœæœŸæœ›çŠ¶æ€çš„ Pod æ•°é‡æ¯”å®é™…çŠ¶æ€å°‘ï¼Œå°±åˆ é™¤æ—§ Podï¼Œå°‘å‡ ä¸ªå°±åˆ é™¤å‡ ä¸ªæ—§çš„ã€‚</li></ol><p>ç„¶è€Œå¥½æ™¯ä¸é•¿ï¼Œæˆ‘æ”¶åˆ°äº† Kubernetes æŒé—¨äººï¼ˆçœ‹å¤§é—¨çš„ï¼‰ <code>API Server</code> çš„æŠ±æ€¨ï¼šâ€œä½ è®¿é—®æˆ‘çš„æ¬¡æ•°å¤ªé¢‘ç¹äº†ï¼Œéå¸¸æ¶ˆè€—æˆ‘çš„èµ„æºï¼Œæˆ‘è¿ä¸Šå•æ‰€çš„æ—¶é—´éƒ½æ²¡æœ‰äº†ï¼â€</p><p>æˆ‘ä»”ç»†ä¸€æƒ³ï¼Œå½“å‰çš„æ§åˆ¶å¾ªç¯æ¨¡å¼ç¡®å®æœ‰è¿™ä¸ªç¼ºé™· â€”â€” è®¿é—® <code>API Server</code> çš„æ¬¡æ•°å¤ªé¢‘ç¹äº†ï¼Œå®¹æ˜“è¢«è€å¤§åæ„Ÿã€‚</p><p>æ‰€ä»¥æˆ‘å†³å®šï¼Œæ‰¾ä¸€ä¸ªå°å¼Ÿã€‚</p><h2 id="2-Informer"><a href="#2-Informer" class="headerlink" title="2. Informer"></a>2. Informer</h2><p>è¿™æ¬¡æˆ‘æ‹›çš„å°å¼Ÿå« <code>Informer</code>ï¼Œå®ƒåˆ†æ‹…ä¸€éƒ¨åˆ†æˆ‘çš„ä»»åŠ¡ï¼Œå…·ä½“çš„åšæ³•æ˜¯è¿™æ ·çš„ï¼šç”± <code>Informer</code> ä»£æ›¿æˆ‘å»è®¿é—® API Serverï¼Œè€Œæˆ‘ä¸ç®¡æ˜¯æŸ¥çŠ¶æ€è¿˜æ˜¯å¯¹èµ„æºè¿›è¡Œä¼¸ç¼©éƒ½å’Œ Informer è¿›è¡Œäº¤æ¥ã€‚è€Œä¸” Informer ä¸éœ€è¦æ¯æ¬¡éƒ½å»è®¿é—® API Serverï¼Œå®ƒåªè¦åœ¨åˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡ <code>LIST API</code> è·å–æ‰€æœ‰èµ„æºçš„æœ€æ–°çŠ¶æ€ï¼Œç„¶åå†é€šè¿‡ <code>WATCH API</code> å»ç›‘å¬è¿™äº›èµ„æºçŠ¶æ€çš„å˜åŒ–ï¼Œæ•´ä¸ªè¿‡ç¨‹è¢«ç§°ä½œ <code>ListAndWatch</code>ã€‚</p><p>è€Œ Informer ä¹Ÿä¸å‚»ï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ªåŠ©æ‰‹å« <code>Reflector</code>ï¼Œä¸Šé¢æ‰€è¯´çš„ <code>ListAndWatch</code> äº‹å®ä¸Šæ˜¯ç”± Reflector ä¸€æ‰‹æ“åŠçš„ã€‚</p><p>è¿™ä¸€æ¬¡ï¼Œ<code>API Server</code> çš„å‹åŠ›å¤§å¤§å‡è½»äº†ï¼Œå› ä¸º Reflector å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ <code>WATCH</code>ï¼Œå¹¶æ²¡æœ‰é€šè¿‡ LIST è·å–æ‰€æœ‰çŠ¶æ€ï¼Œè¿™ä½¿ <code>API Server</code> çš„å‹åŠ›å¤§å¤§å‡å°‘ã€‚æˆ‘æƒ³è¿™æ¬¡æŒé—¨äººåº”è¯¥ä¸ä¼šå†æ‰¹è¯„æˆ‘äº†å§ã€‚</p><p>ç„¶è€Œæ²¡è¿‡å‡ å¤©ï¼ŒæŒé—¨äººåˆæ‰¾æˆ‘è°ˆè¯äº†ï¼šâ€œä½ çš„æ‰‹ä¸‹æ¯æ¬¡æ¥ WATCH æˆ‘ï¼Œéƒ½è¦ WATCH æ‰€æœ‰å…„å¼Ÿçš„çŠ¶æ€ï¼Œä¾ç„¶å¾ˆæ¶ˆè€—æˆ‘çš„èµ„æºå•Šï¼æˆ‘å°±çº³é—·äº†ï¼Œä½ ä¸€æ¬¡æè¿™ä¹ˆå¤šå…„å¼Ÿï¼Œä½ è™å•Šï¼Ÿâ€</p><p>æˆ‘ä¸€æƒ³æœ‰é“ç†å•Šï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½ WATCH æ‰€æœ‰å…„å¼Ÿçš„çŠ¶æ€ï¼Œäºæ˜¯å‘Šè¯‰ Informerï¼šâ€œä»¥åå†å» API Server é‚£é‡Œ WATCH çŠ¶æ€çš„æ—¶å€™ï¼ŒåªæŸ¥ WATCH ç‰¹å®šèµ„æºçš„çŠ¶æ€ï¼Œä¸è¦ä¸€è‚¡è„‘å„¿å…¨ WATCHã€‚â€œ</p><p>Informer å†æŠŠè¿™ä¸ªå†³ç­–å‘Šè¯‰ Reflectorï¼Œäº‹æƒ…å°±è¿™ä¹ˆæ„‰å¿«åœ°å†³å®šäº†ã€‚</p><p>æœ¬ä»¥ä¸ºè¿™æ¬¡æˆ‘ä¼šå¾—åˆ°æŒé—¨äººçš„å¤¸å¥–ï¼Œå¯æ²¡è¿‡å‡ å¤©å®‰ç¨³æ—¥å­ï¼Œå®ƒåˆæ¥æ‰¾æˆ‘è¯‰è‹¦äº†ï¼šâ€œå…„å¼Ÿï¼Œè™½ç„¶ä½ å‡è½»äº†æˆ‘çš„ç²¾ç¥å‹åŠ›ï¼Œä½†æˆ‘çš„è´¢åŠ›æœ‰é™å•Šï¼Œå¦‚æœæ¯ä¸ªæ§åˆ¶å™¨éƒ½æ‹›ä¸€ä¸ªå°å¼Ÿï¼Œé‚£æˆ‘å¾—å¤šå‘å¤šå°‘äººçš„å·¥èµ„å•Šï¼Œä½ æƒ³æƒ³åŠæ³•ã€‚â€</p><h2 id="3-SharedInformer"><a href="#3-SharedInformer" class="headerlink" title="3. SharedInformer"></a>3. SharedInformer</h2><p>ç»è¿‡å’Œå…¶ä»–æ§åˆ¶å™¨çš„è®¨è®ºï¼Œæˆ‘ä»¬å†³å®šè¿™ä¹ˆåšï¼šæ‰€æœ‰æ§åˆ¶å™¨è”åˆèµ·æ¥ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥åˆ†é… <code>Informer</code>ï¼Œé’ˆå¯¹æ¯ä¸ªï¼ˆå—å¤šä¸ªæ§åˆ¶å™¨ç®¡ç†çš„ï¼‰èµ„æºæ‹›ä¸€ä¸ª Informer å°å¼Ÿï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>SharedInformer</code>ã€‚ä½ ä»¬å¯ä»¥ç†è§£ä¸ºå…±äº« Informerï¼Œå› ä¸ºæœ‰å¾ˆå¤šèµ„æºæ˜¯å—å¤šä¸ªæ§åˆ¶å™¨ç®¡ç†çš„ï¼Œæ¯”å¦‚ Pod åŒæ—¶å— <code>Deployment</code> å’Œ <code>StatefulSet</code> ç®¡ç†ã€‚è¿™æ ·å½“å¤šä¸ªæ§åˆ¶å™¨åŒæ—¶æƒ³æŸ¥ Pod çš„çŠ¶æ€æ—¶ï¼Œåªéœ€è¦è®¿é—®ä¸€ä¸ª Informer å°±è¡Œäº†ã€‚</p><p>ä½†è¿™åˆå¼•æ¥äº†æ–°çš„é—®é¢˜ï¼Œ<code>SharedInformer</code> æ— æ³•åŒæ—¶ç»™å¤šä¸ªæ§åˆ¶å™¨æä¾›ä¿¡æ¯ï¼Œè¿™å°±éœ€è¦æ¯ä¸ªæ§åˆ¶å™¨è‡ªå·±æ’é˜Ÿå’Œé‡è¯•ã€‚</p><p>ä¸ºäº†é…åˆæ§åˆ¶å™¨æ›´å¥½åœ°å®ç°æ’é˜Ÿå’Œé‡è¯•ï¼Œ<code>SharedInformer</code> æäº†ä¸€ä¸ª <code>Delta FIFO Queue</code>ï¼ˆå¢é‡å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼‰ï¼Œæ¯å½“èµ„æºè¢«ä¿®æ”¹æ—¶ï¼Œå®ƒçš„åŠ©æ‰‹ <code>Reflector</code> å°±ä¼šæ”¶åˆ°äº‹ä»¶é€šçŸ¥ï¼Œå¹¶å°†å¯¹åº”çš„äº‹ä»¶æ”¾å…¥ <code>Delta FIFO Queue</code> ä¸­ã€‚ä¸æ­¤åŒæ—¶ï¼Œ<code>SharedInformer</code> ä¼šä¸æ–­ä» <code>Delta FIFO Queue</code> ä¸­è¯»å–äº‹ä»¶ï¼Œç„¶åæ›´æ–°æœ¬åœ°ç¼“å­˜çš„çŠ¶æ€ã€‚</p><p>è¿™è¿˜ä¸è¡Œï¼Œ<code>SharedInformer</code> é™¤äº†æ›´æ–°æœ¬åœ°ç¼“å­˜ä¹‹å¤–ï¼Œè¿˜è¦æƒ³åŠæ³•å°†æ•°æ®åŒæ­¥ç»™å„ä¸ªæ§åˆ¶å™¨ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåˆæäº†ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼ˆWorkqueueï¼‰ï¼Œä¸€æ—¦æœ‰èµ„æºè¢«æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤ï¼Œå°±ä¼šå°†ç›¸åº”çš„äº‹ä»¶åŠ å…¥åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚æ‰€æœ‰çš„æ§åˆ¶å™¨æ’é˜Ÿè¿›è¡Œè¯»å–ï¼Œä¸€æ—¦æŸä¸ªæ§åˆ¶å™¨å‘ç°è¿™ä¸ªäº‹ä»¶ä¸è‡ªå·±ç›¸å…³ï¼Œå°±æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¦‚æœæ“ä½œå¤±è´¥ï¼Œå°±å°†è¯¥äº‹ä»¶æ”¾å›é˜Ÿåˆ—ï¼Œç­‰ä¸‹æ¬¡æ’åˆ°è‡ªå·±å†è¯•ä¸€æ¬¡ã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œå°±å°†è¯¥äº‹ä»¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</p><p>ç°åœ¨è¿™ä¸ªå·¥ä½œæ¨¡å¼å¾—åˆ°äº†å¤§å®¶çš„ä¸€è‡´å¥½è¯„ã€‚è™½ç„¶å•ä¸ª <code>SharedInformer</code> çš„å·¥ä½œé‡å¢åŠ äº†ï¼Œä½† Informer çš„æ•°é‡å¤§å¤§å‡å°‘äº†ï¼Œè€å¤§å¯ä»¥æŠŠçœä¸‹æ¥çš„èµ„é‡‘æ‹¿å‡ºä¸€å°éƒ¨åˆ†ç»™ <code>SharedInformer</code> æ¶¨å·¥èµ„å•Šï¼Œè¿™æ ·å¤§å®¶éƒ½å¾ˆå¼€å¿ƒã€‚</p><h2 id="4-CRD"><a href="#4-CRD" class="headerlink" title="4. CRD"></a>4. CRD</h2><p>å…¨æ°‘ Kubernetes æ—¶ä»£åˆ°äº†ã€‚</p><p>éšç€å®¹å™¨åŠå…¶ç¼–æ’æŠ€æœ¯çš„æ™®åŠï¼Œä½¿ç”¨ Kubernetes çš„ç”¨æˆ·å¤§é‡å¢é•¿ï¼Œç”¨æˆ·å·²ç»ä¸æ»¡è¶³ Kubernetes è‡ªå¸¦çš„é‚£äº›èµ„æºï¼ˆPodï¼ŒNodeï¼ŒServiceï¼‰äº†ï¼Œå¤§å®¶éƒ½å¸Œæœ›èƒ½æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åˆ›å»ºç‰¹å®šçš„èµ„æºï¼Œå¹¶ä¸”å¯¹è¿™äº›èµ„æºçš„çŠ¶æ€ç»´æŠ¤è¿˜è¦éµå¾ªä¸Šé¢æ‰€è¯´çš„é‚£ä¸€å¥—æ§åˆ¶å¾ªç¯æœºåˆ¶ã€‚</p><p>å¹¸å¥½æœ€è¿‘æŒé—¨äººåšäº†ä¸€æ¬¡å‡çº§ï¼Œæ–°å¢äº†ä¸€ä¸ªæ’ä»¶å« <code>CRDï¼ˆCustom Resource Definitionï¼‰</code>ï¼Œåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„èµ„æºå®ä¾‹ï¼Œåªéœ€è¦ç»è¿‡ä»¥ä¸‹ä¸¤æ­¥ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ª CRD èµ„æºï¼ˆæ²¡é”™ï¼ŒCRD ä¹Ÿæ˜¯ä¸€ç§èµ„æºç±»å‹ï¼‰ï¼Œå…¶ä¸­å®šä¹‰â€ è‡ªå®šä¹‰èµ„æº â€œçš„ <strong>API ç»„</strong>ã€<strong>API ç‰ˆæœ¬</strong>å’Œ<strong>èµ„æºç±»å‹</strong>ã€‚è¿™æ ·å°±ä¼šå‘ API Server æ³¨å†Œè¯¥èµ„æºç±»å‹çš„ APIã€‚</li><li>æŒ‡å®šä¸Šé¢å®šä¹‰çš„ API ç»„ å’Œ API ç‰ˆæœ¬ï¼Œåˆ›å»ºè‡ªå®šä¹‰èµ„æºã€‚</li></ol><p>å½“ç„¶ï¼Œä¸­é—´è¿˜è¦åŠ å…¥ä¸€äº›ä»£ç è®© Kubernetes è®¤è¯†è‡ªå®šä¹‰èµ„æºçš„å„ç§å‚æ•°ã€‚</p><p>åˆ°è¿™ä¸€æ­¥å°±åŸºæœ¬ä¸Šå®Œæˆäº†è‡ªå®šä¹‰èµ„æºçš„åˆ›å»ºï¼Œä½† Kubernetes å¹¶ä¸çŸ¥é“è¯¥èµ„æºæ‰€å¯¹åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ä½ çš„è‡ªå®šä¹‰èµ„æºæ˜¯å®¿ä¸»æœºï¼Œé‚£ä¹ˆå¯¹åº”çš„ä¸šåŠ¡é€»è¾‘å°±æ˜¯åˆ›å»ºä¸€å°çœŸæ­£çš„å®¿ä¸»æœºå‡ºæ¥ã€‚é‚£ä¹ˆæ€æ ·å®ç°å®ƒçš„ä¸šåŠ¡é€»è¾‘å‘¢ï¼Ÿ</p><h2 id="5-è‡ªå®šä¹‰æ§åˆ¶å™¨"><a href="#5-è‡ªå®šä¹‰æ§åˆ¶å™¨" class="headerlink" title="5. è‡ªå®šä¹‰æ§åˆ¶å™¨"></a>5. è‡ªå®šä¹‰æ§åˆ¶å™¨</h2><p><code>Controller Manager</code> è§å¤šè¯†å¹¿ï¼Œè¯´ï¼šâ€ è¿™é‡Œçš„æ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯æˆ‘çš„ä¸€éƒ¨åˆ†ï¼Œå½“åˆåˆ›é€ ä½ ä»¬æ˜¯å› ä¸ºä½ ä»¬éƒ½å±äºé€šç”¨çš„æ§åˆ¶å™¨ï¼Œå¤§å®¶éƒ½èƒ½ç”¨å¾—ä¸Šã€‚è€Œè‡ªå®šä¹‰èµ„æºéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡æ¥å®ç°ï¼Œæˆ‘ä»¬ä¸å¯èƒ½çŸ¥é“æ¯ä¸ªç”¨æˆ·çš„å…·ä½“ä¸šåŠ¡æ˜¯å•¥ï¼Œè‡ªå·±ä¸€æ‹è„‘è¢‹æƒ³å‡ºæ¥çš„è‡ªå®šä¹‰èµ„æºï¼Œç”¨æˆ·ä¹Ÿä¸ä¸€å®šç”¨å¾—ä¸Šã€‚æˆ‘ä»¬å¯ä»¥è®©ç”¨æˆ·è‡ªå·±ç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œä½ ä»¬æŠŠä¹‹å‰ä½¿ç”¨çš„æ§åˆ¶å¾ªç¯å’Œ Informer è¿™äº›ç¼–ç æ¨¡å¼æ€»ç»“ä¸€ä¸‹ï¼Œç„¶åæä¾›ç»™ç”¨æˆ·ï¼Œè®©ä»–ä»¬æŒ‰ç…§åŒæ ·çš„æ–¹æ³•ç¼–å†™è‡ªå·±çš„æ§åˆ¶å™¨ã€‚â€œ</p><p>Deployment æ§åˆ¶å™¨ä¸€æƒŠï¼Œè¦æŠŠè‡ªå·±çš„ç§˜å¯†å‘Šè¯‰åˆ«äººï¼Ÿé‚£åˆ«äººæŠŠè‡ªå·±å–ä»£äº†å’‹åŠï¼Ÿèµ¶å¿™é—®é“ï¼šâ€ é‚£å°†æ¥æˆ‘å²‚ä¸æ˜¯å¾ˆå±é™©ï¼Œæ²¡æœ‰å­˜åœ¨çš„ä½™åœ°äº†ï¼Ÿâ€œ</p><p><code>Controller Manager</code> èµ¶å¿™è§£é‡Šé“ï¼šâ€ ä¸ç”¨æ‹…å¿ƒï¼Œè™½ç„¶ç”¨æˆ·å¯ä»¥ç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œä½†æ— è®ºä»–ä»¬ç©å‡ºä»€ä¹ˆèŠ±æ ·ï¼Œåªè¦ä»–ä»¬çš„ä¸šåŠ¡è·‘åœ¨ Kubernetes å¹³å°ä¸Šï¼Œå°±å…ä¸äº†è¦è·‘å®¹å™¨ï¼Œæœ€åè¿˜æ˜¯ä¼šæ¥æ±‚ä½ ä»¬å¸®å¿™çš„ï¼Œä½ è¦çŸ¥é“ï¼Œæ§åˆ¶å™¨æ˜¯å¯ä»¥å±‚å±‚é€’è¿›çš„ï¼Œä»–ä»¬åªä¸è¿‡æ˜¯åœ¨ä½ å¤–é¢å¥—äº†ä¸€å±‚ï¼Œæœ€åè¿˜æ˜¯è¦å›åˆ°ä½ è¿™é‡Œï¼Œè¯·æ±‚ä½ å¸®å¿™æ§åˆ¶ Podã€‚â€œ</p><p>è¿™ä¸‹å¤§å®¶éƒ½ä¸æ…Œäº†ï¼Œå†³å®šå°±æŠŠè‡ªå®šä¹‰æ§åˆ¶å™¨è¿™ä»¶äº‹æƒ…äº¤ç»™ç”¨æˆ·è‡ªå·±å»å¤„ç†ï¼Œå°†é€‰æ‹©æƒç•™ç»™ç”¨æˆ·ã€‚</p><h2 id="6-Operator"><a href="#6-Operator" class="headerlink" title="6. Operator"></a>6. Operator</h2><p>ç”¨æˆ·è‡ªä»è·å¾—äº†ç¼–å†™è‡ªå®šä¹‰æ§åˆ¶å™¨çš„æƒåŠ›ä¹‹åï¼Œéå¸¸å¼€å¿ƒï¼Œæœ‰çš„ç”¨æˆ·ï¼ˆCoreOSï¼‰ä¸ºäº†æ–¹ä¾¿å¤§å®¶æ§åˆ¶æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¼€å‘å‡ºäº†ä¸€ç§ç‰¹å®šçš„æ§åˆ¶å™¨æ¨¡å‹å« <code>Operator</code>ï¼Œå¹¶å¼€å§‹åœ¨ç¤¾åŒºå†…æ¨å¹¿ï¼Œå¾—åˆ°äº†å¤§å®¶çš„ä¸€è‡´å¥½è¯„ã€‚ä¸å¯å¦è®¤ï¼Œ<code>Operator</code> è¿™ç§æ¨¡å¼æ˜¯å¾ˆèªæ˜çš„ï¼Œå®ƒæŠŠéœ€è¦ç‰¹å®šé¢†åŸŸçŸ¥è¯†çš„åº”ç”¨å•ç‹¬å†™ä¸€ä¸ª Operator æ§åˆ¶å™¨ï¼Œå°†è¿™ç§åº”ç”¨ç‰¹å®šçš„æ“ä½œçŸ¥è¯†ç¼–å†™åˆ°è½¯ä»¶ä¸­ï¼Œä½¿å…¶å¯ä»¥åˆ©ç”¨ Kubernetes å¼ºå¤§çš„æŠ½è±¡èƒ½åŠ›ï¼Œè¾¾åˆ°æ­£ç¡®è¿è¡Œå’Œç®¡ç†åº”ç”¨çš„ç›®çš„ã€‚</p><p>ä»¥ <code>ETCD Operator</code> ä¸ºä¾‹ï¼Œå‡å¦‚ä½ æƒ³æ‰‹åŠ¨æ‰©å±•ä¸€ä¸ª ETCD é›†ç¾¤ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ï¼š</p><ol><li>ä½¿ç”¨ ETCD ç®¡ç†å·¥å…·æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜ã€‚</li><li>ä¸ºè¿™ä¸ªæˆå‘˜æ‰€åœ¨çš„èŠ‚ç‚¹ç”Ÿæˆå¯¹åº”çš„å¯åŠ¨å‚æ•°ï¼Œå¹¶å¯åŠ¨å®ƒã€‚</li></ol><p>è€Œ ETCD Operator å°†è¿™äº›ç‰¹å®šäº etcd çš„æ“ä½œæ‰‹æ³•ç¼–å†™åˆ°äº†å®ƒçš„æ§åˆ¶å¾ªç¯ä¸­ï¼Œä½ åªéœ€è¦é€šè¿‡ä¿®æ”¹è‡ªå®šä¹‰èµ„æºå£°æ˜é›†ç¾¤æœŸæœ›çš„æˆå‘˜æ•°é‡ï¼Œå‰©ä¸‹çš„äº‹æƒ…äº¤ç»™ Operator å°±å¥½äº†ã€‚</p><p>æœ¬ä»¥ä¸ºè¿™æ˜¯ä¸€ä¸ªçš†å¤§æ¬¢å–œçš„æ–¹æ¡ˆï¼Œä½†æ²¡è¿‡å¤šä¹…ï¼Œå°±æœ‰å¼€å‘ Operator çš„å°å“¥æ¥æŠ±æ€¨äº†ï¼šâ€ æˆ‘ä»¬æœ‰å¾ˆå¤šå¼€å‘çš„å°ä¼™ä¼´éƒ½æ˜¯ä¸æ‡‚è¿ç»´é‚£ä¸€å¥—çš„ï¼Œä»€ä¹ˆé«˜å¯ç”¨ã€å®¹ç¾æ ¹æœ¬ä¸æ‡‚å•Šï¼Œç°åœ¨è®©æˆ‘ä»¬å°†è¿ç»´çš„æ“ä½œçŸ¥è¯†ç¼–å†™åˆ°è½¯ä»¶ä¸­ï¼Œè‡£å¦¾åšä¸åˆ°å•Šã€‚ã€‚â€œ</p><p>è¿™ç¡®å®æ˜¯ä¸ªé—®é¢˜ï¼Œè¿™æ ·ä¸€æ¥å°±æŠŠå¼€å‘å’Œè¿ç»´çš„å·¥ä½œéƒ½å¡åˆ°äº†å¼€å‘æ‰‹é‡Œï¼Œæ—¢æ‡‚å¼€å‘åˆæ‡‚è¿ç»´çš„å¯ä¸å¤šå•Šï¼Œä¸ºäº†ç…§é¡¾å¤§å®¶ï¼Œè¿˜å¾—ç»§ç»­æƒ³åŠæ³•æŠŠå¼€å‘å’Œè¿ç»´çš„å·¥ä½œæ‹†åˆ†å¼€æ¥ã€‚</p><h2 id="7-OAM"><a href="#7-OAM" class="headerlink" title="7. OAM"></a>7. OAM</h2><p>è¿™æ—¶å€™é˜¿é‡Œå’Œå¾®è½¯å‘åŠ›äº†ï¼Œä»–ä»¬è”åˆå‘å¸ƒäº†ä¸€ä¸ªå¼€æ”¾åº”ç”¨æ¨¡å‹ï¼Œå« <a href="https://cloudblogs.microsoft.com/opensource/2019/10/16/announcing-open-application-model/">Open Application Model </a>ï¼ˆOAMï¼‰ã€‚è¿™ä¸ªæ¨¡å‹å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œå°†å¼€å‘å’Œè¿ç»´çš„èŒè´£è§£è€¦ï¼Œä¸åŒçš„è§’è‰²å±¥è¡Œä¸åŒçš„èŒè´£ï¼Œå¹¶å½¢æˆä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://hugo-picture.oss-cn-beijing.aliyuncs.com/images/20200223122350.png" alt="img"></p><p>è¿™ä¸ªè§„èŒƒå‘Šè¯‰æˆ‘ä»¬ï¼š</p><ul><li>å¼€å‘äººå‘˜è´Ÿè´£æè¿°ç»„ä»¶çš„åŠŸèƒ½ï¼Œå¦‚ä½•é…ç½®ç»„ä»¶ï¼Œä»¥åŠè¿è¡Œéœ€è¦å¤šå°‘èµ„æº</li><li>è¿ç»´äººå‘˜è´Ÿè´£å°†ç›¸å…³ç»„ä»¶ç»„åˆæˆä¸€ä¸ªåº”ç”¨ï¼Œå¹¶é…ç½®è¿è¡Œæ—¶å‚æ•°å’Œè¿ç»´æ”¯æ’‘èƒ½åŠ›ï¼Œæ¯”å¦‚æ˜¯å¦éœ€è¦ç›‘æ§ï¼Œæ˜¯å¦éœ€è¦å¼¹æ€§ä¼¸ç¼©ã€‚</li><li>åŸºç¡€è®¾æ–½å·¥ç¨‹å¸ˆè´Ÿè´£å»ºç«‹å’Œç»´æŠ¤åº”ç”¨çš„è¿è¡Œæ—¶ç¯å¢ƒï¼ˆå¦‚åº•å±‚ç³»ç»Ÿï¼‰ã€‚</li></ul><p>å…¶ä¸­æ¯ä¸€ä¸ªå›¢é˜Ÿè´Ÿè´£çš„äº‹æƒ…éƒ½ç”¨å¯¹åº”çš„ CRD æ¥é…ç½®ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œå¼€å‘å’Œè¿ç»´äººå‘˜çš„èŒè´£å°±è¢«åŒºåˆ†å¼€æ¥äº†ï¼Œç®€åŒ–äº†åº”ç”¨çš„ç»„åˆå’Œè¿ç»´ã€‚å®ƒå°†åº”ç”¨çš„é…ç½®å’Œè¿ç»´ç‰¹å¾ï¼ˆå¦‚è‡ªåŠ¨ä¼¸ç¼©ã€æµé‡ç›‘æ§ï¼‰è¿›è¡Œè§£è€¦ï¼Œç„¶åé€šè¿‡å»ºæ¨¡æ„æˆä¸€ä¸ªæ•´ä½“ï¼Œé¿å…äº† Operator è¿™ç§æ¨¡å‹å¸¦æ¥çš„å¤§é‡å†—ä½™ã€‚</p><p>è‡ªä»ç”¨ä¸Šäº†è¿™ä¸ªæ¨¡å‹ä¹‹åï¼Œè¿ç»´å’Œå¼€å‘å°å“¥è¡¨ç¤ºç°åœ¨ä»–ä»¬çš„å…³ç³»å¾ˆèæ´½ï¼Œæ²¡äº‹è¿˜èƒ½ä¸€èµ·å‡ºå»å–ä¸¤æ¯ã€‚</p><h2 id="æ–‡ç« è½¬è‡ª"><a href="#æ–‡ç« è½¬è‡ª" class="headerlink" title="æ–‡ç« è½¬è‡ª"></a>æ–‡ç« è½¬è‡ª</h2><div class="tag-plugin link dis-select"><a class="link-card plain" title="Kubernetesæ§åˆ¶å™¨çš„è¿›åŒ–ä¹‹æ—… https://fuckcloudnative.io/posts/controllers-confession/" href="https://fuckcloudnative.io/posts/controllers-confession/" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="icon"><div class="left"><span class="title">Kubernetesæ§åˆ¶å™¨çš„è¿›åŒ–ä¹‹æ—… https://fuckcloudnative.io/posts/controllers-confession/</span><span class="cap link fs12">https://fuckcloudnative.io/posts/controllers-confession/</span></div><div class="right"><div class="lazy img" data-bg="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/link/8f277b4ee0ecd.svg"></div></div></a></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æˆ‘æ˜¯ä¸€å † Kubernetes æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆæ˜¯ä¸€å †ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯ä¸€ä¸ªäººï¼Œæˆ‘åªæ˜¯ä¼—å¤šæ§åˆ¶å™¨ä¸­çš„ä¸€å‘˜ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠæˆ‘çœ‹æˆæ˜¯ä¼—å¤šæ§åˆ¶å™¨çš„é›†åˆã€‚æˆ‘çš„èŒè´£å°±æ˜¯ç›‘æ§é›†ç¾¤å†…èµ„æºçš„å®é™…çŠ¶æ€ï¼Œä¸€æ—¦å‘ç°å…¶ä¸æœŸæœ›çš„çŠ¶æ€ä¸ç›¸ç¬¦ï¼Œå°±é‡‡å–è¡ŒåŠ¨ä½¿å…¶ç¬¦åˆæœŸæœ›çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³å½“åˆï¼ŒKubernetes è€å¤§å“¥åˆ›é€ æˆ‘æ—¶ï¼Œåªæ˜¯æ‰“ç®—è®©æˆ‘ç”¨&lt;strong&gt;æ§åˆ¶å¾ªç¯&lt;/strong&gt;ç®€å•ç»´æŠ¤ä¸‹èµ„æºçš„çŠ¶æ€ã€‚ä½†æˆ‘åæ¥çš„å‘å±•ï¼Œè¿œè¿œè¶…å‡ºäº†ä»–çš„æƒ³è±¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯åŠ æ²¹ç«™" scheme="https://liei.cc/blog/categories/%E6%8A%80%E6%9C%AF%E5%8A%A0%E6%B2%B9%E7%AB%99/"/>
    
    
    <category term="Cloud Navite" scheme="https://liei.cc/blog/tags/cloud-navite/"/>
    
    <category term="Kubernetes" scheme="https://liei.cc/blog/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>OpenLDAP å¿«é€Ÿè½åœ°å®è·µ-éƒ¨ç½²é…ç½®</title>
    <link href="https://liei.cc/2020/openldap-install-config.html"/>
    <id>https://liei.cc/2020/openldap-install-config.html</id>
    <published>2020-07-20T15:15:15.000Z</published>
    <updated>2020-07-20T15:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸‹è½½ä¾èµ–"><a href="#ä¸‹è½½ä¾èµ–" class="headerlink" title="ä¸‹è½½ä¾èµ–"></a>ä¸‹è½½ä¾èµ–</h2><p>æœ¬æ–‡ä¸­ç›¸å…³æ“ä½œç³»ç»ŸåŠä¾èµ–åŒ…çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p><ul><li>centos-release-7-4.1708.el7.centos.x86_64</li><li>openldap-clients-2.4.44-5.el7.x86_64ï¼šåŒ…å«å®¢æˆ·ç«¯ç¨‹åºï¼Œç”¨æ¥è®¿é—®å’Œä¿®æ”¹ OpenLDAP ç›®å½•</li><li>openldap-servers-2.4.44-5.el7.x86_64ï¼šåŒ…å«ä¸» LDAP æœåŠ¡å™¨ slapd å’ŒåŒæ­¥æœåŠ¡å™¨ slurpd æœåŠ¡å™¨ã€è¿ç§»è„šæœ¬å’Œç›¸å…³æ–‡ä»¶</li></ul><h2 id="å®‰è£…éƒ¨ç½²"><a href="#å®‰è£…éƒ¨ç½²" class="headerlink" title="å®‰è£…éƒ¨ç½²"></a>å®‰è£…éƒ¨ç½²</h2><p><strong>ç¬¬ä¸€æ­¥ï¼Œéœ€è¦åˆ‡æ¢åˆ° root è´¦å·æ¥å®‰è£… OpenLDAP ç›¸å…³ç¨‹åºåŒ…ï¼Œå¹¶å¯åŠ¨æœåŠ¡ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ yum install -y openldap-servers openldap-clients</span><br><span class="line">$ <span class="built_in">cp</span> /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span><br><span class="line">$ <span class="built_in">chown</span> ldap. /var/lib/ldap/DB_CONFIG</span><br><span class="line">$ systemctl <span class="built_in">enable</span> slapd</span><br><span class="line">$ systemctl start slapd</span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>slappasswd</code> å‘½ä»¤æ¥ç”Ÿæˆä¸€ä¸ªå¯†ç ï¼Œå¹¶ä½¿ç”¨ LDIFï¼ˆLDAP æ•°æ®äº¤æ¢æ ¼å¼ï¼‰æ–‡ä»¶å°†å…¶å¯¼å…¥åˆ° LDAP ä¸­æ¥é…ç½®ç®¡ç†å‘˜å¯†ç ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ slappasswd</span><br><span class="line">New password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">&#123;SSHA&#125;KS/bFZ8KTmO56khHjJvM97l7zivH1MwG</span><br><span class="line"></span><br><span class="line">$ vim chrootpw.ldif</span><br><span class="line"><span class="comment"># specify the password generated above for &quot;olcRootPW&quot; section</span></span><br><span class="line">dn: olcDatabase=&#123;0&#125;config,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcRootPW</span><br><span class="line">olcRootPW: &#123;SSHA&#125;KS/bFZ8KTmO56khHjJvM97l7zivH1MwG</span><br><span class="line"></span><br><span class="line">$ ldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å‘ LDAP ä¸­å¯¼å…¥ä¸€äº›åŸºæœ¬çš„ Schemaã€‚è¿™äº› Schema æ–‡ä»¶ä½äº <code>/etc/openldap/schema/</code> ç›®å½•ä¸­ï¼Œå®šä¹‰äº†æˆ‘ä»¬ä»¥ååˆ›å»ºçš„æ¡ç›®å¯ä»¥ä½¿ç”¨å“ªäº›å±æ€§</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/core.ldif</span><br><span class="line">$ ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif</span><br><span class="line">$ ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif</span><br><span class="line">$ ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif</span><br></pre></td></tr></table></figure><p><strong>ç¬¬å››æ­¥ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® LDAP çš„é¡¶çº§åŸŸï¼ˆä»¥ <code>dc=leeif,dc=me</code> ä¸ºä¾‹ï¼‰åŠå…¶ç®¡ç†åŸŸï¼š</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ slappasswd</span><br><span class="line">New password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">&#123;SSHA&#125;z/rsbmAjVtLlWeUB0xS5itLPI0VA1akD</span><br><span class="line"></span><br><span class="line">$ vim chdomain.ldif</span><br><span class="line"><span class="comment"># replace to your own domain name for &quot;dc=***,dc=***&quot; section</span></span><br><span class="line"><span class="comment"># specify the password generated above for &quot;olcRootPW&quot; section</span></span><br><span class="line">dn: olcDatabase=&#123;1&#125;monitor,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to * by dn.base=<span class="string">&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;</span></span><br><span class="line">  <span class="built_in">read</span> by dn.base=<span class="string">&quot;cn=admin,dc=leeif,dc=me&quot;</span> <span class="built_in">read</span> by * none</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;mdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcSuffix</span><br><span class="line">olcSuffix: dc=leeif,dc=me</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;mdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcRootDN</span><br><span class="line">olcRootDN: cn=admin,dc=leeif,dc=me</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;mdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcRootPW</span><br><span class="line">olcRootPW: &#123;SSHA&#125;z/rsbmAjVtLlWeUB0xS5itLPI0VA1akD</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;mdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to attrs=userPassword,shadowLastChange by</span><br><span class="line">  dn=<span class="string">&quot;cn=admin,dc=leeif,dc=me&quot;</span> write by anonymous auth by self write by * none</span><br><span class="line">olcAccess: &#123;1&#125;to dn.base=<span class="string">&quot;&quot;</span> by * <span class="built_in">read</span></span><br><span class="line">olcAccess: &#123;2&#125;to * by dn=<span class="string">&quot;cn=admin,dc=leeif,dc=me&quot;</span> write by * <span class="built_in">read</span></span><br><span class="line"></span><br><span class="line">$ ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif</span><br></pre></td></tr></table></figure><p><strong>ç¬¬äº”æ­¥ï¼Œåœ¨ä¸Šè¿°åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå«åš leeif News Agency çš„ç»„ç»‡ï¼Œå¹¶åœ¨å…¶ä¸‹åˆ›å»ºä¸€ä¸ª Manager çš„ç»„ç»‡è§’è‰²ï¼ˆè¯¥è§’è‰²å†…çš„ç”¨æˆ·å…·æœ‰ç®¡ç†æ•´ä¸ª LDAP çš„æƒé™ï¼‰å’Œ People å’Œ Group ä¸¤ä¸ªç»„ç»‡å•å…ƒï¼š</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim basedomain.ldif</span><br><span class="line"><span class="comment"># replace to your own domain name for &quot;dc=***,dc=***&quot; section</span></span><br><span class="line">dn: dc=leeif,dc=me</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectclass: organization</span><br><span class="line">o: leeif.IO</span><br><span class="line">dc: leeif</span><br><span class="line"></span><br><span class="line">dn: cn=admin,dc=leeif,dc=me</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">cn: Manager</span><br><span class="line"></span><br><span class="line">dn: ou=people,dc=leeif,dc=me</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: people</span><br><span class="line"></span><br><span class="line">dn: ou=group,dc=leeif,dc=me</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: group</span><br><span class="line"></span><br><span class="line">$ ldapadd -x -D cn=admin,dc=leeif,dc=me -W -f basedomain.ldif</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šçš„æ‰€æœ‰æ­¥éª¤ï¼Œæˆ‘ä»¬å°±è®¾ç½®å¥½äº†ä¸€ä¸ª LDAP ç›®å½•æ ‘ï¼šå…¶ä¸­åŸºå‡† dn <code>dc=leeif,dc=me</code> æ˜¯è¯¥æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå…¶ä¸‹æœ‰ä¸€ä¸ªç®¡ç†åŸŸ <code>cn=admin,dc=leeif,dc=me</code> å’Œä¸¤ä¸ªç»„ç»‡å•å…ƒ <code>ou=people,dc=leeif,dc=me</code> åŠ <code>ou=group,dc=leeif,dc=me</code>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå«ä½œ Ada Catherine çš„å‘˜å·¥å¹¶å°†å…¶åˆ†é…åˆ° Secretary ç»„æ¥éªŒè¯ä¸Šè¿°é…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ slappasswd</span><br><span class="line">New password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">&#123;SSHA&#125;HTGqAd4p6fOOIVHm7VZYUSorWGfnrqAA</span><br><span class="line"></span><br><span class="line">$ vim ldapuser.ldif</span><br><span class="line"><span class="comment"># create new</span></span><br><span class="line"><span class="comment"># replace to your own domain name for &quot;dc=***,dc=***&quot; section</span></span><br><span class="line">dn: uid=ada,ou=people,dc=leeif,dc=me</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">uid: ada</span><br><span class="line">cn: Ada Catherine</span><br><span class="line">sn: Catherine</span><br><span class="line">userPassword: &#123;SSHA&#125;HTGqAd4p6fOOIVHm7VZYUSorWGfnrqAA</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1000</span><br><span class="line">gidNumber: 1000</span><br><span class="line">homeDirectory: /home/users/ada</span><br><span class="line"></span><br><span class="line">dn: cn=Secretary,ou=group,dc=leeif,dc=me</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">cn: Secretary</span><br><span class="line">gidNumber: 1000</span><br><span class="line">memberUid: ada</span><br><span class="line"></span><br><span class="line"><span class="comment"># ldapadd -x -D cn=admin,dc=leeif,dc=me -W -f ldapuser.ldif</span></span><br><span class="line">Enter LDAP Password:</span><br><span class="line">adding new entry <span class="string">&quot;uid=ada,ou=People,dc=leeif,dc=org&quot;</span></span><br><span class="line">adding new entry <span class="string">&quot;cn=Secretary,ou=Group,dc=leeif,dc=org&quot;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>ldapsearch</code> å‘½ä»¤æ¥æŸ¥çœ‹ LDAP ç›®å½•æœåŠ¡ä¸­çš„æ‰€æœ‰æ¡ç›®ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ldapsearch -x -b <span class="string">&quot;dc=leeif,dc=me&quot;</span> -H ldap://127.0.0.1</span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;dc=leeif,dc=me&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (objectclass=*)</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># leeif.org</span></span><br><span class="line">dn: dc=leeif,dc=me</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectClass: organization</span><br><span class="line">o: leeif News Agency</span><br><span class="line">dc: leeif</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦åˆ é™¤ä¸€ä¸ªæ¡ç›®ï¼Œå¯ä»¥æŒ‰ä¸‹é¢çš„å‘½ä»¤æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ldapdelete -x -W -D <span class="string">&#x27;cn=admin,dc=leeif,dc=me&#x27;</span> <span class="string">&quot;uid=ada,ou=People,dc=leeif,dc=me&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å‘½ä»¤è®°å½•"><a href="#å¸¸ç”¨å‘½ä»¤è®°å½•" class="headerlink" title="å¸¸ç”¨å‘½ä»¤è®°å½•"></a>å¸¸ç”¨å‘½ä»¤è®°å½•</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(&amp;(&amp;(objectClass=inetOrgPerson)))</span><br><span class="line"><span class="built_in">mkdir</span> /etc/yum.repos.d/backup</span><br><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/* /etc/yum.repos.d/backup/</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line">yum -y install openldap-servers openldap-clients</span><br><span class="line"><span class="comment"># yum reinstall --downloadonly --downloaddir=./openldap/ openldap-servers openldap-clients</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> slapd.d slapd.d.bak</span><br><span class="line"></span><br><span class="line">sudo systemctl stop slapd &amp;&amp; sudo <span class="built_in">rm</span> -rf slapd.d &amp;&amp; sudo <span class="built_in">mkdir</span> slapd.d</span><br><span class="line">sudo slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</span><br><span class="line">sudo <span class="built_in">chown</span> -R ldap:ldap slapd.d  &amp;&amp; sudo systemctl start slapd</span><br><span class="line"></span><br><span class="line">systemctl stop slapd &amp;&amp; <span class="built_in">rm</span> -rf slapd.d &amp;&amp; <span class="built_in">mkdir</span> slapd.d</span><br><span class="line">slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</span><br><span class="line"><span class="built_in">chown</span> -R ldap:ldap slapd.d  &amp;&amp; systemctl start slapd</span><br><span class="line"></span><br><span class="line">service slapd stop &amp;&amp; <span class="built_in">rm</span> -rf slapd.d &amp;&amp; <span class="built_in">mkdir</span> slapd.d</span><br><span class="line">slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</span><br><span class="line"><span class="built_in">chown</span> -R ldap:ldap slapd.d  &amp;&amp; service slapd start</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /var/lib/ldap &amp;&amp; <span class="built_in">mkdir</span> /var/lib/ldap</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /usr/share/openldap-servers/slapd.ldif /etc/openldap/</span><br><span class="line"><span class="built_in">cp</span> /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span><br><span class="line"><span class="built_in">chown</span> ldap. /var/lib/ldap/DB_CONFIG</span><br><span class="line"><span class="built_in">chown</span> -R ldap:ldap slapd.d </span><br><span class="line"><span class="built_in">chown</span> -R ldap:ldap /var/lib/ldap/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ¡ˆä¸€</span></span><br><span class="line">vim /etc/openldap/slapd.ldif  <span class="comment">##ä¿®æ”¹åçš„åˆå§‹åŒ–ldifæ–‡ä»¶</span></span><br><span class="line">slapadd -n 0 -F slapd.d -l slapd.ldif   <span class="comment">##ç”Ÿæˆé…ç½®æ•°æ®åº“ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ¡ˆäºŒ</span></span><br><span class="line">vi /etc/openldap/slapd.conf</span><br><span class="line">slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl start slapd</span></span><br><span class="line"><span class="comment"># systemctl enable slapd</span></span><br><span class="line"><span class="comment"># systemctl status slapd</span></span><br></pre></td></tr></table></figure><h2 id="slapd-conf-æ–‡ä»¶é…ç½®"><a href="#slapd-conf-æ–‡ä»¶é…ç½®" class="headerlink" title="slapd.conf æ–‡ä»¶é…ç½®"></a>slapd.conf æ–‡ä»¶é…ç½®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pidfile /var/run/openldap/slapd.pid</span><br><span class="line">argsfile /var/run/openldap/slapd.args</span><br><span class="line"></span><br><span class="line">include /etc/openldap/schema/core.schema</span><br><span class="line">include /etc/openldap/schema/collective.schema</span><br><span class="line">include /etc/openldap/schema/corba.schema</span><br><span class="line">include /etc/openldap/schema/cosine.schema</span><br><span class="line">include /etc/openldap/schema/duaconf.schema</span><br><span class="line">include /etc/openldap/schema/dyngroup.schema</span><br><span class="line">include /etc/openldap/schema/inetorgperson.schema</span><br><span class="line">include /etc/openldap/schema/java.schema</span><br><span class="line">include /etc/openldap/schema/misc.schema</span><br><span class="line">include /etc/openldap/schema/nis.schema</span><br><span class="line">include /etc/openldap/schema/openldap.schema</span><br><span class="line">include /etc/openldap/schema/pmi.schema</span><br><span class="line">include /etc/openldap/schema/ppolicy.schema</span><br><span class="line"></span><br><span class="line">modulepath /usr/lib64/openldap</span><br><span class="line">moduleload memberof.la</span><br><span class="line">moduleload back_ldap.la</span><br><span class="line">moduleload back_relay.la</span><br><span class="line">moduleload pcache.la</span><br><span class="line">moduleload ppolicy.la</span><br><span class="line">moduleload syncprov.la</span><br><span class="line">moduleload rwm.la</span><br><span class="line"></span><br><span class="line">loglevel 256</span><br><span class="line"></span><br><span class="line"><span class="comment"># before any database</span></span><br><span class="line">overlay rwm</span><br><span class="line">rwm-rewriteEngine on</span><br><span class="line">rwm-rewriteContext bindDN</span><br><span class="line"><span class="comment"># rwm-rewriteRule &quot;(.+,)?dc=leeif,dc=me$&quot; &quot;$1dc=auth&quot; &quot;:@&quot;</span></span><br><span class="line">rwm-rewriteRule <span class="string">&quot;(^uid=.+,)(.+,)?dc=leeif,dc=me$&quot;</span> <span class="string">&quot;<span class="variable">$1dc</span>=auth&quot;</span> <span class="string">&quot;:@&quot;</span></span><br><span class="line"></span><br><span class="line">database    config</span><br><span class="line">access  to *</span><br><span class="line">        by dn.base=<span class="string">&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;</span> manage</span><br><span class="line">        by * none</span><br><span class="line"></span><br><span class="line">database    monitor</span><br><span class="line">access  to dn.base=<span class="string">&quot;dc=ldapproxy,dc=com&quot;</span></span><br><span class="line">        by ssf=256 group.exact=<span class="string">&quot;cn=admin,dc=ldapproxy,dc=com&quot;</span> <span class="built_in">read</span></span><br><span class="line">        by * none</span><br><span class="line"></span><br><span class="line">database    hdb</span><br><span class="line">suffix      <span class="string">&quot;dc=ldapproxy,dc=com&quot;</span></span><br><span class="line">rootdn      <span class="string">&quot;cn=admin,dc=ldapproxy,dc=com&quot;</span></span><br><span class="line">rootpw      &#123;SSHA&#125;password</span><br><span class="line">directory   /var/lib/ldap</span><br><span class="line"></span><br><span class="line"><span class="comment"># Database LDAP for OpenLDAP </span></span><br><span class="line">database    ldap</span><br><span class="line"><span class="built_in">readonly</span>    <span class="built_in">yes</span></span><br><span class="line">suffix      <span class="string">&quot;dc=leeif,dc=me&quot;</span></span><br><span class="line">uri         ldap://127.0.0.1:389</span><br><span class="line">idassert-bind bindmethod=simple</span><br><span class="line">   binddn=<span class="string">&quot;cn=admin,dc=leeif,dc=me&quot;</span></span><br><span class="line">   credentials=<span class="string">&quot;zto.com&quot;</span></span><br><span class="line">   mode=none</span><br><span class="line">   flags=non-prescriptive</span><br><span class="line">idassert-authzFrom <span class="string">&quot;dn.exact:cn=admin,dc=ldapproxy,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Database LDAP for LDAP-Auth</span></span><br><span class="line">database    ldap</span><br><span class="line"><span class="built_in">readonly</span>    <span class="built_in">yes</span></span><br><span class="line">suffix      <span class="string">&quot;dc=auth&quot;</span></span><br><span class="line">uri         ldap://127.0.0.1:10389</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸‹è½½ä¾èµ–&quot;&gt;&lt;a href=&quot;#ä¸‹è½½ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹è½½ä¾èµ–&quot;&gt;&lt;/a&gt;ä¸‹è½½ä¾èµ–&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä¸­ç›¸å…³æ“ä½œç³»ç»ŸåŠä¾èµ–åŒ…çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;centos-release-7-4.1708.el7.c</summary>
      
    
    
    
    <category term="æŠ˜è…¾ä¸æ­¢" scheme="https://liei.cc/blog/categories/%E6%8A%98%E8%85%BE%E4%B8%8D%E6%AD%A2/"/>
    
    
    <category term="OpenLDAP" scheme="https://liei.cc/blog/tags/openldap/"/>
    
  </entry>
  
  <entry>
    <title>OpenLDAP å¿«é€Ÿè½åœ°å®è·µ-åŸºæœ¬ä»‹ç»</title>
    <link href="https://liei.cc/2020/openldap-getting-started.html"/>
    <id>https://liei.cc/2020/openldap-getting-started.html</id>
    <published>2020-07-15T15:15:15.000Z</published>
    <updated>2020-07-15T15:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åœºæ™¯éœ€æ±‚"><a href="#åœºæ™¯éœ€æ±‚" class="headerlink" title="åœºæ™¯éœ€æ±‚"></a>åœºæ™¯éœ€æ±‚</h2><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2020/20200809201834.png" alt="openldap-architecture"></p><div class="tag-plugin note" color="orange"><div class="title"><strong>éœ€æ±‚</strong></div><div class="body"><p>å½“å…¬å¸ä½“é‡è¾ƒå¤§ï¼Œå†…éƒ¨æœ‰å¤šä¸ªç³»ç»Ÿï¼Œå¦‚æœæ¯ä¸ªå¹³å°éƒ½éœ€è¦ç»´æŠ¤ä¸€ä¸ªç”¨æˆ·ç®¡ç†ä½“ç³»ï¼Œé‚£ä¹ˆå¦‚æœä¸€ä¸ªå‘˜å·¥æ‹¥æœ‰ N ä¸ªå¹³å°æƒé™ç¦»èŒåŠå¸¸è§„æƒé™å˜æ›´ï¼Œå¯¹äºçš„ç®¡ç†æ— ç–‘ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œä¹Ÿæ— æ³•åšåˆ°ç²¾ç»†åŒ–æƒé™ç®¡ç†ã€‚æ¯”å¦‚æ¯æ¬¡æ–°è¿›æˆ–ç¦»èŒä¸€ä½åŒäº‹ï¼Œæˆ‘ä»¬è¿™è¾¹ OPS è¿ç»´ç»„çš„å°ä¼™ä¼´ä»¬ï¼Œéƒ½è¦åœ¨æ¯ä¸ªç³»ç»Ÿä¸Šå»æ·»åŠ ç”¨æˆ·ï¼Œæå¾—å°ä¼™ä¼´ä»¬å¾ˆä¸çˆ½ã€‚</p></div></div><p>ç®€å•è¯´ä¸€ä¸‹ OPENLDAP å¯¹è¿ç»´ç®¡ç†çš„ä»·å€¼ï¼Œæ”¯æ’‘ä¼ä¸šæŠ€æœ¯å‘å±•æ¯”å¦‚ <code>GITã€ ZABBIXã€ YAPIã€ JUMPSERVERã€ OA</code> ç­‰å¤§å¤§å°å°ç³»ç»Ÿï¼Œä¹ƒè‡³ Windowsï¼ŒLinux ç³»ç»Ÿçš„è®¤è¯ç™»å½•ã€‚</p><span id="more"></span><p>é€šè¿‡ LDAP æŠ€æœ¯æˆ‘ä»¬å¯ä»¥å®ç°å¤šå¹³å°è´¦å·é›†ä¸­ç®¡ç†ï¼Œæƒé™çµæ´»æ§åˆ¶ï¼Œå¯†ç å¼ºåº¦åŠå…¶æœ‰æ•ˆæœŸçš„çº¦æŸï¼Œå°†ç”¨æˆ·ç®¡ç†ä¸å„ä¸ªå¹³å°è§£è€¦ï¼Œæœ€ç»ˆå®ç°ä¸€æ¬¡ä¿®æ”¹ N å¤„ç”Ÿæ•ˆã€‚</p><h2 id="LDAP-ç®€ä»‹"><a href="#LDAP-ç®€ä»‹" class="headerlink" title="LDAP ç®€ä»‹"></a>LDAP ç®€ä»‹</h2><p><code>LDAP</code>ï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼Œ<code>Lightweight Directory Access Protocol</code>) æ˜¯å®ç°æä¾›è¢«ç§°ä¸ºç›®å½•æœåŠ¡çš„ä¿¡æ¯æœåŠ¡ã€‚ç›®å½•æœåŠ¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®åº“ç³»ç»Ÿï¼Œå…¶ä¸“é—¨é’ˆå¯¹è¯»å–ï¼Œæµè§ˆå’Œæœç´¢æ“ä½œè¿›è¡Œäº†ç‰¹å®šçš„ä¼˜åŒ–ã€‚ç›®å½•ä¸€èˆ¬ç”¨æ¥åŒ…å«æè¿°æ€§çš„ï¼ŒåŸºäºå±æ€§çš„ä¿¡æ¯å¹¶æ”¯æŒç²¾ç»†å¤æ‚çš„è¿‡æ»¤èƒ½åŠ›ã€‚ç›®å½•ä¸€èˆ¬ä¸æ”¯æŒé€šç”¨æ•°æ®åº“é’ˆå¯¹å¤§é‡æ›´æ–°æ“ä½œæ“ä½œéœ€è¦çš„å¤æ‚çš„äº‹åŠ¡ç®¡ç†æˆ–å›å·ç­–ç•¥ã€‚è€Œç›®å½•æœåŠ¡çš„æ›´æ–°åˆ™ä¸€èˆ¬éƒ½éå¸¸ç®€å•ã€‚è¿™ç§ç›®å½•å¯ä»¥å­˜å‚¨åŒ…æ‹¬ä¸ªäººä¿¡æ¯ã€web é“¾ç»“ã€jpeg å›¾åƒç­‰å„ç§ä¿¡æ¯ã€‚ä¸ºäº†è®¿é—®å­˜å‚¨åœ¨ç›®å½•ä¸­çš„ä¿¡æ¯ï¼Œå°±éœ€è¦ä½¿ç”¨è¿è¡Œåœ¨ TCP&#x2F;IP ä¹‹ä¸Šçš„è®¿é—®åè®® â€”LDAPã€‚</p><p>LDAP ç›®å½•ä¸­çš„ä¿¡æ¯æ˜¯æ˜¯æŒ‰ç…§æ ‘å‹ç»“æ„ç»„ç»‡ï¼Œå…·ä½“ä¿¡æ¯å­˜å‚¨åœ¨æ¡ç›® (entry) çš„æ•°æ®ç»“æ„ä¸­ã€‚æ¡ç›®ç›¸å½“äºå…³ç³»æ•°æ®åº“ä¸­è¡¨çš„è®°å½•ï¼›æ¡ç›®æ˜¯å…·æœ‰åŒºåˆ«å <code>DN</code> ï¼ˆDistinguished Nameï¼‰çš„å±æ€§ï¼ˆAttributeï¼‰ï¼ŒDN æ˜¯ç”¨æ¥å¼•ç”¨æ¡ç›®çš„ï¼ŒDN ç›¸å½“äºå…³ç³»æ•°æ®åº“è¡¨ä¸­çš„å…³é”®å­—ï¼ˆPrimary Keyï¼‰ã€‚å±æ€§ç”±ç±»å‹ï¼ˆTypeï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼ˆValuesï¼‰ç»„æˆï¼Œç›¸å½“äºå…³ç³»æ•°æ®åº“ä¸­çš„å­—æ®µï¼ˆFieldï¼‰ç”±å­—æ®µåå’Œæ•°æ®ç±»å‹ç»„æˆï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿æ£€ç´¢çš„éœ€è¦ï¼ŒLDAP ä¸­çš„ Type å¯ä»¥æœ‰å¤šä¸ª Valueï¼Œè€Œä¸æ˜¯å…³ç³»æ•°æ®åº“ä¸­ä¸ºé™ä½æ•°æ®çš„å†—ä½™æ€§è¦æ±‚å®ç°çš„å„ä¸ªåŸŸå¿…é¡»æ˜¯ä¸ç›¸å…³çš„ã€‚LDAP ä¸­æ¡ç›®çš„ç»„ç»‡ä¸€èˆ¬æŒ‰ç…§åœ°ç†ä½ç½®å’Œç»„ç»‡å…³ç³»è¿›è¡Œç»„ç»‡ï¼Œéå¸¸çš„ç›´è§‚ã€‚LDAP æŠŠæ•°æ®å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œä¸ºæé«˜æ•ˆç‡å¯ä»¥ä½¿ç”¨åŸºäºç´¢å¼•çš„æ–‡ä»¶æ•°æ®åº“ï¼Œè€Œä¸æ˜¯å…³ç³»æ•°æ®åº“ã€‚ç±»å‹çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ mailï¼Œå…¶å€¼å°†æ˜¯ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€ã€‚</p><h2 id="OpenLADP-ç®€ä»‹"><a href="#OpenLADP-ç®€ä»‹" class="headerlink" title="OpenLADP ç®€ä»‹"></a>OpenLADP ç®€ä»‹</h2><p>LDAP å…·æœ‰ä¸¤ä¸ªæ ‡å‡†ï¼Œåˆ†åˆ«æ˜¯ X.500 å’Œ LDAPã€‚OpenLDAP æ˜¯åŸºäº X.500 æ ‡å‡†çš„ï¼Œè€Œä¸”å»é™¤äº† X.500 å¤æ‚çš„åŠŸèƒ½å¹¶ä¸”å¯ä»¥æ ¹æ®è‡ªæˆ‘éœ€æ±‚å®šåˆ¶é¢å¤–æ‰©å±•åŠŸèƒ½ï¼Œä½†ä¸ X.500 ä¹Ÿæœ‰ä¸åŒä¹‹å¤„ï¼Œä¾‹å¦‚ OpenLDAP æ”¯æŒ TCP&#x2F;IP åè®®ç­‰ã€‚</p><p>OpenLDAP å¯ä»¥ç›´æ¥è¿è¡Œåœ¨æ›´ç®€å•å’Œæ›´é€šç”¨çš„ TCP&#x2F;IP æˆ–å…¶ä»–å¯é çš„ä¼ è¾“åè®®å±‚ä¸Šï¼Œé¿å…äº†åœ¨ OSI ä¼šè¯å±‚å’Œè¡¨ç¤ºå±‚çš„å¼€é”€ï¼Œä½¿è¿æ¥çš„å»ºç«‹å’ŒåŒ…çš„å¤„ç†æ›´ç®€å•ã€æ›´å¿«ï¼Œå¯¹äºäº’è”ç½‘å’Œä¼ä¸šç½‘åº”ç”¨æ›´ç†æƒ³ã€‚</p><p>OpenLDAP ç›®å½•ä¸­çš„ä¿¡æ¯æ˜¯ä»¥æ ‘çŠ¶çš„å±‚æ¬¡ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼ˆè¿™å¾ˆç±»åŒäº DNSï¼‰ï¼Œæœ€é¡¶å±‚å³æ ¹éƒ¨ç§°ä½œ â€œåŸºå‡† DNâ€ï¼Œå½¢å¦‚ â€œdc&#x3D;mydomain,dc&#x3D;orgâ€ æˆ–è€… â€œo&#x3D;mydomain.orgâ€ï¼Œå‰ä¸€ç§æ–¹å¼æ›´ä¸ºçµæ´»ä¹Ÿæ˜¯ Windows AD ä¸­ä½¿ç”¨çš„æ–¹å¼ã€‚åœ¨æ ¹ç›®å½•çš„ä¸‹é¢æœ‰å¾ˆå¤šçš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¸ºäº†æŠŠè¿™äº›å¤§é‡çš„æ•°æ®ä»é€»è¾‘ä¸Šåˆ†å¼€ï¼ŒOpenLDAP åƒå…¶å®ƒçš„ç›®å½•æœåŠ¡åè®®ä¸€æ ·ä½¿ç”¨ <code>OU</code>ï¼ˆ<code>Organization Unit</code>ï¼Œç»„ç»‡å•å…ƒï¼‰ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºå…¬å¸å†…éƒ¨æœºæ„ï¼Œå¦‚éƒ¨é—¨ç­‰ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºè®¾å¤‡ã€äººå‘˜ç­‰ã€‚åŒæ—¶ OU è¿˜å¯ä»¥æœ‰å­ OUï¼Œç”¨æ¥è¡¨ç¤ºæ›´ä¸ºç»†è‡´çš„åˆ†ç±»ã€‚</p><p>OpenLDAP ä¸­æ¯ä¸€æ¡è®°å½•éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åŒºåˆ«äºå…¶å®ƒè®°å½•çš„åå­— <code>DN</code>ï¼ˆ<code>Distinguished Name</code>ï¼‰, å…¶å¤„åœ¨ â€œå¶å­â€ ä½ç½®çš„éƒ¨åˆ†ç§°ä½œ RDN (ç”¨æˆ·æ¡ç›®çš„ç›¸å¯¹æ ‡è¯†å)ã€‚å¦‚ dn:cn&#x3D;tom,ou&#x3D;animals,dc&#x3D;ilanni,dc&#x3D;com ä¸­ cn å³ä¸º RDNï¼Œè€Œ RDN åœ¨ä¸€ä¸ª OU ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</p><p>OpenLDAP é»˜è®¤ä»¥ <code>Berkeley DB</code> ä½œä¸ºåç«¯æ•°æ®åº“ï¼ŒBerkeleyDB æ•°æ®åº“ä¸»è¦ä»¥æ•£åˆ—çš„æ•°æ®ç±»å‹è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œå¦‚ä»¥é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ã€‚</p><p><strong>BerkeleyDB æ˜¯ä¸€ç±»ç‰¹æ®Šçš„é¢å‘æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€é¢å‘è¯»å–è¿›è¡Œä¼˜åŒ–çš„æ•°æ®åº“ï¼Œä¸»è¦ç”¨äºæœç´¢ã€æµè§ˆã€æ›´æ–°æŸ¥è¯¢æ“ä½œï¼Œä¸€èˆ¬å¯¹äºä¸€æ¬¡å†™å…¥æ•°æ®ã€å¤šæ¬¡æŸ¥è¯¢å’Œæœç´¢æœ‰å¾ˆå¥½çš„æ•ˆæœ</strong>ã€‚BerkeleyDB ä¸æ”¯æŒäº‹åŠ¡å‹æ•°æ®åº“ (MySQLã€MariDBã€Oracle ç­‰) æ‰€æ”¯æŒçš„é«˜å¹¶å‘çš„ååé‡ä»¥åŠå¤æ‚çš„äº‹åŠ¡æ“ä½œã€‚</p><h2 id="LDAP-ç®€ç§°ç›®å½•"><a href="#LDAP-ç®€ç§°ç›®å½•" class="headerlink" title="LDAP ç®€ç§°ç›®å½•"></a>LDAP ç®€ç§°ç›®å½•</h2><table><thead><tr><th>ç®€ç§°</th><th>å…¨ç§°ï¼ˆå«ä¹‰ï¼‰</th></tr></thead><tbody><tr><td>c</td><td>countryNameï¼ˆå›½å®¶ï¼‰</td></tr><tr><td>dc</td><td>domainComponentï¼ˆåŸŸåï¼‰</td></tr><tr><td>o</td><td>organizationï¼ˆç»„ç»‡ - å…¬å¸ï¼‰</td></tr><tr><td>ou</td><td>organization unitï¼ˆç»„ç»‡å•å…ƒ - éƒ¨é—¨ï¼‰</td></tr><tr><td>sn</td><td>suer nameï¼ˆçœŸå®åç§°ï¼‰</td></tr><tr><td>cn</td><td>common nameï¼ˆå¸¸ç”¨åç§°ï¼‰</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;åœºæ™¯éœ€æ±‚&quot;&gt;&lt;a href=&quot;#åœºæ™¯éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;åœºæ™¯éœ€æ±‚&quot;&gt;&lt;/a&gt;åœºæ™¯éœ€æ±‚&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2020/20200809201834.png&quot; alt=&quot;openldap-architecture&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;tag-plugin note&quot; color=&quot;orange&quot;&gt;&lt;div class=&quot;title&quot;&gt;&lt;strong&gt;éœ€æ±‚&lt;/strong&gt;&lt;/div&gt;&lt;div class=&quot;body&quot;&gt;&lt;p&gt;å½“å…¬å¸ä½“é‡è¾ƒå¤§ï¼Œå†…éƒ¨æœ‰å¤šä¸ªç³»ç»Ÿï¼Œå¦‚æœæ¯ä¸ªå¹³å°éƒ½éœ€è¦ç»´æŠ¤ä¸€ä¸ªç”¨æˆ·ç®¡ç†ä½“ç³»ï¼Œé‚£ä¹ˆå¦‚æœä¸€ä¸ªå‘˜å·¥æ‹¥æœ‰ N ä¸ªå¹³å°æƒé™ç¦»èŒåŠå¸¸è§„æƒé™å˜æ›´ï¼Œå¯¹äºçš„ç®¡ç†æ— ç–‘ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œä¹Ÿæ— æ³•åšåˆ°ç²¾ç»†åŒ–æƒé™ç®¡ç†ã€‚æ¯”å¦‚æ¯æ¬¡æ–°è¿›æˆ–ç¦»èŒä¸€ä½åŒäº‹ï¼Œæˆ‘ä»¬è¿™è¾¹ OPS è¿ç»´ç»„çš„å°ä¼™ä¼´ä»¬ï¼Œéƒ½è¦åœ¨æ¯ä¸ªç³»ç»Ÿä¸Šå»æ·»åŠ ç”¨æˆ·ï¼Œæå¾—å°ä¼™ä¼´ä»¬å¾ˆä¸çˆ½ã€‚&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç®€å•è¯´ä¸€ä¸‹ OPENLDAP å¯¹è¿ç»´ç®¡ç†çš„ä»·å€¼ï¼Œæ”¯æ’‘ä¼ä¸šæŠ€æœ¯å‘å±•æ¯”å¦‚ &lt;code&gt;GITã€ ZABBIXã€ YAPIã€ JUMPSERVERã€ OA&lt;/code&gt; ç­‰å¤§å¤§å°å°ç³»ç»Ÿï¼Œä¹ƒè‡³ Windowsï¼ŒLinux ç³»ç»Ÿçš„è®¤è¯ç™»å½•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ˜è…¾ä¸æ­¢" scheme="https://liei.cc/blog/categories/%E6%8A%98%E8%85%BE%E4%B8%8D%E6%AD%A2/"/>
    
    
    <category term="OpenLDAP" scheme="https://liei.cc/blog/tags/openldap/"/>
    
  </entry>
  
  <entry>
    <title>æ¨¡å—è®¾è®¡æ–‡æ¡£ç¼–å†™è§„èŒƒ</title>
    <link href="https://liei.cc/2019/module-design-doc.html"/>
    <id>https://liei.cc/2019/module-design-doc.html</id>
    <published>2019-11-25T15:15:15.000Z</published>
    <updated>2019-11-25T15:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¨¡å—è´Ÿè´£äºº"><a href="#æ¨¡å—è´Ÿè´£äºº" class="headerlink" title="æ¨¡å—è´Ÿè´£äºº"></a>æ¨¡å—è´Ÿè´£äºº</h2><ul><li><strong>ğŸ‘©â€ğŸ’»</strong> leeifme &#x2F; XXXXé¡¹ç›®</li><li><strong>ğŸš€</strong> XXXXéƒ¨é—¨  &#x2F;  XXXXäº‹ä¸šéƒ¨  </li><li><strong>ğŸ“§</strong> Email <a href="mailto:&#105;&#64;&#x6c;&#x65;&#101;&#x69;&#x66;&#46;&#x6d;&#101;">&#105;&#64;&#x6c;&#x65;&#101;&#x69;&#x66;&#46;&#x6d;&#101;</a></li></ul><h2 id="ç‰ˆæœ¬å†å²è®°å½•-History-ï¼ˆå¯é€‰ï¼‰"><a href="#ç‰ˆæœ¬å†å²è®°å½•-History-ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="ç‰ˆæœ¬å†å²è®°å½•(History) ï¼ˆå¯é€‰ï¼‰"></a>ç‰ˆæœ¬å†å²è®°å½•(History) ï¼ˆå¯é€‰ï¼‰</h2><blockquote><p>  è®¾è®¡ç¨¿ç‰ˆæœ¬æ¯å‘ç”Ÿä¸€æ¬¡æ¯”è¾ƒå¤§çš„è¿­ä»£æ›´æ–°ï¼Œéƒ½è¦è®°å½•åœ¨ç‰ˆæœ¬å†å²è®°å½•é‡Œï¼Œç›¸æ¯”ä¸€ä¸ªä¸ªå»ç¿»ä»¥å‰çš„è®¾è®¡ç¨¿ï¼Œç‰ˆæœ¬å†å²è®°å½•å¯ä»¥æ¸…æ™°åœ°å±•ç°è®¾è®¡ç¨¿çš„è¿­ä»£å†ç¨‹ï¼Œæœ‰å“ªäº›éœ€æ±‚çš„å˜åŠ¨ï¼Œæœ‰å“ªäº›è®¾è®¡æ—¶æ²¡æ€è€ƒæ¸…æ¥šéœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼ŒReview æ—¶å¤§å®¶ç»™å‡ºäº†å“ªäº›æ„è§å’Œå»ºè®®ç­‰ã€‚æœ‰æ—¶ç‰ˆæœ¬éœ€è¦å›æ»šï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°è¿½æº¯ï¼Œè€Œé¡¹ç›®ç»“æŸåæµè§ˆè¿™ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°è‡ªå·±çš„è®¾è®¡åœ¨å“ªäº›æ–¹é¢ä¸€å¼€å§‹æ€è€ƒä¸è¶³å‡ºç°äº†å„ç§é—®é¢˜ï¼Œæ˜¯å¦‚ä½•è¢«å‘ç°ã€æ”¹è¿›å’Œæå‡çš„ï¼Œä¸‹ä¸€æ¬¡è®¾è®¡çš„æ—¶å€™æ˜¯å¦å¯ä»¥æ›´æ—©åœ°æ€è€ƒåˆ°å’Œå›é¿æ‰</p></blockquote><h2 id="æ’æœŸ-Schedule-ï¼ˆå¯é€‰ï¼‰"><a href="#æ’æœŸ-Schedule-ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æ’æœŸ(Schedule) ï¼ˆå¯é€‰ï¼‰"></a>æ’æœŸ(Schedule) ï¼ˆå¯é€‰ï¼‰</h2><blockquote><p>  å’Œéœ€æ±‚æ–¹ç¡®è®¤å„é˜¶æ®µäº¤ä»˜çš„æ—¶é—´èŠ‚ç‚¹ï¼Œåˆ¶å®šå®Œæˆæ¨¡å—è®¾è®¡çš„å…·ä½“è®¡åˆ’ï¼Œæ¯ä¸ªé˜¶æ®µå¤§æ¦‚åšå“ªäº›å·¥ä½œï¼Œä»€ä¹ˆæ—¶å€™å†…éƒ¨ Reviewï¼Œä»€ä¹ˆæ—¶å€™å’Œé¡¹ç›®ç»„ Review ç­‰ã€‚ç¡®ä¿è®¾è®¡ä»¥ä¸€ä¸ªåˆç†çš„èŠ‚å¥å±•å¼€ï¼Œå¯ä»¥ä»¥è¾ƒé«˜çš„è´¨é‡æŒ‰æ—¶äº¤ä»˜</p></blockquote><h2 id="æ¨¡å—æ¦‚è¿°-Background"><a href="#æ¨¡å—æ¦‚è¿°-Background" class="headerlink" title="æ¨¡å—æ¦‚è¿°(Background)"></a>æ¨¡å—æ¦‚è¿°(Background)</h2><blockquote><p>  è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹åœ¨å¼€å‘è€…å’Œ PMã€ä¸šåŠ¡æ–¹å……åˆ†æ²Ÿé€šéœ€æ±‚ä¹‹åå®Œæˆ </p></blockquote><ul><li><strong>æ¨¡å—æè¿°ï¼Œè¦è®¾è®¡çš„äº§å“æ˜¯ä»€ä¹ˆï¼Œè§£å†³ä»€ä¹ˆä¸šåŠ¡éœ€æ±‚</strong></li><li>ä¸šåŠ¡ &#x2F; äº§å“ç°çŠ¶ï¼Œæ€»ç»“éœ€æ±‚æ–¹ç°åœ¨é¢ä¸´çš„ä¸»è¦é—®é¢˜ </li><li><strong>åŠŸèƒ½è®¾è®¡ï¼Œæ¨¡å—å¼€å‘å…³é”®ç‚¹ä»¥åŠä¸šåŠ¡é€»è¾‘æè¿°</strong></li><li>éœ€è¦è®¾è®¡ä»€ä¹ˆæ–°çš„åŠŸèƒ½ï¼Œéœ€è¦ä¼˜åŒ–å“ªäº›å·²æœ‰çš„è®¾è®¡ </li><li>æé«˜æ¨¡å—å“ªäº›ä½¿ç”¨ç¯èŠ‚çš„ä½“éªŒï¼Œå¼•å¯¼ç”¨æˆ·åšå‡ºä»€ä¹ˆæ“ä½œ</li></ul><h2 id="æ¨¡å—è¯¦ç»†è®¾è®¡"><a href="#æ¨¡å—è¯¦ç»†è®¾è®¡" class="headerlink" title="æ¨¡å—è¯¦ç»†è®¾è®¡"></a>æ¨¡å—è¯¦ç»†è®¾è®¡</h2><blockquote><p>  è¯¦ç»†æè¿°æ¨¡å—å®ç°çš„æ¶æ„åˆ†æï¼Œé‡‡ç”¨çš„æ¡†æ¶ã€æŠ€æœ¯æ ˆé€‰å‹ï¼Œä»¥åŠå®ç°ç®—æ³•ç­‰</p></blockquote><ul><li><strong>ä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡</strong>ï¼šé‡‡ç”¨çš„æ¡†æ¶ã€ä»€ä¹ˆå­˜å‚¨æœåŠ¡ã€æ•°æ®åº“ã€é˜Ÿåˆ—ç­‰ç­‰çš„ä¸€äº›æœåŠ¡ï¼Œä»¥åŠå¯èƒ½éœ€è¦ç”¨åˆ°çš„ç®—æ³•</li><li><strong>ç¨‹åºé€»è¾‘æè¿°</strong>ï¼šæœ‰ä»€ä¹ˆæ ·çš„äº¤äº’é€»è¾‘ï¼Œå¤„ç†æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæ˜¯ä¸æ˜¯æœ‰å¼‚æ­¥å¤„ç†ä»»åŠ¡åˆæ˜¯æ€æ ·åšçš„</li><li><strong>æ•°æ®ç»“æ„å®šä¹‰</strong>ï¼šç¨‹åºå†…éƒ¨ä¸»è¦ç”¨åˆ°çš„æ•°æ®ç»“æ„ã€æ•°æ®åº“è¡¨è®¾è®¡ã€ç´¢å¼•è®¾è®¡</li><li><strong>ç»“æ„ &#x2F; æ¶æ„å›¾</strong>ï¼šæ ¹æ®ä½¿ç”¨äº†ä»€ä¹ˆæœåŠ¡ã€æœ‰ä»€ä¹ˆæ ·çš„è°ƒç”¨æµç¨‹ã€æˆ–è€…æ˜¯ç¨‹åºé‡Œé¢æœ‰ä»€ä¹ˆæ ·çš„ç»“æ„å’Œæµç¨‹éœ€è¦ç”»çš„å›¾<ul><li><a href="http://naotu.baidu.com/">ç™¾åº¦è„‘å›¾</a></li><li><a href="https://www.processon.com/">Process On</a></li></ul></li></ul><p><code>è¿™äº›æ¡†æ¶ã€è®¾è®¡éƒ½éœ€ç»è¿‡å¯è¡Œæ€§åˆ†æï¼Œå¿…é¡»æ˜¯å¯è¡Œçš„</code></p><h2 id="æ¥å£è®¾è®¡æ–‡æ¡£-Interface"><a href="#æ¥å£è®¾è®¡æ–‡æ¡£-Interface" class="headerlink" title="æ¥å£è®¾è®¡æ–‡æ¡£(Interface)"></a>æ¥å£è®¾è®¡æ–‡æ¡£(Interface)</h2><blockquote><p>  ä¸»è¦å‚è€ƒ <code>Swagger</code>æ–‡æ¡£ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œè¿™é‡Œåªåšä¸€äº›è¡¥å……è¯´æ˜ï¼Œç”¨æ¥è¯´æ˜è°ƒç”¨æ­¤æ¥å£éœ€è¦æ³¨æ„çš„äº‹é¡¹(æ²¡æœ‰å¯ä¸å†™)</p></blockquote><h2 id="åŸå‹è®¾è®¡ï¼ˆå¯é€‰ï¼‰"><a href="#åŸå‹è®¾è®¡ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="åŸå‹è®¾è®¡ï¼ˆå¯é€‰ï¼‰"></a>åŸå‹è®¾è®¡ï¼ˆå¯é€‰ï¼‰</h2><blockquote><p>åŸå‹è®¾è®¡ä¹‹äºåº”ç”¨å¼€å‘ï¼Œæ˜¯ä¸ºç¬¬ä¸€è¦ç´ ã€‚å®ƒæ‰€èµ·åˆ°çš„ä¸ä»…æ˜¯æ²Ÿé€šçš„ä½œç”¨ï¼Œæ›´æœ‰ä½“ç°ä¹‹æ•ˆã€‚é€šè¿‡å†…å®¹å’Œç»“æ„å±•ç¤ºï¼Œä»¥åŠç²—ç•¥å¸ƒå±€ï¼Œèƒ½å¤Ÿè¯´æ˜ç”¨æˆ·å°†å¦‚ä½•ä¸äº§å“è¿›è¡Œäº¤äº’ ã€‚ä¹Ÿèƒ½æ›´ç›´è§‚çš„ä½“ç°å‡ºæ‰€è®¾è®¡æ¨¡å—çš„åŸºæœ¬åŠŸèƒ½å’Œäº¤äº’æ–¹å¼ï¼Œä½“ç°å¼€å‘è€…åŠUIè®¾è®¡å¸ˆçš„ideaï¼Œä½“ç°ç”¨æˆ·æ‰€æœŸæœ›çœ‹åˆ°çš„å†…å®¹ï¼Œä½“ç°å†…å®¹ç›¸å¯¹ä¼˜å…ˆçº§ç­‰ </p></blockquote><ul><li><a href="https://modao.cc/">å¢¨åˆ€</a></li><li><a href="https://www.mockplus.cn/">æ‘¹å®¢</a></li><li><a href="https://www.axure.com.cn/">Axure RP</a></li></ul><h2 id="æµ‹è¯•è¦ç‚¹ï¼ˆå¯é€‰ï¼‰"><a href="#æµ‹è¯•è¦ç‚¹ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æµ‹è¯•è¦ç‚¹ï¼ˆå¯é€‰ï¼‰"></a>æµ‹è¯•è¦ç‚¹ï¼ˆå¯é€‰ï¼‰</h2><blockquote><p>  ç»™å‡ºæµ‹è¯•æ¨¡å—çš„ä¸»è¦æµ‹è¯•è¦æ±‚ï¼Œå’Œé€»è¾‘æ“ä½œ</p></blockquote><p><code>æ³¨æ˜ï¼š</code> ä»¥ä¸Šè®¾è®¡è§„èŒƒåªæ˜¯é€šç”¨è®¾è®¡è¦æ±‚ï¼Œå…·ä½“è§†æ¨¡å—åŠŸèƒ½è¦æ±‚åšå…·ä½“æ”¹åŠ¨</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ¨¡å—è´Ÿè´£äºº&quot;&gt;&lt;a href=&quot;#æ¨¡å—è´Ÿè´£äºº&quot; class=&quot;headerlink&quot; title=&quot;æ¨¡å—è´Ÿè´£äºº&quot;&gt;&lt;/a&gt;æ¨¡å—è´Ÿè´£äºº&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ğŸ‘©â€ğŸ’»&lt;/strong&gt; leeifme &amp;#x2F; XXXXé¡¹ç›®&lt;/li&gt;
&lt;l</summary>
      
    
    
    
    <category term="è®¾è®¡å¼€å‘" scheme="https://liei.cc/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="è§„èŒƒå»ºè®®" scheme="https://liei.cc/blog/tags/%E8%A7%84%E8%8C%83%E5%BB%BA%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»º Airflow ä»»åŠ¡è°ƒåº¦ç¯å¢ƒ</title>
    <link href="https://liei.cc/2019/deploy-airflow.html"/>
    <id>https://liei.cc/2019/deploy-airflow.html</id>
    <published>2019-08-25T15:15:15.000Z</published>
    <updated>2019-08-25T15:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h2><h3 id="å…³é—­é˜²ç«å¢™å’Œ-selinux"><a href="#å…³é—­é˜²ç«å¢™å’Œ-selinux" class="headerlink" title="å…³é—­é˜²ç«å¢™å’Œ selinux"></a>å…³é—­é˜²ç«å¢™å’Œ selinux</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">setenforce 0 </span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=.*/SELINUX=disabled/g&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²-Python-3-X"><a href="#éƒ¨ç½²-Python-3-X" class="headerlink" title="éƒ¨ç½² Python 3.X"></a>éƒ¨ç½² Python 3.X</h3><ul><li><p>ä¾èµ–åŒ…å®‰è£…</p><p>Python å®‰è£…ä¼šä¾èµ–ä¸€äº›ç¯å¢ƒï¼Œä¸ºäº†é¿å…åœ¨å®‰è£…è¿‡ç¨‹ä¸­å› ä¸ºç¼ºå°‘ä¾èµ–è€Œäº§ç”Ÿä¸å¿…è¦çš„éº»çƒ¦ï¼Œéœ€è¦å…ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿å®‰è£…å¥½ä»¥ä¸‹ä¾èµ–åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install zlib zlib-devel</span><br><span class="line">yum -y install bzip2 bzip2-devel</span><br><span class="line">yum -y install ncurses ncurses-devel</span><br><span class="line">yum -y install readline readline-devel</span><br><span class="line">yum -y install openssl openssl-devel</span><br><span class="line">yum -y install openssl-static</span><br><span class="line">yum -y install xz lzma xz-devel</span><br><span class="line">yum -y install sqlite sqlite-devel</span><br><span class="line">yum -y install gdbm gdbm-devel</span><br><span class="line">yum -y install tk tk-devel</span><br><span class="line">yum -y install libffi-devel <span class="comment"># åªæœ‰ 3.7 æ‰ä¼šç”¨åˆ°è¿™ä¸ªåŒ…ï¼Œå¦‚æœä¸å®‰è£…è¿™ä¸ªåŒ…çš„è¯ï¼Œåœ¨ make é˜¶æ®µä¼šå‡ºç°å¦‚ä¸‹çš„æŠ¥é”™ï¼šModuleNotFoundError: No module named &#x27;_ctypes&#x27;</span></span><br><span class="line">yum install gcc</span><br><span class="line">yum install wget</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… pipï¼Œå› ä¸º CentOs æ˜¯æ²¡æœ‰ pip çš„</span></span><br><span class="line"><span class="comment">#è¿è¡Œè¿™ä¸ªå‘½ä»¤æ·»åŠ epelæ‰©å±•æº </span></span><br><span class="line">yum -y install epel-release </span><br><span class="line"><span class="comment">#å®‰è£…pip </span></span><br><span class="line">yum install python-pip</span><br></pre></td></tr></table></figure></li><li><p>Python æºç ä¸‹è½½</p><p>å¯ä»¥å‰å¾€ <a href="https://www.python.org/ftp/python/">https://www.python.org/ftp/python/</a> æŸ¥çœ‹ Python å„ä¸ªç‰ˆæœ¬</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz</span><br></pre></td></tr></table></figure></li></ul><p>çŸ¥è¯†ç‚¹è¡¥å……ï¼šå¦‚æœä¸çŸ¥é“ <code>configure, make, make install</code> ä¸‰ä¸ªå‘½ä»¤ä½œç”¨ï¼Œ<a href="https://www.cnblogs.com/tinywan/p/7230039.html">ç‚¹è¿™é‡ŒæŸ¥çœ‹</a></p><p><strong>å®‰è£… Python</strong></p><ul><li><p>è§£å‹ç¼©</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -zxvf Python-3.7.0.tgz</span><br></pre></td></tr></table></figure></li><li><p>è¿›å…¥è§£å‹åçš„ç›®å½•ï¼Œä¾æ¬¡æ‰§è¡Œä¸‹é¢å‘½ä»¤è¿›è¡Œæ‰‹åŠ¨ç¼–è¯‘</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure prefix=/usr/local/python3 <span class="comment"># æŒ‡å®šç›®å½•</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ€åæ²¡æç¤ºå‡ºé”™ï¼Œå°±ä»£è¡¨æ­£ç¡®å®‰è£…äº†</p></li><li><p>æ·»åŠ è½¯é“¾æ¥</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åšå¥½åŸå§‹æ•°æ®çš„å¤‡ä»½</span></span><br><span class="line"><span class="built_in">mv</span> /usr/bin/python /usr/bin/python2.backup </span><br><span class="line"><span class="built_in">mv</span> /usr/bin/pip /usr/bin/pip2.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è½¯è¿æ¥</span></span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/python3/bin/python3.7 /usr/bin/python</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/python3/bin/pip3.7 /usr/bin/pip</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æµ‹</span></span><br><span class="line">python -V</span><br><span class="line">pip -V</span><br></pre></td></tr></table></figure></li><li><p>ä¿è¯ç³»ç»Ÿå¯ç”¨</p><p>æ›´æ”¹ yum é…ç½®ï¼Œå› ä¸ºå…¶è¦ç”¨åˆ° python2 æ‰èƒ½æ‰§è¡Œï¼Œå¦åˆ™ä¼šå¯¼è‡´ yum ä¸èƒ½æ­£å¸¸ä½¿ç”¨ï¼ˆä¸ç®¡å®‰è£… python3 çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œéƒ½å¿…é¡»è¦åšçš„ï¼‰</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŠŠ #! /usr/bin/python ä¿®æ”¹ä¸º #! /usr/bin/python2 </span></span><br><span class="line"><span class="string">vi</span> <span class="string">/usr/bin/yum</span> </span><br><span class="line"><span class="string">vi</span> <span class="string">/usr/libexec/urlgrabber-ext-down</span> </span><br></pre></td></tr></table></figure></li></ul><h3 id="éƒ¨ç½²-PostgreSQL"><a href="#éƒ¨ç½²-PostgreSQL" class="headerlink" title="éƒ¨ç½² PostgreSQL"></a>éƒ¨ç½² PostgreSQL</h3><ul><li><p>å®‰è£… PostgreSQL ä»“åº“</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…å®¢æˆ·ç«¯</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install postgresql10</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…æœåŠ¡ç«¯</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install postgresql10-server</span><br></pre></td></tr></table></figure></li><li><p>åŠ å…¥å¼€æœºå¯åŠ¨é¡¹</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ systemctl <span class="built_in">enable</span> postgresql-10.service</span><br></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ–æ•°æ®åº“</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ /usr/pgsql-10/bin/postgresql-10-setup initdb</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨æ•°æ®åº“æœåŠ¡</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ systemctl start postgresql-10</span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥è¿è¡ŒçŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ systemctl status postgresql-10</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®ç”¨æˆ·å¯†ç </p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ su - postgres</span><br><span class="line">Last login: Mon Aug  5 11:09:14 CST 2019 on pts/0</span><br><span class="line"><span class="comment"># é»˜è®¤ç”¨æˆ·postgres</span></span><br><span class="line">-bash-4.2$ psql</span><br><span class="line">psql (10.9)</span><br><span class="line">Type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">postgres=<span class="comment"># \password</span></span><br><span class="line"><span class="comment"># è®¾ç½®å¯†ç ä¸º &#x27;******&#x27;</span></span><br><span class="line">Enter new password:</span><br><span class="line">Enter it again:</span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡º</span></span><br><span class="line">postgres=<span class="comment"># \q</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ç›‘å¬åœ°å€</p><p><code>vi /var/lib/pgsql/10/data/postgresql.conf </code></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">listen_addresses = <span class="string">&#x27;*&#x27;</span></span><br><span class="line"><span class="comment">#listen_addresses = &#x27;localhost&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹å®¢æˆ·ç«¯è®¤è¯æ–¹å¼</p><p><code>vi /var/lib/pgsql/10/data/pg_hba.conf</code></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># replication privilege.</span></span><br><span class="line"><span class="comment">#local   replication     all                                     peer</span></span><br><span class="line"><span class="comment">#host    replication     all             127.0.0.1/32            ident</span></span><br><span class="line"><span class="comment">#host    replication     all             ::1/128                 ident</span></span><br><span class="line">host    all     all             0.0.0.0/0                 md5</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯æœåŠ¡</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ systemctl restart postgresql-10</span><br></pre></td></tr></table></figure></li><li><p>è¿æ¥æµ‹è¯•</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ psql -h 192.168.1.2 -U postgres</span><br></pre></td></tr></table></figure></li></ul><h3 id="éƒ¨ç½²-RabbitMQ"><a href="#éƒ¨ç½²-RabbitMQ" class="headerlink" title="éƒ¨ç½² RabbitMQ"></a>éƒ¨ç½² RabbitMQ</h3><p><strong>å®‰è£… Erlang</strong></p><p>RabbitMQ æ˜¯ä½¿ç”¨ Erlang å¼€å‘çš„ï¼Œæ‰€ä»¥éœ€è¦é¦–å…ˆå®‰è£… Erlangï¼Œæœ¬æ–‡å®‰è£…å…¶æœ€æ–°ç‰ˆæœ¬</p><ul><li><p>æ·»åŠ  repo æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ vi /etc/yum.repos.d/rabbitmq_erlang.repo</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[rabbitmq_erlang]</span><br><span class="line">name=rabbitmq_erlang</span><br><span class="line">baseurl=https://packagecloud.io/rabbitmq/erlang/el/7/<span class="variable">$basearch</span></span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packagecloud.io/rabbitmq/erlang/gpgkey</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br><span class="line"></span><br><span class="line">[rabbitmq_erlang-source]</span><br><span class="line">name=rabbitmq_erlang-source</span><br><span class="line">baseurl=https://packagecloud.io/rabbitmq/erlang/el/7/SRPMS</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packagecloud.io/rabbitmq/erlang/gpgkey</span><br><span class="line">sslverify=1</span><br><span class="line">sslcacert=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">metadata_expire=300</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum -y install erlang socat</span><br></pre></td></tr></table></figure></li></ul><p><strong>å®‰è£… RabbitMQ</strong></p><ul><li><p>ä¸‹è½½ RPM åŒ…ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.17/rabbitmq-server-3.7.17-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥ GPG keyï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… RabbitMQï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ rpm -Uvh rabbitmq-server-3.7.17-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ RabbitMQï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ RabbitMQ è¿è¡ŒçŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ systemctl status rabbitmq-server</span><br></pre></td></tr></table></figure></li><li><p>å°† RabbitMQ åŠ å…¥å¼€æœºè‡ªå¯åŠ¨ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ systemctl <span class="built_in">enable</span> rabbitmq-server</span><br></pre></td></tr></table></figure></li></ul><p><strong>RabbitMQ é…ç½®</strong></p><ul><li><p>å¯ç”¨ RabbitMQ ç½‘é¡µç®¡ç†æ’ä»¶</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·å¹¶æˆæƒï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ rabbitmqctl add_user admin ä½ çš„å¯†ç </span><br><span class="line">$ rabbitmqctl set_user_tags admin administrator</span><br><span class="line">$ rabbitmqctl set_permissions -p / admin <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure></li></ul><p>åœ¨æµè§ˆå™¨è®¿é—® <a href="http://ip:15672/">http://IP:15672</a> å³å¯è¿›å…¥åˆ° RabbitMQ ç½‘é¡µç®¡ç†é¡µé¢</p><h2 id="éƒ¨ç½²-Airflow"><a href="#éƒ¨ç½²-Airflow" class="headerlink" title="éƒ¨ç½² Airflow"></a>éƒ¨ç½² Airflow</h2><h3 id="é€šè¿‡-pip-å®‰è£…-airflow-è„šæ‰‹æ¶"><a href="#é€šè¿‡-pip-å®‰è£…-airflow-è„šæ‰‹æ¶" class="headerlink" title="é€šè¿‡ pip å®‰è£… airflow è„šæ‰‹æ¶"></a>é€šè¿‡ pip å®‰è£… airflow è„šæ‰‹æ¶</h3><p>å®‰è£…ä¹‹å‰éœ€è¦è®¾ç½®ä¸€ä¸‹ä¸´æ—¶ç¯å¢ƒå˜é‡ <code>SLUGIFY_USES_TEXT_UNIDECODE</code> ï¼Œä¸ç„¶ï¼Œä¼šå¯¼è‡´å®‰è£…å¤±è´¥ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> SLUGIFY_USES_TEXT_UNIDECODE=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><ul><li><p>å®‰è£… airflow è„šæ‰‹æ¶:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo pip install apache-airflow===1.10.4</span><br></pre></td></tr></table></figure><p>airflow ä¼šè¢«å®‰è£…åˆ° python3 ä¸‹çš„ site-packages ç›®å½•ä¸‹ï¼Œå®Œæ•´ç›®å½•ä¸º:<code>$&#123;PYTHON_HOME&#125;/lib/python3.6/site-packages/airflow</code>ï¼Œæˆ‘çš„ airflow ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@n71 airflow]<span class="comment"># pwd</span></span><br><span class="line">/usr/local/python3/lib/python3.7/site-packages/airflow</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ ç¯å¢ƒå˜é‡</p><p><code>vi ~/.bash_profile</code></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># User specific environment and startup programs</span></span><br><span class="line">AIRFLOW_HOME=/home/airflow</span><br><span class="line">SITE_AIRFLOW_HOME=/usr/local/python3/lib/python3.7/site-packages/airflow</span><br><span class="line">PYTHON3=/usr/local/python3</span><br><span class="line"></span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:<span class="variable">$SITE_AIRFLOW_HOME</span>/bin:<span class="variable">$PYTHON3</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> AIRFLOW_HOME</span><br><span class="line"><span class="built_in">export</span> SITE_AIRFLOW_HOME</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"><span class="built_in">export</span> C_FORCE_ROOT=<span class="literal">true</span> </span><br></pre></td></tr></table></figure><p>ä½¿ä¿®æ”¹åçš„ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š<code>sudo source /etc/profile</code></p></li></ul><h3 id="Airflow-ç›¸å…³æ“ä½œ"><a href="#Airflow-ç›¸å…³æ“ä½œ" class="headerlink" title="Airflow ç›¸å…³æ“ä½œ"></a>Airflow ç›¸å…³æ“ä½œ</h3><ul><li><p>æ‰§è¡Œ <code>airflow</code> å‘½ä»¤åšåˆå§‹åŒ–æ“ä½œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">airflow</span><br></pre></td></tr></table></figure><p>airflow ä¼šåœ¨åˆšåˆšçš„ <code>AIRFLOW_HOME</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€äº›æ–‡ä»¶ã€‚å½“ç„¶ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤æ—¶å¯èƒ½ä¼šæŠ¥ä¸€äº›é”™è¯¯ï¼Œå¯ä»¥ä¸ç”¨ç†ä¼šï¼ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@n71 airflow]<span class="comment"># ls</span></span><br><span class="line">airflow.cfg  logs  unittests.cfg</span><br></pre></td></tr></table></figure></li><li><p>ä¸º <code>airflow</code> å®‰è£…ä¾èµ–æ¨¡å—</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pip install <span class="string">&#x27;apache-airflow[postgres,celery,hive,rabbitmq]&#x27;</span></span><br></pre></td></tr></table></figure><p>airflow çš„åŒ…ä¾èµ–å®‰è£…å‡å¯é‡‡ç”¨è¯¥æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå…·ä½“å¯å‚è€ƒ <a href="https://link.juejin.im/?target=https://airflow.apache.org/installation.html">airflow å®˜æ–¹æ–‡æ¡£</a></p></li></ul><h3 id="é‡åˆ°çš„å‘ä»¥åŠè§£å†³æ–¹æ¡ˆ"><a href="#é‡åˆ°çš„å‘ä»¥åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="é‡åˆ°çš„å‘ä»¥åŠè§£å†³æ–¹æ¡ˆ"></a><strong>é‡åˆ°çš„å‘ä»¥åŠè§£å†³æ–¹æ¡ˆ</strong></h3><ul><li><p><strong>ä¸º <code>airflow</code> å®‰è£… [rabbitmq] ä¾èµ–æ¨¡å—æŠ¥é”™</strong></p><p>å…·ä½“å¯ä»¥å‚çœ‹è¿™ä¸ª <code>repositories</code> <a href="https://github.com/celery/librabbitmq">https://github.com/celery/librabbitmq</a></p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/celery/librabbitmq.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> librabbitmq</span><br><span class="line"></span><br><span class="line">checkout 1.6</span><br><span class="line"></span><br><span class="line">yum install install autoconf automake libtool</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å®‰è£…ä¾èµ–æ¨¡å—</span></span><br><span class="line">pip install <span class="string">&#x27;apache-airflow[rabbitmq]&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å¯åŠ¨ webserver ç»„ä»¶æ—¶æŠ¥é”™</strong></p><p>é”™ä½å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Error: <span class="string">&#x27;python:airflow.www.gunicorn_config&#x27;</span> doesnâ€˜t exist</span><br></pre></td></tr></table></figure><p>æˆ–è€…æ˜¯ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">FileNotFoundError: [Errno 2] No such file or directory: <span class="string">&#x27;gunicorn&#x27;</span>: <span class="string">&#x27;gunicorn&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1 :  æ·»åŠ è½¯è¿æ¥</span></span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/python3/bin/gunicorn /usr/bin/gunicorn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2  :  æ·»åŠ  python ç¯å¢ƒå˜é‡</span></span><br><span class="line">PYTHON3=/usr/local/python3</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:<span class="variable">$SITE_AIRFLOW_HOME</span>/bin:<span class="variable">$PYTHON3</span>/bin</span><br></pre></td></tr></table></figure></li><li><p><strong><code>airflow worker</code> è§’è‰²ä¸èƒ½ä½¿ç”¨ root å¯åŠ¨</strong></p><p>&#x3D;&#x3D;åŸå› ï¼šä¸èƒ½ç”¨æ ¹ç”¨æˆ·å¯åŠ¨çš„æ ¹æœ¬åŸå› ï¼Œåœ¨äº airflow çš„ worker ç›´æ¥ç”¨çš„ celeryï¼Œè€Œ celery æºç ä¸­æœ‰å‚æ•°é»˜è®¤ä¸èƒ½ä½¿ç”¨ ROOT å¯åŠ¨ï¼Œå¦åˆ™å°†æŠ¥é”™ï¼š&#x3D;&#x3D;</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">C_FORCE_ROOT = os.environ.get(<span class="string">&#x27;C_FORCE_ROOT&#x27;</span>, False)</span><br><span class="line">    </span><br><span class="line">ROOT_DISALLOWED = <span class="string">&quot;&quot;</span><span class="string">&quot;\</span></span><br><span class="line"><span class="string">Running a worker with superuser privileges when the</span></span><br><span class="line"><span class="string">worker accepts messages serialized with pickle is a very bad idea!</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">If you really want to continue then you have to set the C_FORCE_ROOT</span></span><br><span class="line"><span class="string">environment variable (but please think about this before you do).</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">User information: uid=&#123;uid&#125; euid=&#123;euid&#125; gid=&#123;gid&#125; egid=&#123;egid&#125;</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">ROOT_DISCOURAGED = <span class="string">&quot;&quot;</span><span class="string">&quot;\</span></span><br><span class="line"><span class="string">You&#x27;re running the worker with superuser privileges: this is</span></span><br><span class="line"><span class="string">absolutely not recommended!</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">Please specify a different user using the --uid option.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">User information: uid=&#123;uid&#125; euid=&#123;euid&#125; gid=&#123;gid&#125; egid=&#123;egid&#125;</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡,  å¼ºåˆ¶celery workerè¿è¡Œé‡‡ç”¨rootæ¨¡å¼</span></span><br><span class="line"> <span class="built_in">export</span> C_FORCE_ROOT=True</span><br></pre></td></tr></table></figure></li><li><p><strong><code>airflow remote worker log hostname</code> é—®é¢˜</strong></p><p>å½“ worker èŠ‚ç‚¹ä¸æ˜¯è·Ÿ webserver éƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨çš„æ—¶å€™ï¼Œæœ‰æ—¶ä» webserver æŸ¥çœ‹è¯¥ worker èŠ‚ç‚¹æ—¥å¿—ï¼Œå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">*** Log file isn<span class="string">&#x27;t local.</span></span><br><span class="line"><span class="string">*** Fetching here: http://n73:8793/log/.../1.log</span></span><br><span class="line"><span class="string">*** Failed to fetch log file from worker. HTTPConnectionPool(host=&#x27;</span>kaimanas.serveriai.lt<span class="string">&#x27;, port=8793): Max retries exceeded with url: /log/.../1.log (Caused by NewConnectionError(&#x27;</span>&lt;urllib3.connection.HTTPConnection object at <span class="number">0x7f64da2fab38</span>&gt;: Failed to establish a <span class="built_in">new</span> connection: [Errno <span class="number">111</span>] Connection refused<span class="string">&#x27;,))</span></span><br></pre></td></tr></table></figure><p>n73 (æˆ–æ˜¯å…¶ä»–) ä¸æ˜¯ webserver èŠ‚ç‚¹æ‰€åœ¨çš„ hostname</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>é…ç½® worker èŠ‚ç‚¹çš„ <code>/etc/hosts</code> çš„ hostname æ˜ å°„ï¼ŒæŠŠ worker èŠ‚ç‚¹çš„ ip æ˜ å°„ä¸ºæœ¬æœºçš„ hostnameï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">192.168.50.71 n71</span><br><span class="line">192.168.50.72 n72</span><br><span class="line">192.168.50.73 n73</span><br></pre></td></tr></table></figure></li></ul><h2 id="é…ç½®-airflow-cfg"><a href="#é…ç½®-airflow-cfg" class="headerlink" title="é…ç½® airflow.cfg"></a>é…ç½® airflow.cfg</h2><ul><li><p>ä¿®æ”¹ Executor ä¸º CeleryExecutor</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">executor = CeleryExecutor</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šå…ƒæ•°æ®åº“ï¼ˆmetestore)</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">sql_alchemy_conn = postgresql+psycopg2:<span class="comment">//postgres:postgres@192.168.50.73:5432/airflow</span></span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®ä¸­é—´äººï¼ˆbroker)</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">broker_url = amqp:<span class="comment">//admin:datatom.com@192.168.50.73:5672/</span></span><br></pre></td></tr></table></figure></li><li><p>è®¾å®šç»“æœå­˜å‚¨åç«¯ backend</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">celery_result_backend = db+postgres:<span class="comment">//postgres:postgres@192.168.50.73:5432/airflow</span></span><br><span class="line">result_backend = db+postgres:<span class="comment">//stork:stork@192.168.50.73:14103/airflow</span></span><br></pre></td></tr></table></figure></li><li><p>ç½® dags åˆå§‹åŒ–åä¸ºæš‚åœçŠ¶æ€(å¯åŠ¨çŠ¶æ€)</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dags_are_paused_at_creation = True(False)</span><br></pre></td></tr></table></figure></li><li><p>ä¸å¼•ç”¨å®ä¾‹è„šæœ¬</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">load_examples = False</span><br></pre></td></tr></table></figure></li><li><p>å½“å®šä¹‰çš„ dag æ–‡ä»¶è¿‡å¤šçš„æ—¶å€™ï¼Œairflow çš„ scheduler èŠ‚ç‚¹è¿è¡Œæ•ˆç‡ç¼“æ…¢</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">[scheduler]</span><br><span class="line"># The scheduler can run multiple threads in parallel to schedule dags.</span><br><span class="line"># This defines how many threads will run.</span><br><span class="line">#é»˜è®¤æ˜¯<span class="number">2</span>è¿™é‡Œæ”¹ä¸º<span class="number">50</span></span><br><span class="line">max_threads = <span class="number">30</span></span><br><span class="line"></span><br><span class="line">worker_concurrency = <span class="number">5</span></span><br><span class="line">worker_max_tasks_per_child = <span class="number">10</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æ£€æµ‹æ–° DAG é—´éš”ï¼Œå¦‚æœ scheduler æ£€æµ‹ DAG è¿‡äºé¢‘ç¹ï¼Œä¼šå¯¼è‡´ CPU è´Ÿè½½éå¸¸é«˜ã€‚è€Œé»˜è®¤ scheduler æ£€æµ‹æ—¶é—´ä¸º 0ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ—¶é—´é—´éš”</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">min_file_process_interval = <span class="number">5</span></span><br></pre></td></tr></table></figure></li><li><p>å®šæœŸåˆ·æ–° DAG å®šä¹‰ç›®å½•ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼Œé»˜è®¤300s</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dag_dir_list_interval = <span class="number">10</span></span><br></pre></td></tr></table></figure></li><li><p>Airflow çš„ DAG å¹¶è¡Œåº¦æ§åˆ¶</p><p><code>dag_concurrency</code>ï¼šè¡¨ç¤ºä¸€ä¸ª DAGï¼Œåœ¨åŒä¸€æ—¶é—´ç‚¹æœ€å¤§å¯ä»¥è¿è¡Œå¤šå°‘ä¸ª Task<br><code>max_active_runs_per_dag</code>ï¼šè¡¨ç¤ºä¸€ä¸ª DAGï¼Œåœ¨åŒä¸€æ—¶é—´ç‚¹æœ€å¤šå¯ä»¥è¢«è¿è¡Œå‡ ä¸ª</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"># é»˜è®¤å€¼éƒ½ä¸º<span class="number">16</span></span><br><span class="line">dag_concurrency = <span class="number">16</span></span><br><span class="line">max_active_runs_per_dag = <span class="number">16</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰æœŸå‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‰æœŸå‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;å‰æœŸå‡†å¤‡&quot;&gt;&lt;/a&gt;å‰æœŸå‡†å¤‡&lt;/h2&gt;&lt;h3 id=&quot;å…³é—­é˜²ç«å¢™å’Œ-selinux&quot;&gt;&lt;a href=&quot;#å…³é—­é˜²ç«å¢™å’Œ-selinux&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="æŠ˜è…¾ä¸æ­¢" scheme="https://liei.cc/blog/categories/%E6%8A%98%E8%85%BE%E4%B8%8D%E6%AD%A2/"/>
    
    
    <category term="Python" scheme="https://liei.cc/blog/tags/python/"/>
    
    <category term="Airflow" scheme="https://liei.cc/blog/tags/airflow/"/>
    
  </entry>
  
  <entry>
    <title>GFS ä¸€è‡´æ€§æ¨¡å‹</title>
    <link href="https://liei.cc/2019/gfs-consistency.html"/>
    <id>https://liei.cc/2019/gfs-consistency.html</id>
    <published>2019-07-15T14:15:15.000Z</published>
    <updated>2019-07-15T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><div class="tag-plugin note" ><div class="title"><strong>quote,</strong></div><div class="body"><p>æœ€è¿‘ï¼Œéƒ¨é—¨å†…éƒ¨ç»„ç»‡äº†å­¦ä¹ æ´»åŠ¨ï¼Œå‰ä¸¤è¯¾å°±æ˜¯ç ”è¯»è‘—åçš„å¯æ‰©å±•åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ GFS è®ºæ–‡ï¼Œå¹¶å¸ƒç½®äº†å­¦ä¹ ä½œä¸šï¼Œå°±æ˜¯æ•´ç† GFS ä¸­æå‡ºçš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œå¦‚ä¸‹æ–‡ï¼š</p></div></div><h2 id="ä¸€è‡´æ€§èƒŒæ™¯"><a href="#ä¸€è‡´æ€§èƒŒæ™¯" class="headerlink" title="ä¸€è‡´æ€§èƒŒæ™¯"></a>ä¸€è‡´æ€§èƒŒæ™¯</h2><p>åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œä¸ç®¡æ˜¯æ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯æ•°æ®åº“ï¼Œåªè¦æ•°æ®å­˜åœ¨å¤šä¸ªå‰¯æœ¬ï¼Œéƒ½æ¶‰åŠä¸€è‡´æ€§é—®é¢˜ã€‚å…¶ä¸­ä¸€è‡´æ€§åŒ…æ‹¬å†…éƒ¨ä¸€è‡´æ€§å’Œå‰¯æœ¬ä¸€è‡´æ€§ï¼Œå†…éƒ¨ä¸€è‡´æ€§å³å•æœºç‰ˆæ•°æ®åº“ä¸­çš„æ•°æ®æ»¡è¶³ä¸€å®šçš„çº¦æŸæ¡ä»¶ã€‚å‰¯æœ¬ä¸€è‡´æ€§è¡¨ç¤ºåŒä¸€æ•°æ®çš„å¤šä¸ªå‰¯æœ¬çš„å€¼ç›¸åŒã€‚GFS ä½œä¸ºä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œé‡‡ç”¨äº†å¤šå‰¯æœ¬æœºåˆ¶ï¼Œè‡ªç„¶ä¹Ÿä¼šæœ‰ä¸€è‡´æ€§é—®é¢˜</p><h2 id="ä¸€è‡´æ€§æ¨¡å‹"><a href="#ä¸€è‡´æ€§æ¨¡å‹" class="headerlink" title="ä¸€è‡´æ€§æ¨¡å‹"></a>ä¸€è‡´æ€§æ¨¡å‹</h2><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/GFS%20%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B%402x.png" alt="GFS ä¸€è‡´æ€§æ¨¡å‹"></p><h2 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h2><p><strong>ä¿®æ”¹æ“ä½œï¼š</strong> åŒ…æ‹¬å†™æ“ä½œå’Œè¿½åŠ æ“ä½œï¼Œå†™æ“ä½œéœ€è¦æŒ‡å®šæ–‡ä»¶å— + offsetã€‚è¿½åŠ æ“ä½œæˆåŠŸåç³»ç»Ÿä¼šå°†è¿½åŠ æˆåŠŸçš„åç§»é‡è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p><strong>å¹¶å‘å†™ï¼š</strong> å¦‚æœä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å†™åŒä¸€ä¸ªæ–‡ä»¶å—çš„åŒä¸€åç§»é‡ï¼Œé‚£ä¹ˆå°±æœ‰ä¸ªå…ˆåé¡ºåºé—®é¢˜ï¼Œå¦‚æœæ¥è¿‘åŒæ—¶ï¼Œç³»ç»Ÿä¸ä¿è¯è¿™ä¸ªé¡ºåºã€‚é‚£ä¹ˆå®¢æˆ·ç«¯å†å»è¯»ï¼Œå°±ä¸ä¸€å®šèƒ½è¯»åˆ°è‡ªå·±åˆšå†™çš„æ•°æ®ã€‚</p><p><strong>è¿½åŠ å¤±è´¥ï¼š</strong> è¿½åŠ æ“ä½œä¼šä¿è¯è‡³å°‘æˆåŠŸä¸€æ¬¡ã€‚è¿½åŠ æ“ä½œæ—¶ï¼Œå‡è®¾é…ç½®ä¸‰å‰¯æœ¬ï¼Œä½†æ˜¯åªæœ‰ä¸¤ä¸ªå‰¯æœ¬å†™æˆåŠŸï¼Œæœ€åä¸€ä¸ªå‰¯æœ¬è¶…æ—¶äº†ï¼ˆå¯èƒ½å¯¹åº”å—æœåŠ¡å™¨å®•æœºï¼Œå½“ç„¶é‡å¯å GFS ä¼šç”¨ chunk version æ¥æ ‡è®°å…¶è¿‡æœŸ stale äº†ï¼Œä»è€Œè·³è¿‡è¯¥ offsetã€‚ï¼‰ï¼Œé‚£ä¹ˆè¿½åŠ æ“ä½œä¼šé‡è¯•ï¼Œå¹¶ä¸”å¤±è´¥æ•°æ®ä¸ä¼šåˆ é™¤ï¼Œä½†æ˜¯ GFS æœ‰å¯¹é½æ“ä½œï¼Œå³é‡è¯•æˆåŠŸåï¼Œä¸‰ä¸ªå‰¯æœ¬ä¸­è¯¥è¿½åŠ æ•°æ®çš„èµ·å§‹åç§»é‡æ˜¯å®šä¹‰çš„ï¼ˆä¹Ÿå°±æ˜¯ä¸€è‡´çš„ï¼‰ï¼Œé‚£ä¹ˆå…¶ä¸­é‚£ä¸ªä¸Šæ¬¡å¤±è´¥çš„å‰¯æœ¬å°±ä¼šæœ‰ä¸ªç©ºæ´ï¼Œç³»ç»Ÿä¼šç”¨ç‰¹æ®Šå­—ç¬¦å¡«å……ã€‚</p><div class="tag-plugin note" ><div class="title"><strong>info,</strong></div><div class="body"><p>ç»“è®ºï¼š å®šä¹‰æœªå®šä¹‰é’ˆå¯¹çš„æ˜¯å¤šå®¢æˆ·ç«¯å¹¶å‘å†™åŒä¸€ä¸ªåç§»é‡çš„è¦†ç›–é¡ºåºé—®é¢˜ï¼›ä¸€è‡´ä¸ä¸€è‡´é’ˆå¯¹çš„æ˜¯å¤šä¸ªå‰¯æœ¬ç›¸åŒåç§»é‡çš„å†…å®¹æ˜¯å¦ç›¸åŒ</p></div></div><h2 id="æ¦‚å¿µè§£æ"><a href="#æ¦‚å¿µè§£æ" class="headerlink" title="æ¦‚å¿µè§£æ"></a>æ¦‚å¿µè§£æ</h2><p><strong>å·²å®šä¹‰ï¼ˆdefinedï¼‰</strong>ï¼šå®¢æˆ·ç«¯å†™æŸä¸ªåç§»é‡åï¼Œå†è¯»ï¼Œè¯»åˆ°çš„ä¸€å®šæ˜¯è‡ªå·±çš„ã€‚</p><p><strong>æœªå®šä¹‰çš„ä½†æ˜¯ä¸€è‡´çš„ï¼ˆundefined but consistentï¼‰</strong>ï¼šå¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘å†™åŒä¸€ä¸ªåç§»é‡ï¼Œä¸ç¡®å®šè°ä¼šè¦†ç›–è°ï¼ˆè¿™ä¸ªé¡ºåºç”± Primary Replica æ‰€åœ¨ Chunkserver æ¥å®‰æ’ï¼Œåé¢å°†ä¼šè®²ï¼‰ï¼Œå³å†™å®Œåå†è¯»ï¼Œä¸ç¡®å®šæ˜¯è‡ªå·±å†™çš„è¿˜æ˜¯å…¶ä»–äººå†™çš„ã€‚ä½†æ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œå³å¹¶å‘å†™å®Œæˆåï¼Œæœ€åå‡ ä¸ªå‰¯æœ¬æ˜¯ä¸€è‡´çš„ã€‚</p><p><strong>ä¸ä¸€è‡´çš„ï¼ˆinconsistentï¼‰</strong>ï¼šå³ä¿®æ”¹æ“ä½œåï¼Œæ‰€æœ‰å‰¯æœ¬åŒä¸€åç§»é‡çš„æ•°æ®å¹¶ä¸å®Œå…¨ç›¸åŒã€‚</p>]]></content>
    
    
    <summary type="html">åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œä¸ç®¡æ˜¯æ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯æ•°æ®åº“ï¼Œåªè¦æ•°æ®å­˜åœ¨å¤šä¸ªå‰¯æœ¬ï¼Œéƒ½æ¶‰åŠä¸€è‡´æ€§é—®é¢˜ã€‚å…¶ä¸­ä¸€è‡´æ€§åŒ…æ‹¬å†…éƒ¨ä¸€è‡´æ€§å’Œå‰¯æœ¬ä¸€è‡´æ€§ï¼Œå†…éƒ¨ä¸€è‡´æ€§å³å•æœºç‰ˆæ•°æ®åº“ä¸­çš„æ•°æ®æ»¡è¶³ä¸€å®šçš„çº¦æŸæ¡ä»¶ã€‚å‰¯æœ¬ä¸€è‡´æ€§è¡¨ç¤ºåŒä¸€æ•°æ®çš„å¤šä¸ªå‰¯æœ¬çš„å€¼ç›¸åŒã€‚GFS ä½œä¸ºä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œé‡‡ç”¨äº†å¤šå‰¯æœ¬æœºåˆ¶ï¼Œè‡ªç„¶ä¹Ÿä¼šæœ‰ä¸€è‡´æ€§é—®é¢˜</summary>
    
    
    
    <category term="è§£å†³æ–¹æ¡ˆ" scheme="https://liei.cc/blog/categories/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://liei.cc/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>go pprof æ€§èƒ½åˆ†æ</title>
    <link href="https://liei.cc/2019/go-pprof-analysis.html"/>
    <id>https://liei.cc/2019/go-pprof-analysis.html</id>
    <published>2019-05-20T14:15:15.000Z</published>
    <updated>2019-05-20T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><div class="tag-plugin note" ><div class="title"><strong>warning,</strong></div><div class="body"><p>çº¿ä¸Šè¿è¡Œçš„åŸºç¡€å¹³å°æ–‡ä»¶ç®¡ç†æœåŠ¡è¿›ç¨‹å‡ºç°å†…å­˜æ³„éœ²çš„ç°è±¡ï¼Œä¸‹å›¾æ˜¯ <code>grafana</code> é’ˆå¯¹è¯¥æœåŠ¡çš„ç›‘æ§æŒ‡æ ‡æƒ…å†µï¼Œå¯ä»¥å‘ç°æœåŠ¡åˆšèµ·æ—¶ï¼Œå†…å­˜ä½¿ç”¨é‡ä¸º <strong>20M</strong> å·¦å³ï¼Œç»è¿‡æ“ä½œåï¼Œå†…å­˜ä¼šç¨³å®šåœ¨ <strong>300M</strong> å·¦å³ï¼Œä¸ä¼šæŒç»­ä¸Šå‡ï¼Œä¹Ÿä¸ä¼šä¸‹é™ï¼Œä¸€å¼€å§‹æ‰¾ä¸åˆ°åŸå› ï¼Œæ‰€ä»¥å°è¯•ä½¿ç”¨ä¸€ä¸‹ golang pprof æ€§èƒ½åˆ†æå·¥å…·åˆ†æä¸€ä¸‹ç¨‹åºåˆ°åº•å“ªå‡ºé—®é¢˜äº†</p></div></div><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/005TUXkXly1g3jdrwfy0zj31hc0r3tcp.jpg"></p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/005TUXkXly1g3jdrwawt6j31hc0r3dhp.jpg"></p><h2 id="æ·»åŠ -pprof-æ¨¡å—"><a href="#æ·»åŠ -pprof-æ¨¡å—" class="headerlink" title="æ·»åŠ  pprof æ¨¡å—"></a>æ·»åŠ  pprof æ¨¡å—</h2><p>ç°åœ¨æœ€æ–°ç‰ˆæœ¬çš„ go tool åˆ†æå·¥å…·å·²ç»å¾ˆäººæ€§åŒ–äº†ï¼Œpprof é‡‡æ ·æ•°æ®ä¸»è¦æœ‰ä¸‰ç§è·å–æ–¹å¼:</p><ul><li><strong>runtime&#x2F;pprof</strong>: æ‰‹åŠ¨è°ƒç”¨<code>runtime.StartCPUProfile</code>æˆ–è€…<code>runtime.StopCPUProfile</code>ç­‰ API æ¥ç”Ÿæˆå’Œå†™å…¥é‡‡æ ·æ–‡ä»¶ï¼Œçµæ´»æ€§é«˜ï¼Œé€‚ç”¨äº<code>åº”ç”¨ç¨‹åº</code></li><li><strong>net&#x2F;http&#x2F;pprof</strong>: é€šè¿‡ http æœåŠ¡è·å– Profile é‡‡æ ·æ–‡ä»¶ï¼Œç®€å•æ˜“ç”¨ï¼Œé€‚ç”¨äºå¯¹åº”ç”¨ç¨‹åºçš„æ•´ä½“ç›‘æ§ï¼Œé€šè¿‡ runtime&#x2F;pprof å®ç°ï¼Œé€‚ç”¨äº<code>webæœåŠ¡ç¨‹åºã€æœåŠ¡è¿›ç¨‹</code></li><li><strong>go test</strong>: é€šè¿‡ <code>go test -bench . -cpuprofile prof.cpu</code>ç”Ÿæˆé‡‡æ ·æ–‡ä»¶ é€‚ç”¨å¯¹å‡½æ•°è¿›è¡Œé’ˆå¯¹æ€§æµ‹è¯•</li></ul><blockquote class="pullquote right @leeifme , ç¡æ²™å‘çš„æ²™çš®ç‹—"><p>å…¶å® net&#x2F;http&#x2F;pprof ä¸­åªæ˜¯ä½¿ç”¨ runtime&#x2F;pprof åŒ…æ¥è¿›è¡Œå°è£…äº†ä¸€ä¸‹ï¼Œå¹¶åœ¨ http ç«¯å£ä¸Šæš´éœ²å‡ºæ¥ï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨æŸ¥çœ‹ç¨‹åºçš„æ€§èƒ½åˆ†æã€‚å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ net&#x2F;http&#x2F;pprof ä¸­ä»£ç ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶ pprof.goã€‚</p></blockquote><p>ä»¥ä¸Šè·å–æ–¹å¼å°±ä¸è¯¦ç»†æ¼”ç¤ºäº†ï¼Œæ¯•ç«Ÿç€é‡äºè§£å†³å½“ä¸‹é—®é¢˜ï¼Œç”±äºæ‰€è¦åˆ†æçš„æœåŠ¡ç¨‹åºä¾èµ–äº <code>gin web æ¡†æ¶</code> ï¼Œå› æ­¤è¦åœ¨ <code>gin</code> ä¸­é›†æˆ pprofï¼›</p><p><strong>Exampleï¼š</strong></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/gin-contrib/pprof&quot;</span>  <span class="comment">// step 1</span></span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line">  pprof.Register(router)   <span class="comment">// step 2</span></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å¯åŠ¨ç¨‹åºï¼Œé€šè¿‡æœåŠ¡ç«¯å£å³å¯è®¿é—® pprof çš„æ•°æ®</p><p>æŸ¥çœ‹å½“å‰æ€»è§ˆï¼šè®¿é—® <code>http://$HOSTIP:$PORT/debug/pprof</code></p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/005TUXkXly1g3ic456o71j313m0f70tl.jpg"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cpuï¼ˆCPU Profilingï¼‰: $HOST/debug/pprof/profileï¼Œé»˜è®¤è¿›è¡Œ 30s çš„ CPU Profilingï¼Œå¾—åˆ°ä¸€ä¸ªåˆ†æç”¨çš„ profile æ–‡ä»¶</span><br><span class="line">blockï¼ˆBlock Profilingï¼‰ï¼š$HOST/debug/pprof/blockï¼ŒæŸ¥çœ‹å¯¼è‡´é˜»å¡åŒæ­¥çš„å †æ ˆè·Ÿè¸ª</span><br><span class="line">goroutineï¼š$HOST/debug/pprof/goroutineï¼ŒæŸ¥çœ‹å½“å‰æ‰€æœ‰è¿è¡Œçš„ goroutines å †æ ˆè·Ÿè¸ª</span><br><span class="line">heapï¼ˆMemory Profilingï¼‰: $HOST/debug/pprof/heapï¼ŒæŸ¥çœ‹æ´»åŠ¨å¯¹è±¡çš„å†…å­˜åˆ†é…æƒ…å†µ</span><br><span class="line">mutexï¼ˆMutex Profilingï¼‰ï¼š$HOST/debug/pprof/mutexï¼ŒæŸ¥çœ‹å¯¼è‡´äº’æ–¥é”çš„ç«äº‰æŒæœ‰è€…çš„å †æ ˆè·Ÿè¸ª</span><br><span class="line">threadcreateï¼š$HOST/debug/pprof/threadcreateï¼ŒæŸ¥çœ‹åˆ›å»ºæ–° OS çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ª</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œæˆ‘æ›´å¤šçš„æ˜¯åšç¨‹åºçš„å†…å­˜åˆ†æï¼Œå¹¶é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨ï¼›</p><p>åœ¨ terminal ä¸­ä½¿ç”¨ <code>go tool pprof http://$HOSTIP:$PORT/debug/pprof/heap</code> å¯ä»¥è¿›å…¥ pprof åˆ†æå·¥å…·ï¼Œæ¯”å¦‚è¾“å…¥ <code>top</code> å¯ä»¥æ˜¾ç¤ºé å‰çš„å‡ é¡¹ï¼Œgo tool pprof å¯ä»¥å¸¦ä¸Šå‚æ•° <code>-inuse_space</code> (åˆ†æåº”ç”¨ç¨‹åºçš„å¸¸é©»å†…å­˜å ç”¨æƒ…å†µ) æˆ–è€… <code>-alloc_space</code> (åˆ†æåº”ç”¨ç¨‹åºçš„å†…å­˜ä¸´æ—¶åˆ†é…æƒ…å†µ)</p><p>ç°åœ¨ go tool å¯ä»¥ç›´æ¥å¯è§†åŒ–ç»“æœï¼Œåªéœ€è¦å¸¦ä¸Š <code>-http=:8081</code> å‚æ•°å³å¯ï¼Œå¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ go tool pprof -http=:8081 http://<span class="variable">$HOSTIP</span>:<span class="variable">$PORT</span>/debug/pprof/heap</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±ä¼šåœ¨æµè§ˆå™¨å¼¹å‡º <code>http://$HOSTIP:8081/ui</code>ï¼Œé‡Œé¢åŒ…å«ç¨‹åºå†…å­˜åˆ†æçš„ dot æ ¼å¼çš„å›¾ã€ç«ç„°å›¾ã€top åˆ—è¡¨ã€source åˆ—è¡¨ç­‰ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/005TUXkXly1g3je0lzugdj31hc0r3q3u.jpg"></p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/005TUXkXly1g3je0m0bjuj31hc0r3aby.jpg"></p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/005TUXkXly1g3je0m0mu5j31hc0r341g.jpg"></p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/005TUXkXly1g3je0m09v2j31hc0r30uc.jpg"></p><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><p>å†…å­˜æ¶ˆè€—åœæ»åœ¨ä¸€ä¸ªå€¼æ—¶ï¼Œæ¯”å¦‚ä¸Šè¿°é—®é¢˜æè¿°ï¼Œå…¶å®ä¸ç”¨ç§°ä¹‹ä¸ºå†…å­˜æ³„æ¼ï¼Œè€Œæ˜¯ä¸ä¸»åŠ¨ GCï¼Œéœ€è¦ä¸»åŠ¨é‡Šæ”¾å†…å­˜ï¼›</p><p>å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ç”±äºä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œé‡‡ç”¨ <code>multipart/form-data</code> ä¼ è¾“æ•°æ®ï¼Œ<code>r.FormFile(&quot;file&quot;)</code> å°†å¯¼è‡´è°ƒç”¨Request.ParseMultipartForm()ï¼Œå¹¶å°†32 MBç”¨ä½œmaxMemoryå‚æ•°çš„å€¼ï¼Œåˆ›å»º 32M çš„ç¼“å†²åŒºï¼›ç”±äº<code>bytes.Buffer</code> ç”¨äºè¯»å–å†…å®¹ï¼Œå› æ­¤è¯»å–è¿‡ç¨‹å°†ä»ä¸€ä¸ªå°çš„æˆ–ç©ºçš„ç¼“å†²åŒºå¼€å§‹ï¼Œå¹¶åœ¨éœ€è¦æ›´å¤§çš„æ—¶å€™é‡æ–°åˆ†é…ï¼›</p><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://golang.org/pkg/mime/multipart/#Reader.ReadForm"><strong>multipart.Reader.ReadFrom()</strong></a> çš„å®ç°ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r.ParseMultipartForm(<span class="number">32</span> &lt;&lt; <span class="number">20</span>) <span class="comment">// 32 MB</span></span><br><span class="line">file, _, err := r.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="comment">// ... rest of your handler</span></span><br></pre></td></tr></table></figure><blockquote class="pullquote @leeifme , ç¡æ²™å‘çš„æ²™çš®ç‹—"><p>è¯¦ç»†æè¿°å¯ä»¥å‚è€ƒ <strong>stackoverflow</strong> ä¸Šçš„å›ç­”ï¼Œ<a href="https://stackoverflow.com/questions/30657454/multipart-form-uploads-memory-leaks-in-golang">Multipart form uploads + memory leaks in golang?</a></p></blockquote><p>è¿™é‡Œä¼˜åŒ–çš„æ–¹æ¡ˆæ˜¯åœ¨ <code>request</code>è¯·æ±‚çš„ <code>body</code> ä¸­åªæ”¾æ–‡ä»¶æ•°æ®ï¼Œå…¶ä½™ä¿¡æ¯æ”¾åˆ° <code>header</code> ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä½¿ç”¨ MultipartForm å»è§£ææ•°æ®ï¼›</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">file = r.Body</span><br><span class="line"><span class="comment">// ... rest of your handler</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¼ è¾“å®Œæˆåï¼Œå†…å­˜å ç”¨æ¢å¤åˆ°äº†æœåŠ¡åˆå§‹çš„çŠ¶æ€å€¼</p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/20190627151301.png"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/EDDYCJY/blog/blob/master/golang/2018-09-15-Golang%20%E5%A4%A7%E6%9D%80%E5%99%A8%E4%B9%8B%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90%20PProf.md">Golang å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ PProf</a></p><p><a href="https://stackoverflow.com/questions/30657454/multipart-form-uploads-memory-leaks-in-golang">Multipart form uploads + memory leaks in golang?</a></p>]]></content>
    
    
    <summary type="html">çº¿ä¸Šè¿è¡Œçš„åŸºç¡€å¹³å°æ–‡ä»¶ç®¡ç†æœåŠ¡è¿›ç¨‹å‡ºç°å†…å­˜æ³„éœ²çš„ç°è±¡ï¼Œä¸‹å›¾æ˜¯ `grafana` é’ˆå¯¹è¯¥æœåŠ¡çš„ç›‘æ§æŒ‡æ ‡æƒ…å†µï¼Œå¯ä»¥å‘ç°æœåŠ¡åˆšèµ·æ—¶ï¼Œå†…å­˜ä½¿ç”¨é‡ä¸º **20M** å·¦å³ï¼Œç»è¿‡æ“ä½œåï¼Œå†…å­˜ä¼šç¨³å®šåœ¨ **300M** å·¦å³ï¼Œä¸ä¼šæŒç»­ä¸Šå‡ï¼Œä¹Ÿä¸ä¼šä¸‹é™ï¼Œä¸€å¼€å§‹æ‰¾ä¸åˆ°åŸå› ï¼Œæ‰€ä»¥å°è¯•ä½¿ç”¨ä¸€ä¸‹ golang pprof æ€§èƒ½åˆ†æå·¥å…·åˆ†æä¸€ä¸‹ç¨‹åºåˆ°åº•å“ªå‡ºé—®é¢˜äº†</summary>
    
    
    
    <category term="è®¾è®¡å¼€å‘" scheme="https://liei.cc/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Go" scheme="https://liei.cc/blog/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>Opeartor-SDK ç®€å•ä¸Šæ‰‹</title>
    <link href="https://liei.cc/2019/operator-sdk-use.html"/>
    <id>https://liei.cc/2019/operator-sdk-use.html</id>
    <published>2019-02-28T14:15:15.000Z</published>
    <updated>2019-02-28T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>  æœ¬ç¯‡ä»‹ç»äº†CoreOSï¼ˆå·²è¢«çº¢å¸½æ”¶è´­ï¼‰çš„å¼€æºé¡¹ç›® <a href="https://github.com/operator-framework/operator-sdk">Operator-SDK</a> çš„åŸºæœ¬ä½¿ç”¨ã€‚è¯¥é¡¹ç›®æ˜¯ <code>Operator Framework</code> çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·åŒ…ï¼Œä»¥æœ‰æ•ˆï¼Œè‡ªåŠ¨åŒ–å’Œå¯æ‰©å±•çš„æ–¹å¼ç®¡ç†ç§°ä¸º <code>Operators</code> çš„KubernetesåŸç”Ÿåº”ç”¨ç¨‹åº</p></blockquote><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p><a href="https://coreos.com/operators/">Operators</a> å¯ä»¥åœ¨Kubernetesä¹‹ä¸Šè½»æ¾åœ°ç®¡ç†å¤æ‚æœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œç”±äºè¯¸å¦‚ä½¿ç”¨ä½çº§APIï¼Œç¼–å†™æ ·æ¿ä»¥åŠç¼ºä¹æ¨¡å—å¯¼è‡´é‡å¤æ€§å·¥ä½œç­‰æŒ‘æˆ˜ï¼Œå¯¼è‡´ç›®å‰ç¼–å†™Operatorå¯èƒ½å¾ˆå›°éš¾</p><p>Operator SDKæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–Operatorçš„ç¼–å†™ï¼Œå®ƒæä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š</p><ul><li>é«˜çº§APIå’ŒæŠ½è±¡ï¼Œæ›´ç›´è§‚åœ°ç¼–å†™æ“ä½œé€»è¾‘</li><li>ç”¨äºè„šæ‰‹æ¶å’Œä»£ç ç”Ÿæˆçš„å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿå¼•å¯¼æ–°é¡¹ç›®</li><li>æ‰©å±•ä»¥æ¶µç›–å¸¸è§çš„æ“ä½œå‘˜ç”¨ä¾‹</li></ul><h2 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h2><p>SDKæä¾›ä»¥ä¸‹å·¥ä½œæµç¨‹æ¥å¼€å‘æ–°çš„Operatorï¼š</p><ol><li>ä½¿ç”¨SDKå‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰åˆ›å»ºæ–°çš„Operatoré¡¹ç›®</li><li>é€šè¿‡æ·»åŠ è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰å®šä¹‰æ–°èµ„æºAPI</li><li>ä½¿ç”¨SDK APIç›‘æ§æŒ‡å®šçš„èµ„æº</li><li>åœ¨æŒ‡å®šçš„å¤„ç†ç¨‹åºä¸­å®šä¹‰Operatoråè°ƒé€»è¾‘(å¯¹æ¯”æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€)ï¼Œå¹¶ä½¿ç”¨SDK APIä¸èµ„æºè¿›è¡Œäº¤äº’</li><li>ä½¿ç”¨SDK CLIæ„å»ºå¹¶ç”ŸæˆOperatoréƒ¨ç½²manifests</li></ol><p>Operatorä½¿ç”¨SDKåœ¨ç”¨æˆ·è‡ªå®šä¹‰çš„å¤„ç†ç¨‹åºä¸­ä»¥é«˜çº§APIå¤„ç†ç›‘è§†èµ„æºçš„äº‹ä»¶ï¼Œå¹¶é‡‡å–æªæ–½æ¥reconcileï¼ˆå¯¹æ¯”æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€ï¼‰åº”ç”¨ç¨‹åºçš„çŠ¶æ€</p><h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><h3 id="å®‰è£…-Operator-SDK-CLI"><a href="#å®‰è£…-Operator-SDK-CLI" class="headerlink" title="å®‰è£… Operator-SDK CLI"></a>å®‰è£… Operator-SDK CLI</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p <span class="variable">$GOPATH</span>/src/github.com/operator-framework</span><br><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/operator-framework</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/operator-framework/operator-sdk</span><br><span class="line">$ <span class="built_in">cd</span> operator-sdk</span><br><span class="line">$ git checkout master</span><br><span class="line">$ make dep</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼š</strong>è¿™é‡Œå¯çŸ¥ï¼Œ<code>Operator-SDK</code> é»˜è®¤é‡‡ç”¨ <code>dep</code> ä½œä¸ºåŒ…ç®¡ç†æ–¹å¼ï¼Œä½† <code>dep</code> å½“å‰çš„æ‰§è¡Œæ•ˆç‡çš„ç¡®ä¸é«˜ï¼Œå¦‚æœä½ çš„ project ä¾èµ–çš„å¤–éƒ¨åŒ…å¾ˆå¤šï¼Œé‚£ä¹ˆç­‰å¾…çš„æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ã€‚å¹¶ä¸”ç”±äº dep ä¼šä¸‹è½½ä¾èµ–åŒ…ï¼Œä¸€æ—¦ä¸‹è½½ qiang å¤–çš„åŒ…ï¼Œé‚£ä¹ˆ dep å¯èƒ½ä¼š â€œé˜»å¡â€ åœ¨é‚£é‡Œï¼å› æ­¤è¿™é‡Œå¯ä»¥é€‰æ‹©è‡ªå·±æ‹‰åŒ…å <code>go install</code></p><h3 id="åˆ›å»º-app-operator"><a href="#åˆ›å»º-app-operator" class="headerlink" title="åˆ›å»º app-operator"></a>åˆ›å»º app-operator</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå®šä¹‰ App ç”¨æˆ·èµ„æºçš„ app-operator é¡¹ç›®</span></span><br><span class="line">$ <span class="built_in">mkdir</span> -p <span class="variable">$GOPATH</span>/src/github.com/&lt;GitHub_ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º app-operator é¡¹ç›®</span></span><br><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/&lt;GitHub_ID&gt;</span><br><span class="line">$ operator-sdk new app-operator  </span><br><span class="line">$ <span class="built_in">cd</span> app-operator</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºAppServiceç”¨æˆ·èµ„æºæ·»åŠ ä¸€ä¸ªæ–°çš„ API</span></span><br><span class="line">$ operator-sdk add api --api-version=app.example.com/v1alpha1 --kind=AppService</span><br><span class="line"><span class="comment"># Required: --kind - æ˜¯ CRD è¦å®šç¾©çš„ kind</span></span><br><span class="line"><span class="comment"># Required: --api-version - æ˜¯CRD æƒ³å®šä¹‰çš„ group/versionã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨æ¥ç›‘æ§ AppService</span></span><br><span class="line">$ operator-sdk add controller --api-version=app.example.com/v1alpha1 --kind=AppService</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºå¹¶æ¨é€ app-operator é•œåƒåˆ°ä¸€ä¸ªå…¬å¼€çš„ registry</span></span><br><span class="line"><span class="comment"># è¿™é‡Œ build é•œåƒï¼Œä½¿ç”¨çš„åŸºç¡€é•œåƒï¼Œç”±äºä¸å¯æè¿°çš„åŸå› ï¼Œéå¸¸è€—æ—¶</span></span><br><span class="line"><span class="comment"># å¯æ›¿æ¢ä¸º ï¼š FROM docker.io/ericnie2017/helm-operator:latest</span></span><br><span class="line">$ operator-sdk build app-operator:v0.1.0</span><br><span class="line">$ docker push </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–° operator manifest æ¥ä½¿ç”¨æ–°æ„å»ºçš„é•œåƒ</span></span><br><span class="line">$ sed -i <span class="string">&#x27;s|REPLACE_IMAGE|app-operator:v0.1.0|g&#x27;</span> deploy/operator.yaml</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼š</strong>è¿™é‡Œé‡‡ç”¨ <code>operator-sdk new </code> åˆ›å»º app-operator æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ <code>Gopkg.toml</code> å¹¶ä½¿ç”¨ <code>dep</code> ä¸‹è½½ä¾èµ–åŒ…ï¼Œæœ€å¥½æŒ‚ä»£ç†ï¼Œä¸ç„¶éå¸¸è€—æ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è·³è¿‡ï¼Œè‡ªå·±æ‹‰åŒ…ç¼–è¯‘</p><h3 id="åˆ›å»º-app-operator-for-Helm"><a href="#åˆ›å»º-app-operator-for-Helm" class="headerlink" title="åˆ›å»º app-operator for Helm"></a>åˆ›å»º app-operator for Helm</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¶ä»–æ­¥éª¤éƒ½ä¸€æ ·</span></span><br><span class="line"><span class="comment"># åªæ˜¯å†åˆ›å»º app-operator æ—¶ï¼Œå¢åŠ  --type=helmï¼Œå¹¶ä¸”å†åˆ›å»º helm ç±»å‹çš„ operator æ—¶ï¼Œå¯ä»¥ç›´æ¥ add api å’Œ kind</span></span><br><span class="line">$ operator-sdk new &lt;project-name&gt; --<span class="built_in">type</span>=helm --kind=&lt;kind&gt; --api-version=&lt;group/version&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹å¦‚</span></span><br><span class="line">$ operator-sdk new app-operator api --api-version=app.example.com/v1alpha1 --kind=AppService --<span class="built_in">type</span>=helm</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²-app-operator"><a href="#éƒ¨ç½²-app-operator" class="headerlink" title="éƒ¨ç½² app-operator"></a>éƒ¨ç½² app-operator</h3><p>ä¸Šè¿°ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼Œéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆ <code>/deploy</code> æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸€ç»„å¯ä»¥ deploy åˆ° K8s cluser ä¸Šçš„ resource filesï¼›</p><ul><li><strong>deploy&#x2F;service_account.yaml</strong>: å»ºç«‹ä¸€ä¸ªè¯¥è‡ªå®šä¹‰ operator åç§°çš„ ServiceAccount</li><li><strong>deploy&#x2F;role.yaml</strong>: å»ºç«‹ä¸€ä¸ª role å®šä¹‰å®ƒèƒ½å­˜å– K8s cluster çš„è§„åˆ™</li><li><strong>deploy&#x2F;role_binding.yaml</strong>: æŠŠä¸Šé¢çš„ ServiceAccount å’Œ Role ç»‘å®šèµ·æ¥ï¼Œä½¿è¯¥ ServiceAccount æ‹¥æœ‰è¿™ä¸ª Role å®šä¹‰çš„å­˜å– rule</li><li><strong>deploy&#x2F;operator.yaml</strong>: æ˜¯ deploy operator åˆ° K8s cluster ä¸Šçš„ deploymentï¼Œä½¿ç”¨çš„ ServiceAccount æ˜¯æˆ‘ä»¬ <code>deploy/service_account.yaml</code> å®šä¹‰çš„åç§°</li><li><strong>deploy&#x2F;crds&#x2F;GROUP_VERSION_CRDNAME_crd.yaml</strong>: å°±æ˜¯æˆ‘å€‘è‡ªå·±å®šä¹‰ resource typeï¼ŒMore detail: <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/">Extend the Kubernetes API with CustomResourceDefinitions</a></li><li><strong>deploy&#x2F;crds&#x2F;GROUP_VERSION_CRDNAME_cr.yaml</strong>: æ˜¯æˆ‘ä»¬è¦ deploy è‡ªå®šä¹‰çš„ resourceï¼ŒCR ä»£è¡¨ Custom Resource ï¼ŒMore detail: <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#create-custom-objects">Create custom objects</a> ï¼Œè¯¥æ–‡ä»¶ä¸­çš„ spec å°±æ˜¯å®Œå…¨å¤åˆ¶ <code>helm-charts</code> ä¸‹çš„ values.yamlï¼Œæ‰€ä»¥åŸæœ¬ç”¨ helm æ€ä¹ˆå®šä¹‰ values.yaml ä¸­çš„å€¼ï¼Œè¯¥æ–‡ä»¶ä¸­å°±æ€ä¹ˆå†™</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å»ºç«‹Service Account</span></span><br><span class="line">$ kubectl create -f deploy/service_account.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹RBAC</span></span><br><span class="line">$ kubectl create -f deploy/role.yaml</span><br><span class="line">$ kubectl create -f deploy/role_binding.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹CRD</span></span><br><span class="line">$ kubectl create -f deploy/crds/app_v1alpha1_appservice_crd.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²app-operator</span></span><br><span class="line"><span class="comment"># è¿™é‡Œéƒ¨ç½²æ—¶ï¼Œç”±äºè‡ªåŠ¨ç”Ÿæˆçš„ operator.yaml æ–‡ä»¶ä¸­çš„ æ‹‰å–é•œåƒï¼Œé»˜è®¤ä¸º imagePullPolicy: Always ï¼›åˆ°é•œåƒä»“åº“æ‹‰å–</span></span><br><span class="line"><span class="comment"># æˆ‘ä¸€èˆ¬é•œåƒæ‰“åŒ…åˆ°æœ¬åœ°ï¼Œæ‰€ä»¥æ›¿æ¢ä¸º  imagePullPolicy: IfNotPresent ï¼›æœ¬åœ°æœ‰ï¼Œå°±ä¸åˆ°é•œåƒä»“åº“æ‹‰å–</span></span><br><span class="line">$ kubectl create -f deploy/operator.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªAppServiceç”¨æˆ·èµ„æº</span></span><br><span class="line"><span class="comment"># é»˜è®¤æ§åˆ¶å™¨å°†ç›‘è§†AppServiceå¯¹è±¡å¹¶ä¸ºæ¯ä¸€ä¸ªCRåˆ›å»ºä¸€ä¸ªpod</span></span><br><span class="line">$ kubectl create -f deploy/crds/app_v1alpha1_appservice_cr.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯podæ˜¯å¦åˆ›å»º</span></span><br><span class="line">$ kubectl get pod -l app=example-appservice</span><br><span class="line">NAME                     READY     STATUS    RESTARTS   AGE</span><br><span class="line">example-appservice-pod   1/1       Running   0          1m</span><br></pre></td></tr></table></figure><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>è¿™æ ·é€šè¿‡ <code>operator-framework/operator-sdk </code> è¦å®Œæˆè‡ªå·±çš„ CRD å’Œ operator çœŸçš„å¾ˆå¿«é€Ÿå’Œæ–¹ä¾¿ï¼Œå¯ä»¥é¢„è§ï¼Œå¦‚æœæ˜¯å¼€å‘æˆ–è¿ç»´äººå‘˜ï¼Œåœ¨äº†è§£éœ€æ±‚åï¼Œå¯ä»¥ä¸ç”¨å†™å¾ˆå¤šçš„ operator å¤æ‚å’Œç¹ççš„é‡å¤ç¨‹åºï¼Œå°±å¯ä»¥å¿«é€Ÿå¼€å‘å’Œéƒ¨ç½² operator ï¼Œä¸”åç»­ä¸€æ ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ K8s çš„ API èµ„æºï¼›ä¸è¿‡ï¼Œæ˜¯å¦è¦ä½¿ç”¨ <code>operator-framework/operator-sdk</code> ï¼Œä¸€åˆ‡è¿˜æ˜¯éœ€è¦è‡ªè¡Œçš„è¯„ä¼°å’Œç»“åˆå½“å‰åº”ç”¨æœåŠ¡çš„ä½“é‡æ¥çœ‹æ˜¯å¦é€‚åˆä½¿ç”¨ï¼Œå°å¿ƒæœç”¨ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;  æœ¬ç¯‡ä»‹ç»äº†CoreOSï¼ˆå·²è¢«çº¢å¸½æ”¶è´­ï¼‰çš„å¼€æºé¡¹ç›® &lt;a href=&quot;https://github.com/op</summary>
      
    
    
    
    <category term="æŠ€æœ¯åŠ æ²¹ç«™" scheme="https://liei.cc/blog/categories/%E6%8A%80%E6%9C%AF%E5%8A%A0%E6%B2%B9%E7%AB%99/"/>
    
    
    <category term="Cloud Navite" scheme="https://liei.cc/blog/tags/cloud-navite/"/>
    
    <category term="Kubernetes" scheme="https://liei.cc/blog/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>Select -- æ— é˜»å¡è¯»å†™ channel</title>
    <link href="https://liei.cc/2019/go-channel-select.html"/>
    <id>https://liei.cc/2019/go-channel-select.html</id>
    <published>2019-02-02T14:15:15.000Z</published>
    <updated>2019-02-02T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é€šé“é˜»å¡"><a href="#é€šé“é˜»å¡" class="headerlink" title="é€šé“é˜»å¡"></a>é€šé“é˜»å¡</h2><p>åœ¨ä¹‹å‰çš„ <a href="https://leeif.me/2019/01/go-concurrent-model.html"><strong>Go çš„å¹¶å‘æ¨¡å‹</strong></a> å¯ä»¥äº†è§£åˆ°ï¼ŒFAN æµæ°´æ¨¡å‹å¯ä»¥å¤šä¸ª Goroutine è¯»ä¸€ä¸ª Channel ä¸­çš„æ•°æ®(FAN-OUT)ï¼Œæˆ–è€…å¤šä¸ª Chanel å°†æ•°æ®å‘é€åˆ°ä¸€ä¸ª Goroutine ä¸­æ¥æ”¶(FAN-IN)ï¼Œ<strong>ä½†æ˜¯æ— è®ºæ˜¯æ— ç¼“å†²é€šé“ï¼Œè¿˜æ˜¯æœ‰ç¼“å†²é€šé“ï¼Œéƒ½å­˜åœ¨é˜»å¡çš„æƒ…å†µ</strong></p><h3 id="æ— ç¼“å†²é€šé“"><a href="#æ— ç¼“å†²é€šé“" class="headerlink" title="æ— ç¼“å†²é€šé“"></a>æ— ç¼“å†²é€šé“</h3><blockquote><p>ç‰¹ç‚¹ï¼šå‘é€çš„æ•°æ®éœ€è¦è¢«è¯»å–åï¼Œå‘é€æ‰ä¼šå®Œæˆ</p></blockquote><p><strong>é˜»å¡åœºæ™¯ï¼š</strong></p><ul><li>é€šé“ä¸­æ— æ•°æ®ï¼Œä½†æ‰§è¡Œéƒ½é€šé“</li><li>é€šé“ä¸­æ— æ•°æ®ï¼Œå‘é€šé“ä¸­å†™æ•°æ®ï¼Œä½†æ— å…¶ä»–åç¨‹è¯»å–è¯¥é€šé“ä¸­çš„æ•°æ®</li></ul><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯ 1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadNoDataFromNoBufCh</span><span class="params">()</span></span>&#123;</span><br><span class="line">    noBufCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    <span class="comment">// é€šé“ä¸­æ— æ•°æ®</span></span><br><span class="line">    &lt;- noBufCh</span><br><span class="line">    fmt.Println(<span class="string">&quot;read from no buffer channel success&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output:</span></span><br><span class="line">    <span class="comment">// fatal error: all goroutines are asleep - deadlock!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœºæ™¯ 2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteNoBufCh</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    ch &lt;- <span class="number">1</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;write success no block&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output:</span></span><br><span class="line">    <span class="comment">// fatal error: all goroutines are asleep - deadlock!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ‰ç¼“å†²é€šé“"><a href="#æœ‰ç¼“å†²é€šé“" class="headerlink" title="æœ‰ç¼“å†²é€šé“"></a>æœ‰ç¼“å†²é€šé“</h3><blockquote><p>ç‰¹ç‚¹ï¼šæœ‰ç¼“å­˜æ—¶å¯ä»¥å‘é€šé“ä¸­å†™å…¥æ•°æ®åç›´æ¥è¿”å›ï¼Œç¼“å­˜ä¸­æœ‰æ•°æ®æ—¶å¯ä»¥ä»é€šé“ä¸­è¯»åˆ°æ•°æ®ç›´æ¥è¿”å›ï¼Œè¿™æ—¶æœ‰ç¼“å­˜é€šé“æ˜¯ä¸ä¼šé˜»å¡çš„</p></blockquote><p><strong>é˜»å¡åœºæ™¯ï¼š</strong></p><ul><li>é€šé“çš„ç¼“å­˜æ— æ•°æ®ï¼Œä½†æ‰§è¡Œè¯»é€šé“</li><li>é€šé“çš„ç¼“å­˜å·²ç»å æ»¡ï¼Œå‘é€šé“å†™æ•°æ®ï¼Œä½†æ— åç¨‹è¯»</li></ul><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯ 1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadNoDataFromBufCh</span><span class="params">()</span></span>&#123;</span><br><span class="line">    bufCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment">// é€šé“ä¸­æ— æ•°æ®</span></span><br><span class="line">    &lt;- bufCh</span><br><span class="line">    fmt.Println(<span class="string">&quot;read from no buffer channel success&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output:</span></span><br><span class="line">    <span class="comment">// fatal error: all goroutines are asleep - deadlock!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœºæ™¯ 2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteBufChButFull</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment">// å†™æ•°æ®ï¼Œå æ»¡ç¼“å†²</span></span><br><span class="line">    ch &lt;- <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ— åç¨‹è¯»å–ç¼“å†²ä¸­çš„æ•°æ®ï¼Œç»§ç»­å†™ï¼Œé˜»å¡</span></span><br><span class="line">    ch &lt;- <span class="number">2</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;write success no block&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output:</span></span><br><span class="line">    <span class="comment">// fatal error: all goroutines are asleep - deadlock!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Select-åŠŸèƒ½"><a href="#Select-åŠŸèƒ½" class="headerlink" title="Select åŠŸèƒ½"></a>Select åŠŸèƒ½</h2><p><strong>Select</strong> ç”±å…³é”®å­— <code>select</code> å’Œ <code>case</code> ç»„æˆï¼Œ<code>default</code> ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœæ²¡å…¶ä»–äº‹å¯åšï¼Œå¯ä»¥çœç•¥ <code>default</code>ï¼Œ<strong>åœ¨å¤šä¸ªé€šé“ä¸Šè¿›è¡Œè¯»æˆ–å†™æ“ä½œï¼Œè®©å‡½æ•°å¯ä»¥å¤„ç†å¤šä¸ªäº‹æƒ…ï¼Œä½† 1 æ¬¡åªå¤„ç† 1 ä¸ª</strong>ï¼Œæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æ¯æ¬¡æ‰§è¡Œ <code>select</code>ï¼Œéƒ½ä¼šåªæ‰§è¡Œå…¶ä¸­ 1 ä¸ª <code>case</code> æˆ–è€…æ‰§è¡Œ <code>default</code> è¯­å¥</li><li>å½“æ²¡æœ‰ case æˆ–è€… default å¯ä»¥æ‰§è¡Œæ—¶ï¼Œselect åˆ™é˜»å¡ï¼Œç­‰å¾…ç›´åˆ°æœ‰ 1 ä¸ª case å¯ä»¥æ‰§è¡Œ</li><li>å½“æœ‰å¤šä¸ª case å¯ä»¥æ‰§è¡Œæ—¶ï¼Œåˆ™éšæœºé€‰æ‹© 1 ä¸ª case æ‰§è¡Œ</li><li>case åé¢è·Ÿçš„å¿…é¡»æ˜¯è¯»æˆ–è€…å†™é€šé“çš„æ“ä½œï¼Œå¦åˆ™ç¼–è¯‘å‡ºé”™</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;é€šé“é˜»å¡&quot;&gt;&lt;a href=&quot;#é€šé“é˜»å¡&quot; class=&quot;headerlink&quot; title=&quot;é€šé“é˜»å¡&quot;&gt;&lt;/a&gt;é€šé“é˜»å¡&lt;/h2&gt;&lt;p&gt;åœ¨ä¹‹å‰çš„ &lt;a href=&quot;https://leeif.me/2019/01/go-concurrent-model.htm</summary>
      
    
    
    
    <category term="è®¾è®¡å¼€å‘" scheme="https://liei.cc/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Go" scheme="https://liei.cc/blog/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>Kuberntes åˆ›å»º LoadBalancer ç±»å‹æœåŠ¡</title>
    <link href="https://liei.cc/2019/k8s-deploy-metallb-LoadBalancer.html"/>
    <id>https://liei.cc/2019/k8s-deploy-metallb-LoadBalancer.html</id>
    <published>2019-02-01T14:15:15.000Z</published>
    <updated>2019-02-01T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼ŒService æœºåˆ¶ï¼Œä»¥åŠ Kubernetes é‡Œçš„ DNS æ’ä»¶ï¼Œéƒ½æ˜¯åœ¨å¸®åŠ©æˆ‘ä»¬è§£å†³åŒæ ·ä¸€ä¸ªé—®é¢˜ï¼Œå³ï¼šå¦‚ä½•æ‰¾åˆ°æŸä¸€ä¸ªå®¹å™¨ï¼›è€Œ Service æ˜¯ç”± kube-proxy ç»„ä»¶ï¼ŒåŠ ä¸Š iptables æ¥å…±åŒå®ç°çš„ï¼›æ‰€è°“ Service çš„è®¿é—®å…¥å£ï¼Œå…¶å®å°±æ˜¯æ¯å°å®¿ä¸»æœºä¸Šç”± kube-proxy ç”Ÿæˆçš„ iptables è§„åˆ™ï¼Œä»¥åŠ kube-dns ç”Ÿæˆçš„ DNS è®°å½•ã€‚è€Œä¸€æ—¦ç¦»å¼€äº†è¿™ä¸ªé›†ç¾¤ï¼Œè¿™äº›ä¿¡æ¯å¯¹ç”¨æˆ·æ¥è¯´ï¼Œä¹Ÿå°±è‡ªç„¶æ²¡æœ‰ä½œç”¨äº†</p></blockquote><p>åœ¨ä½¿ç”¨ Kubernetes çš„ Service æ—¶ï¼Œä¸€ä¸ªå¿…é¡»è¦é¢å¯¹å’Œè§£å†³çš„é—®é¢˜å°±æ˜¯ï¼š<strong>å¦‚ä½•ä»å¤–éƒ¨ï¼ˆKubernetes é›†ç¾¤ä¹‹å¤–ï¼‰ï¼Œè®¿é—®åˆ° Kubernetes é‡Œåˆ›å»ºçš„ Serviceï¼Ÿ</strong></p><h2 id="ä»å¤–ç•Œè¿é€š-Service"><a href="#ä»å¤–ç•Œè¿é€š-Service" class="headerlink" title="ä»å¤–ç•Œè¿é€š Service"></a>ä»å¤–ç•Œè¿é€š Service</h2><h3 id="ä¸‰ç§æ–¹å¼"><a href="#ä¸‰ç§æ–¹å¼" class="headerlink" title="ä¸‰ç§æ–¹å¼"></a>ä¸‰ç§æ–¹å¼</h3><ul><li>NodePort</li><li>ExternalIP</li><li>LoadBalance</li></ul><p>è¿™é‡Œ <code>NodePort</code> å’Œ <code>externalIPs</code> æ˜¯ K8S é›†ç¾¤æœ¬èº«å°±æ”¯æŒçš„ç‰¹æ€§ï¼Œè¿™ä¸¤ä¸ªæ–¹æ¡ˆè®©å¾ˆå¤šç§æœ‰äº‘ç”¨æˆ·æˆä¸ºäº† K8S ä¸–ç•Œä¸­çš„äºŒç­‰å…¬æ°‘ï¼Œè€Œ <code>NodePort</code> ä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼›</p><p>è€Œ kubernetes  æ²¡æœ‰ä¸ºè£¸æœºç¾¤é›†æä¾›ç½‘ç»œè´Ÿè½½å‡è¡¡å™¨ï¼ˆç±»å‹ä¸º <code>LoadBalancer</code> çš„æœåŠ¡ï¼‰çš„å®ç°ï¼Œå¦‚æœä½ çš„ K8S é›†ç¾¤æ²¡æœ‰åœ¨å…¬æœ‰äº‘çš„ IaaS å¹³å°ï¼ˆGCPï¼ŒAWSï¼ŒAzure â€¦ï¼‰ä¸Šè¿è¡Œï¼Œåˆ™ LoadBalancers å°†åœ¨åˆ›å»ºæ—¶æ— é™æœŸåœ°ä¿æŒ â€œæŒ‚èµ·â€ çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å…¬æœ‰äº‘å‚å•†è‡ªå®¶çš„ kubernetes æ”¯æŒ LoadBalancerï¼Œå¯¹ LoadBalancer ç±»å‹çš„æœåŠ¡çš„æ”¯æŒåº”è¯¥æ˜¯ä¼—å¤šè¡¨é¢å·®å¼‚ä¸­æœ€é†’ç›®çš„ä¸€ä¸ªäº†</p><h3 id="çº¯è½¯ä»¶è§£å†³æ–¹æ¡ˆ-MetalLB"><a href="#çº¯è½¯ä»¶è§£å†³æ–¹æ¡ˆ-MetalLB" class="headerlink" title="çº¯è½¯ä»¶è§£å†³æ–¹æ¡ˆ: MetalLB"></a>çº¯è½¯ä»¶è§£å†³æ–¹æ¡ˆ: MetalLB</h3><blockquote><p>è¯¥é¡¹ç›®å‘å¸ƒäº 2017 å¹´åº•ï¼Œå½“å‰å¤„äº Beta é˜¶æ®µï¼Œæ—¨åœ¨è§£å†³ä¸Šè¿°ä¸­çš„ä¸å¹³è¡¡ï¼Œé€šè¿‡æä¾›ä¸æ ‡å‡†ç½‘ç»œè®¾å¤‡é›†æˆçš„ç½‘ç»œ LB å®ç°æ¥çº æ­£è¿™ç§ä¸å¹³è¡¡ï¼Œä»¥ä¾¿è£¸æœºé›†ç¾¤ä¸Šçš„å¤–éƒ¨æœåŠ¡ä¹Ÿ â€œå°½å¯èƒ½â€ åœ°å·¥ä½œï¼›å³ MetalLB èƒ½å¤Ÿå¸®åŠ©ä½ åœ¨ kubernetes ä¸­åˆ›å»º LoadBalancer ç±»å‹çš„ kubernetes æœåŠ¡</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/google/metallb">https://github.com/google/metallb</a></p><p>ç‰ˆæœ¬è¯´æ˜ï¼š<a href="https://metallb.universe.tf/release-notes/">https://metallb.universe.tf/release-notes/</a></p></blockquote><p><code>Metallb</code> ä¼šåœ¨ Kubernetes å†…è¿è¡Œï¼Œç›‘æ§æœåŠ¡å¯¹è±¡çš„å˜åŒ–ï¼Œä¸€æ—¦å¯Ÿè§‰æœ‰æ–°çš„ LoadBalancer æœåŠ¡è¿è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰å¯ç”³è¯·çš„è´Ÿè½½å‡è¡¡å™¨ä¹‹åï¼Œå°±ä¼šå®Œæˆä¸¤éƒ¨åˆ†çš„å·¥ä½œï¼š</p><ul><li><p><strong>åœ°å€åˆ†é…</strong></p><p>ç”¨æˆ·éœ€è¦åœ¨é…ç½®ä¸­æä¾›ä¸€ä¸ªåœ°å€æ± ï¼ŒMetallb å°†ä¼šåœ¨å…¶ä¸­é€‰å–åœ°å€åˆ†é…ç»™æœåŠ¡ã€‚</p></li><li><p><strong>åœ°å€å¹¿æ’­</strong></p><p>æ ¹æ®ä¸åŒé…ç½®ï¼ŒMetallb ä¼šä»¥äºŒå±‚ï¼ˆARP&#x2F;NDPï¼‰æˆ–è€… BGP çš„æ–¹å¼è¿›è¡Œåœ°å€çš„å¹¿æ’­</p></li></ul><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/metallb.jpg" alt="åŸºæœ¬åŸç†å›¾"></p><h2 id="å®‰è£…éƒ¨ç½²æ¼”ç¤º"><a href="#å®‰è£…éƒ¨ç½²æ¼”ç¤º" class="headerlink" title="å®‰è£…éƒ¨ç½²æ¼”ç¤º"></a>å®‰è£…éƒ¨ç½²æ¼”ç¤º</h2><h3 id="éƒ¨ç½²-Metallb-è´Ÿè½½å‡è¡¡å™¨"><a href="#éƒ¨ç½²-Metallb-è´Ÿè½½å‡è¡¡å™¨" class="headerlink" title="éƒ¨ç½² Metallb è´Ÿè½½å‡è¡¡å™¨"></a>éƒ¨ç½² Metallb è´Ÿè½½å‡è¡¡å™¨</h3><p>Metallb æ”¯æŒ Helm å’Œ YAML ä¸¤ç§å®‰è£…æ–¹æ³•(è¿™é‡Œæ¨èç¬¬äºŒç§)</p><ul><li><p>Helm</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ helm install --name metallb stable/metallb</span><br></pre></td></tr></table></figure></li><li><p>YAML</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl apply -f https://raw.githubusercontent.com/google/metallb/v0.7.3/manifests/metallb.yaml</span><br></pre></td></tr></table></figure></li></ul><p>å¾ˆç®€å•ï¼Œ<code>Metallb</code> å°±ä¼šå¼€å§‹å®‰è£…ï¼Œä¼šç”Ÿæˆè‡ªå·±çš„å‘½åç©ºé—´ä»¥åŠ RBAC é…ç½®</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@lee ~]<span class="comment"># kubectl apply -f https://raw.githubusercontent.com/google/metallb/v0.7.3/manifests/metallb.yaml</span></span><br><span class="line">namespace/metallb-system created</span><br><span class="line">serviceaccount/controller created</span><br><span class="line">serviceaccount/speaker created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/metallb-system:controller created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/metallb-system:speaker created</span><br><span class="line">role.rbac.authorization.k8s.io/config-watcher created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:controller created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:speaker created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/config-watcher created</span><br><span class="line">daemonset.apps/speaker created</span><br><span class="line">deployment.apps/controller created</span><br><span class="line"></span><br><span class="line">[root@lee ~]<span class="comment"># kubectl get pods -n metallb-system -owide</span></span><br><span class="line">NAME                                             READY   STATUS  RESTARTS   AGE   IP               NODE   NOMINATED NODE</span><br><span class="line">controller-765899887-bdwdk   1/1     Running   0          82s   10.0.0.22                lee    &lt;none&gt;</span><br><span class="line">speaker-qldl6                                  1/1     Running   0          82s   192.168.50.124   lee    &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç›®å‰è¿˜æ²¡æœ‰å®£å¸ƒä»»ä½•å†…å®¹ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æä¾› ConfigMapï¼Œä¹Ÿæ²¡æœ‰æä¾›è´Ÿè½½å‡è¡¡åœ°å€çš„æœåŠ¡ï¼›<br>æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç”Ÿæˆä¸€ä¸ª ConfigMapæ–‡ä»¶ï¼Œä¸º Metallb è®¾ç½®ç½‘å€èŒƒå›´ä»¥åŠåè®®ç›¸å…³çš„é€‰æ‹©å’Œé…ç½®</p><h3 id="æä¾›-IP-pool"><a href="#æä¾›-IP-pool" class="headerlink" title="æä¾› IP pool"></a>æä¾› IP pool</h3><p>é€šè¿‡ä¹‹å‰æåˆ°çš„åŸç†å›¾å¯çŸ¥ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª <code>ConfigMap</code> æ–‡ä»¶ï¼Œä»¥æä¾› <code>IP æ± </code>ï¼›</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget https://raw.githubusercontent.com/google/metallb/v0.7.3/manifests/example-layer2-config.yaml</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹ ip åœ°å€æ± å’Œé›†ç¾¤èŠ‚ç‚¹ç½‘æ®µç›¸åŒï¼Œä¸”å¿…é¡»ä¸ºä¸€ä¸ª IP åŒºé—´</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">metallb-system</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    address-pools:</span></span><br><span class="line"><span class="string">    - name: my-ip-space</span></span><br><span class="line"><span class="string">      protocol: layer2</span></span><br><span class="line"><span class="string">      addresses:</span></span><br><span class="line"><span class="string">      # ä¸é›†ç¾¤èŠ‚ç‚¹ç½‘æ®µç›¸åŒ</span></span><br><span class="line"><span class="string">      - 192.168.50.211-192.168.50.220  </span></span><br></pre></td></tr></table></figure><p>**IP åœ°å€ä¸º <code>æ— å ç”¨</code> **</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@lee ~]<span class="comment"># ping 192.168.50.211</span></span><br><span class="line">PING 192.168.50.211 (192.168.50.211) 56(84) bytes of data.</span><br><span class="line">From 192.168.50.124 icmp_seq=1 Destination Host Unreachable</span><br><span class="line">From 192.168.50.124 icmp_seq=2 Destination Host Unreachable</span><br><span class="line">From 192.168.50.124 icmp_seq=3 Destination Host Unreachable</span><br><span class="line">From 192.168.50.124 icmp_seq=4 Destination Host Unreachable</span><br><span class="line">^C</span><br><span class="line">--- 192.168.50.211 ping statistics ---</span><br><span class="line">5 packets transmitted, 0 received, +4 errors, 100% packet loss, time 4001ms</span><br></pre></td></tr></table></figure><p>éƒ¨ç½² <code>example-layer2-config.yaml</code> æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl apply -f example-layer2-config.yaml</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²åº”ç”¨æœåŠ¡æµ‹è¯•"><a href="#éƒ¨ç½²åº”ç”¨æœåŠ¡æµ‹è¯•" class="headerlink" title="éƒ¨ç½²åº”ç”¨æœåŠ¡æµ‹è¯•"></a>éƒ¨ç½²åº”ç”¨æœåŠ¡æµ‹è¯•</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget https://raw.githubusercontent.com/google/metallb/master/manifests/tutorial-2.yaml</span><br><span class="line">$ kubectl apply -f tutorial-2.yaml</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ yaml æ–‡ä»¶é…ç½®ï¼ŒåŒ…å«äº†ä¸€ä¸ª deployment å’Œä¸€ä¸ª LoadBalancer ç±»å‹çš„ serviceï¼Œé»˜è®¤å³å¯ï¼›</p><p><strong>æŸ¥çœ‹ service åˆ†é…çš„ EXTERNAL-IP</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@lee ~]<span class="comment"># kubectl get svc -owide</span></span><br><span class="line">NAME               TYPE             CLUSTER-IP     EXTERNAL-IP         PORT(S)                 AGE   SELECTOR</span><br><span class="line">nginx           LoadBalancer   10.0.228.36      192.168.50.211     80:31796/TCP        65s   app=nginx</span><br></pre></td></tr></table></figure><p>ping è¯¥ <code> EXTERNAL-IP</code> åœ°å€ï¼Œå‘ç°è¯¥åœ°å€å¯ä»¥è®¿é—®äº†</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@lee ~]<span class="comment"># ping 192.168.50.211</span></span><br><span class="line">PING 192.168.50.211 (192.168.50.211) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.50.211: icmp_seq=1 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from 192.168.50.211: icmp_seq=2 ttl=64 time=0.082 ms</span><br><span class="line">64 bytes from 192.168.50.211: icmp_seq=3 ttl=64 time=0.068 ms</span><br></pre></td></tr></table></figure><p>é›†ç¾¤å†…è®¿é—®è¯¥ <code> EXTERNAL-IP</code> åœ°å€</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@lee ~]<span class="comment"># curl 192.168.50.211</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...............</span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>ä»é›†ç¾¤å¤–è®¿é—®è¯¥ IP åœ°å€</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Administrator at 16:47:09 / $ curl 192.168.50.211</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   612  100   612    0     0   597k      0 --:--:-- --:--:-- --:--:--  597k&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">................</span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä½¿ç”¨ <code>Node IP + NodePort</code> ä¹Ÿå¯ä»¥è®¿é—®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Administrator at 16:47:09 / $ curl 192.168.50.124:31796</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   612  100   612    0     0   597k      0 --:--:-- --:--:-- --:--:--  597k&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">................</span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼ŒService æœºåˆ¶ï¼Œä»¥åŠ Kubernetes é‡Œçš„ DNS æ’ä»¶ï¼Œéƒ½æ˜¯åœ¨å¸®åŠ©æˆ‘ä»¬è§£å†³åŒæ ·ä¸€ä¸ªé—®é¢˜ï¼Œå³</summary>
      
    
    
    
    <category term="è§£å†³æ–¹æ¡ˆ" scheme="https://liei.cc/blog/categories/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    
    
    <category term="Cloud Navite" scheme="https://liei.cc/blog/tags/cloud-navite/"/>
    
    <category term="Kubernetes" scheme="https://liei.cc/blog/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>Go å¹¶å‘æ¨¡å‹</title>
    <link href="https://liei.cc/2019/go-concurrent-model.html"/>
    <id>https://liei.cc/2019/go-concurrent-model.html</id>
    <published>2019-01-22T14:15:15.000Z</published>
    <updated>2019-01-22T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>Go è¯­è¨€æ˜¯ä¸ºå¹¶å‘è€Œç”Ÿçš„è¯­è¨€ï¼ŒGo è¯­è¨€æ˜¯ä¸ºæ•°ä¸å¤šçš„åœ¨è¯­è¨€å±‚é¢å®ç°å¹¶å‘çš„è¯­è¨€ï¼›ä¹Ÿæ­£æ˜¯ Go è¯­è¨€çš„å¹¶å‘ç‰¹æ€§ï¼Œå¸å¼•äº†å…¨çƒæ— æ•°çš„å¼€å‘è€…</p></blockquote><h2 id="å¹¶å‘-concurrency-å’Œå¹¶è¡Œ-parallellism"><a href="#å¹¶å‘-concurrency-å’Œå¹¶è¡Œ-parallellism" class="headerlink" title="å¹¶å‘ (concurrency) å’Œå¹¶è¡Œ(parallellism)"></a>å¹¶å‘ (concurrency) å’Œå¹¶è¡Œ(parallellism)</h2><p>åœ¨äº†è§£ <strong>Go</strong> çš„å¹¶å‘åŸç†ä¹‹å‰ï¼Œå…ˆäº†è§£ä»€ä¹ˆæ˜¯å¹¶å‘ä»€ä¹ˆæ˜¯å¹¶è¡Œï¼›</p><ul><li><p>å¹¶å‘ <strong>( concurrency )</strong></p><p>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ä»»åŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…è¢«æ‰§è¡Œã€‚æˆ‘ä»¬ä¸å¿… care è¿™äº›ä»»åŠ¡åœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹æ˜¯å¦æ˜¯åŒæ—¶æ‰§è¡Œï¼Œå¯èƒ½åŒæ—¶æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ï¼Œæˆ‘ä»¬åªå…³å¿ƒåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå“ªæ€•æ˜¯å¾ˆçŸ­çš„æ—¶é—´ï¼ˆä¸€ç§’æˆ–è€…ä¸¤ç§’ï¼‰æ˜¯å¦æ‰§è¡Œè§£å†³äº†ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šä»»åŠ¡</p></li><li><p>å¹¶è¡Œ  <strong>( parallellism )</strong></p><p>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ä»»åŠ¡åœ¨åŒä¸€æ—¶åˆ»è¢«åŒæ—¶æ‰§è¡Œ</p></li></ul><p>å¹¶å‘è¯´çš„æ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œè€Œå¹¶è¡Œï¼Œå¼ºè°ƒçš„æ˜¯ç‰©ç†è¿è¡ŒçŠ¶æ€ï¼›å¹¶å‘ â€œåŒ…å«â€ å¹¶è¡Œï¼›( è¯¦æƒ…è¯·è§ï¼š<strong>Rob Pike</strong> çš„ <a href="https://talks.golang.org/2012/concurrency.slide#1">PPT</a>)</p><h2 id="CSP-å¹¶å‘æ¨¡å‹"><a href="#CSP-å¹¶å‘æ¨¡å‹" class="headerlink" title="CSP å¹¶å‘æ¨¡å‹"></a>CSP å¹¶å‘æ¨¡å‹</h2><p>Go å®ç°äº†ä¸¤ç§å¹¶å‘å½¢å¼ã€‚ç¬¬ä¸€ç§æ˜¯å¤§å®¶æ™®éè®¤çŸ¥çš„ï¼šå¤šçº¿ç¨‹å…±äº«å†…å­˜ã€‚å…¶å®å°±æ˜¯ Java æˆ–è€… C++ ç­‰è¯­è¨€ä¸­çš„å¤šçº¿ç¨‹å¼€å‘ã€‚å¦å¤–ä¸€ç§æ˜¯ Go è¯­è¨€ç‰¹æœ‰çš„ï¼Œä¹Ÿæ˜¯ Go è¯­è¨€æ¨èçš„ï¼š<code>CSP</code>ï¼ˆcommunicating sequential processesï¼‰å¹¶å‘æ¨¡å‹</p><p>è¯·è®°ä½ä¸‹é¢è¿™å¥è¯ï¼š</p><blockquote><p><strong>Do not communicate by sharing memory; instead, share memory by communicating.</strong><br>â€œä¸è¦ä»¥å…±äº«å†…å­˜çš„æ–¹å¼æ¥é€šä¿¡ï¼Œç›¸åï¼Œè¦é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜â€</p></blockquote><p>æ™®é€šçš„çº¿ç¨‹å¹¶å‘æ¨¡å‹ï¼Œå°±æ˜¯åƒ Javaã€C++ã€æˆ–è€… Pythonï¼Œä»–ä»¬çº¿ç¨‹é—´é€šä¿¡éƒ½æ˜¯é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼æ¥è¿›è¡Œçš„ã€‚éå¸¸å…¸å‹çš„æ–¹å¼å°±æ˜¯ï¼Œåœ¨è®¿é—®å…±äº«æ•°æ®ï¼ˆä¾‹å¦‚æ•°ç»„ã€Mapã€æˆ–è€…æŸä¸ªç»“æ„ä½“æˆ–å¯¹è±¡ï¼‰çš„æ—¶å€™ï¼Œé€šè¿‡é”æ¥è®¿é—®ï¼Œå› æ­¤ï¼Œåœ¨å¾ˆå¤šæ—¶å€™ï¼Œè¡ç”Ÿå‡ºä¸€ç§æ–¹ä¾¿æ“ä½œçš„æ•°æ®ç»“æ„ï¼Œå«åš â€œçº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„â€</p><p>Go çš„ CSP å¹¶å‘æ¨¡å‹ï¼Œæ˜¯é€šè¿‡<code>goroutine</code>å’Œ<code>channel</code>æ¥å®ç°çš„ã€‚</p><ul><li><code>goroutine:</code> æ˜¯ Go è¯­è¨€ä¸­å¹¶å‘çš„æ‰§è¡Œå•ä½ï¼Œæœ‰ç‚¹æŠ½è±¡ï¼Œå…¶å®å°±æ˜¯å’Œä¼ ç»Ÿæ¦‚å¿µä¸Šçš„<code>çº¿ç¨‹ </code>ç±»ä¼¼ï¼Œä½†å®ƒæ¯”çº¿ç¨‹æ›´ä¸ºè½»é‡ï¼Œç§°ä¹‹ä¸º<code>åç¨‹</code></li><li><code>channelï¼š</code> æ˜¯ Go è¯­è¨€ä¸­å„ä¸ªå¹¶å‘ç»“æ„ä½“ (<code>goroutine</code>) ä¹‹å‰çš„é€šä¿¡æœºåˆ¶ã€‚ é€šä¿—çš„è®²ï¼Œå°±æ˜¯å„ä¸ª<code>goroutine</code>ä¹‹é—´é€šä¿¡çš„â€ ç®¡é“ â€œï¼Œæœ‰ç‚¹ç±»ä¼¼äº Linux ä¸­çš„ç®¡é“</li></ul><p>åˆ›å»ºä¸€ä¸ª <code>goroutine</code> å¾ˆç®€å•ï¼Œåªè¦ä½¿ç”¨ <code>go</code> å…³é”®å­—å°±å¯ä»¥äº†ï¼Œå¦‚ä¸‹ï¼›</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>é€šä¿¡æœºåˆ¶ <code>channel</code> ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä¼ æ•°æ®ç”¨ <code>channel &lt;- data</code> ï¼Œå–æ•°æ®ç”¨ <code>&lt;-channel</code></p><p>åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¼ æ•°æ® <code>channel &lt;- data</code> å’Œå–æ•°æ® <code>&lt;-channel</code> å¿…ç„¶ä¼šæˆå¯¹å‡ºç°ï¼Œå› ä¸ºè¿™è¾¹ä¼ ï¼Œé‚£è¾¹å–ï¼Œä¸¤ä¸ª<code>goroutine</code>ä¹‹é—´æ‰ä¼šå®ç°é€šä¿¡ï¼Œè€Œä¸”ä¸ç®¡ä¼ è¿˜æ˜¯å–ï¼Œå¿…é˜»å¡ï¼Œç›´åˆ°å¦å¤–çš„<code>goroutine</code>ä¼ æˆ–è€…å–ä¸ºæ­¢</p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/go-cps.png"><p>è¿™ä¾¿æ˜¯ <code>Golang CSP</code> å¹¶å‘æ¨¡å‹æœ€åŸºæœ¬çš„å½¢å¼ï¼Œæœ¬é—®å†…å®¹ä¸è¯¦ç»†é˜è¿°å¹¶å‘åŸç†</p><h2 id="å¹¶å‘æ¨¡å‹çš„è¿ç”¨"><a href="#å¹¶å‘æ¨¡å‹çš„è¿ç”¨" class="headerlink" title="å¹¶å‘æ¨¡å‹çš„è¿ç”¨"></a>å¹¶å‘æ¨¡å‹çš„è¿ç”¨</h2><h3 id="æµæ°´çº¿æ¨¡å‹"><a href="#æµæ°´çº¿æ¨¡å‹" class="headerlink" title="æµæ°´çº¿æ¨¡å‹"></a>æµæ°´çº¿æ¨¡å‹</h3><blockquote><p>Golang å¹¶å‘æ ¸å¿ƒæ€è·¯æ˜¯å…³æ³¨æ•°æ®æµåŠ¨ã€‚æ•°æ®æµåŠ¨çš„è¿‡ç¨‹äº¤ç»™ channelï¼Œæ•°æ®å¤„ç†çš„æ¯ä¸ªç¯èŠ‚éƒ½äº¤ç»™ goroutineï¼ŒæŠŠè¿™äº›æµç¨‹ç”»èµ·æ¥ï¼Œæœ‰å§‹æœ‰ç»ˆå½¢æˆä¸€æ¡çº¿ï¼Œé‚£å°±èƒ½æ„æˆæµæ°´çº¿æ¨¡å‹</p></blockquote><p>æµæ°´çº¿å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°å¥‡çš„æ¦‚å¿µï¼Œå®ƒèƒ½æå¤§çš„æé«˜ç”Ÿäº§æ•ˆç‡ï¼Œåœ¨å½“ä»£ç¤¾ä¼šæµæ°´çº¿éå¸¸æ™®éï¼Œæˆ‘ä»¬ç”¨çš„å‡ ä¹ä»»ä½•äº§å“ï¼ˆæ‰‹æœºã€ç”µè„‘ã€æ±½è½¦ã€æ°´æ¯ï¼‰ï¼Œéƒ½æ˜¯ä»æµæ°´çº¿ä¸Šç”Ÿäº§å‡ºæ¥çš„ï¼›<strong>åœ¨ Golang ä¸­ï¼Œæµæ°´çº¿ç”±å¤šä¸ªé˜¶æ®µç»„æˆï¼Œæ¯ä¸ªé˜¶æ®µä¹‹é—´é€šè¿‡ channel è¿æ¥ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ç”±å¤šä¸ªåŒæ—¶è¿è¡Œçš„ goroutine ç»„æˆ</strong></p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/20190124110810.png"></p><p>å¦‚ä¸Šå›¾ï¼Œä»æœ€ç®€å•çš„æµæ°´çº¿å…¥æ‰‹ï¼Œç”± 3 ä¸ªé˜¶æ®µç»„æˆï¼Œåˆ†åˆ«æ˜¯ Aã€Bã€Cï¼›ç¬¬ä¸€ä¸ªé˜¶æ®µçš„åç¨‹æ˜¯<strong>ç”Ÿäº§è€…</strong>ï¼Œå®ƒä»¬åªç”Ÿäº§æ•°æ®ï¼Œæœ€åä¸€ä¸ªé˜¶æ®µçš„åç¨‹æ˜¯<strong>æ¶ˆè´¹è€…</strong>ï¼ŒA æ˜¯ç”Ÿæˆè€…ï¼ŒC æ˜¯æ¶ˆè´¹è€…ï¼Œè€Œ B åªæ˜¯ä¸­é—´è¿‡ç¨‹çš„å¤„ç†è€…ï¼›A å’Œ B ä¹‹é—´æ˜¯é€šé“<code>aCh</code>ï¼ŒB å’Œ C ä¹‹é—´æ˜¯é€šé“<code>bCh</code>ï¼ŒA ç”Ÿæˆæ•°æ®ä¼ é€’ç»™ Bï¼ŒB ç”Ÿæˆæ•°æ®ä¼ é€’ç»™ C</p><blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œè®¾è®¡ä¸€ä¸ªç¨‹åºï¼šè®¡ç®—ä¸€ä¸ªæ•´æ•°åˆ‡ç‰‡ä¸­å…ƒç´ çš„å¹³æ–¹å€¼å¹¶æŠŠå®ƒæ‰“å°å‡ºæ¥ã€‚éå¹¶å‘çš„æ–¹å¼æ˜¯ä½¿ç”¨ for éå†æ•´ä¸ªåˆ‡ç‰‡ï¼Œç„¶åè®¡ç®—å¹³æ–¹ï¼Œæ‰“å°ç»“æœ</p></blockquote><p>æˆ‘ä»¬ä½¿ç”¨æµæ°´çº¿æ¨¡å‹å®ç°è¿™ä¸ªç®€å•çš„åŠŸèƒ½ï¼Œä»æµæ°´çº¿çš„è§’åº¦ï¼Œå¯ä»¥åˆ†ä¸º 3 ä¸ªé˜¶æ®µï¼š</p><ol><li>éå†åˆ‡ç‰‡ï¼Œè¿™æ˜¯ç”Ÿäº§è€…ã€‚</li><li>è®¡ç®—å¹³æ–¹å€¼ã€‚</li><li>æ‰“å°ç»“æœï¼Œè¿™æ˜¯æ¶ˆè´¹è€…ã€‚</li></ol><p>å…·ä½“ä»£ç ï¼Œå‚è€ƒ <a href="https://github.com/leeifme/Go-test/blob/master/go-concurrent/assembly-line/simple.go"><strong>simple.go</strong></a></p><ul><li><code>producer()</code>è´Ÿè´£ç”Ÿäº§æ•°æ®ï¼Œå®ƒä¼šæŠŠæ•°æ®å†™å…¥é€šé“ï¼Œå¹¶æŠŠå®ƒå†™æ•°æ®çš„é€šé“è¿”å›</li><li><code>square()</code>è´Ÿè´£ä»æŸä¸ªé€šé“è¯»æ•°å­—ï¼Œç„¶åè®¡ç®—å¹³æ–¹ï¼Œå°†ç»“æœå†™å…¥é€šé“ï¼Œå¹¶æŠŠå®ƒçš„è¾“å‡ºé€šé“è¿”å›</li><li><code>main()</code>è´Ÿè´£å¯åŠ¨ producer å’Œ squareï¼Œå¹¶ä¸”è¿˜æ˜¯æ¶ˆè´¹è€…ï¼Œè¯»å– suqre çš„ç»“æœï¼Œå¹¶æ‰“å°å‡ºæ¥</li></ul><p><strong>æµæ°´çº¿çš„ç‰¹ç‚¹</strong></p><ol><li>æ¯ä¸ªé˜¶æ®µæŠŠæ•°æ®é€šè¿‡ channel ä¼ é€’ç»™ä¸‹ä¸€ä¸ªé˜¶æ®µ</li><li>æ¯ä¸ªé˜¶æ®µè¦åˆ›å»º 1 ä¸ª goroutine å’Œ 1 ä¸ªé€šé“ï¼Œè¿™ä¸ª goroutine å‘é‡Œé¢å†™æ•°æ®ï¼Œå‡½æ•°è¦è¿”å›è¿™ä¸ªé€šé“</li><li>æœ‰ 1 ä¸ªå‡½æ•°æ¥ç»„ç»‡æµæ°´çº¿ï¼Œæˆ‘ä»¬ä¾‹å­ä¸­æ˜¯ main å‡½æ•°</li></ol><h3 id="æµæ°´çº¿-FAN-æ¨¡å¼"><a href="#æµæ°´çº¿-FAN-æ¨¡å¼" class="headerlink" title="æµæ°´çº¿ FAN æ¨¡å¼"></a>æµæ°´çº¿ FAN æ¨¡å¼</h3><blockquote><p>æµæ°´çº¿æ¨¡å‹è¿›é˜¶ï¼ŒFAN-IN å’Œ FAN-OUT æ¨¡å¼ï¼ŒFAN æ¨¡å¼å¯ä»¥è®©æˆ‘ä»¬çš„æµæ°´çº¿æ¨¡å‹æ›´å¥½çš„åˆ©ç”¨ Golang å¹¶å‘ï¼Œæé«˜è½¯ä»¶æ€§èƒ½</p></blockquote><p>è¿™é‡Œè¿˜æ˜¯ä»¥ç”Ÿäº§æ±½è½¦çš„æµæ°´çº¿ä¸ºä¾‹ï¼Œæ±½è½¦ç”Ÿäº§çº¿ä¸Šæœ‰ä¸ªé˜¶æ®µæ˜¯ç»™å°æ±½è½¦è£… 4 ä¸ªè½®å­ï¼Œå¯ä»¥æŠŠè¿™ä¸ªé˜¶æ®µä»»åŠ¡äº¤ç»™ 4 ä¸ªäººåŒæ—¶å»åšï¼Œè¿™ 4 ä¸ªäººæŠŠè½®å­éƒ½è£…å®Œåï¼Œå†æŠŠæ±½è½¦ç§»åŠ¨åˆ°ç”Ÿäº§çº¿ä¸‹ä¸€ä¸ªé˜¶æ®µï¼›è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°±æœ‰ä»»åŠ¡çš„åˆ†å‘ï¼Œå’Œä»»åŠ¡ç»“æœçš„æ”¶é›†ï¼›<strong>å…¶ä¸­ä»»åŠ¡åˆ†å‘æ˜¯ FAN-OUTï¼Œä»»åŠ¡æ”¶é›†æ˜¯ FAN-IN</strong></p><ul><li><strong>FAN-OUT æ¨¡å¼ï¼šå¤šä¸ª goroutine ä»åŒä¸€ä¸ªé€šé“è¯»å–æ•°æ®ï¼Œç›´åˆ°è¯¥é€šé“å…³é—­ï¼›</strong>OUT æ˜¯ä¸€ç§å¼ å¼€çš„æ¨¡å¼ï¼Œæ‰€ä»¥åˆè¢«ç§°ä¸ºæ‰‡å‡ºï¼Œå¯ä»¥ç”¨æ¥åˆ†å‘ä»»åŠ¡</li><li><strong>FAN-IN æ¨¡å¼ï¼š1 ä¸ª goroutine ä»å¤šä¸ªé€šé“è¯»å–æ•°æ®ï¼Œç›´åˆ°è¿™äº›é€šé“å…³é—­ï¼›</strong>IN æ˜¯ä¸€ç§æ”¶æ•›çš„æ¨¡å¼ï¼Œæ‰€ä»¥åˆè¢«ç§°ä¸ºæ‰‡å…¥ï¼Œç”¨æ¥æ”¶é›†å¤„ç†çš„ç»“æœ</li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ</p><p><img src="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2019/20190124112954.png"></p><p>ä¾ç„¶å»¶ç”¨ä¸Šé¢çš„æ¡ˆä¾‹éœ€æ±‚ï¼Œè®¡ç®—ä¸€ä¸ªæ•´æ•°åˆ‡ç‰‡ä¸­å…ƒç´ çš„å¹³æ–¹å€¼å¹¶æŠŠå®ƒæ‰“å°å‡ºæ¥ï¼Œè¿™æ¬¡æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ï¼Œæ·»åŠ  <code>merge()</code> æ–¹æ³•ï¼Œå…·ä½“ä»£ç å‚è€ƒ <a href="https://github.com/leeifme/Go-test/blob/master/go-concurrent/assembly-line/fan.go"><strong>fan.go</strong></a></p><ul><li><code>producer()</code>ä¿æŒä¸å˜ï¼Œè´Ÿè´£ç”Ÿäº§æ•°æ®</li><li><code>squre()</code>ä¹Ÿä¸å˜ï¼Œè´Ÿè´£è®¡ç®—å¹³æ–¹å€¼</li><li>ä¿®æ”¹<code>main()</code>ï¼Œå¯åŠ¨ 3 ä¸ª squareï¼Œè¿™ 3 ä¸ª squre ä» producer ç”Ÿæˆçš„é€šé“è¯»æ•°æ®ï¼Œ<strong>è¿™æ˜¯ FAN-OUT</strong></li><li>å¢åŠ <code>merge()</code>ï¼Œå…¥å‚æ˜¯ 3 ä¸ª square å„è‡ªå†™æ•°æ®çš„é€šé“ï¼Œç»™è¿™ 3 ä¸ªé€šé“åˆ†åˆ«å¯åŠ¨ 1 ä¸ªåç¨‹ï¼ŒæŠŠæ•°æ®å†™å…¥åˆ°è‡ªå·±åˆ›å»ºçš„é€šé“ï¼Œå¹¶è¿”å›è¯¥é€šé“ï¼Œ<strong>è¿™æ˜¯ FAN-IN</strong></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Go è¯­è¨€æ˜¯ä¸ºå¹¶å‘è€Œç”Ÿçš„è¯­è¨€ï¼ŒGo è¯­è¨€æ˜¯ä¸ºæ•°ä¸å¤šçš„åœ¨è¯­è¨€å±‚é¢å®ç°å¹¶å‘çš„è¯­è¨€ï¼›ä¹Ÿæ­£æ˜¯ Go è¯­è¨€çš„å¹¶å‘ç‰¹æ€§ï¼Œå¸å¼•äº†</summary>
      
    
    
    
    <category term="è®¾è®¡å¼€å‘" scheme="https://liei.cc/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Go" scheme="https://liei.cc/blog/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>ç®€åŒ– Kubernetes åº”ç”¨éƒ¨ç½²å·¥å…· -- Helm</title>
    <link href="https://liei.cc/2018/k8s-deploy-tool-helm.html"/>
    <id>https://liei.cc/2018/k8s-deploy-tool-helm.html</id>
    <published>2018-11-10T14:15:15.000Z</published>
    <updated>2018-11-10T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ"><a href="#å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ" class="headerlink" title="å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ"></a>å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ</h3><ul><li><strong><code>Docker</code></strong>: é•œåƒæ˜¯æŠŠä¸€ä¸ªå•çº¯çš„ App å’Œå®ƒçš„å®‰è£…ç¯å¢ƒæ•´åˆåœ¨ä¸€èµ·ã€‚</li><li><strong><code>Kubertnetes</code></strong>: ç®¡ç† Docker å®¹å™¨çš„ç”Ÿæˆå’Œæ¯ç­ï¼Œä¿è¯ Docker å®¹å™¨å¯¹åº” App çš„é«˜å¯ç”¨ï¼ˆç›‘æ§ã€è‡ªåŠ¨åˆ›å»ºï¼‰å’Œæ˜“ç»´æŠ¤ï¼ˆéƒ¨ç½²å’Œå¯¹å¤–æš´éœ²ã€åŠ¨æ€æ‰©å®¹ã€å¯åŠ¨åœæ­¢åˆ é™¤ç­‰ï¼‰ã€‚</li><li><strong><code>Helm</code></strong>: æ˜¯ä¸ºäº†æ–¹ä¾¿é…ç½®å’Œéƒ¨ç½²ã€å‡çº§å’Œå›æ»šåº”ç”¨ï¼Œå°¤å…¶æ˜¯å¤šä¸ª Service ç»„åˆåˆ›å»ºçš„ä¸€ä¸ªå¤§å‹åº”ç”¨ï¼Œæ¯”å¦‚ç½‘ç«™</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨ï¼Ÿ</h3><blockquote><p>é¦–å…ˆåœ¨åŸæ¥é¡¹ç›®ä¸­éƒ½æ˜¯åŸºäº yaml æ–‡ä»¶æ¥è¿›è¡Œéƒ¨ç½²å‘å¸ƒçš„ï¼Œè€Œç›®å‰é¡¹ç›®å¤§éƒ¨åˆ†å¾®æœåŠ¡åŒ–æˆ–è€…æ¨¡å—åŒ–ï¼Œä¼šåˆ†æˆå¾ˆå¤šä¸ªç»„ä»¶æ¥éƒ¨ç½²ï¼Œæ¯ä¸ªç»„ä»¶å¯èƒ½å¯¹åº”ä¸€ä¸ª deployment.yaml, ä¸€ä¸ª service.yaml, ä¸€ä¸ª Ingress.yaml è¿˜å¯èƒ½å­˜åœ¨å„ç§ä¾èµ–å…³ç³»ï¼Œè¿™æ ·ä¸€ä¸ªé¡¹ç›®å¦‚æœæœ‰ 5 ä¸ªç»„ä»¶ï¼Œå¾ˆå¯èƒ½å°±æœ‰ 15 ä¸ªä¸åŒçš„ yaml æ–‡ä»¶ï¼Œè¿™äº› yaml åˆ†æ•£å­˜æ”¾ï¼Œå¦‚æœæŸå¤©è¿›è¡Œé¡¹ç›®æ¢å¤çš„è¯ï¼Œå¾ˆéš¾çŸ¥é“éƒ¨ç½²é¡ºåºï¼Œä¾èµ–å…³ç³»ç­‰ï¼Œè€Œæ‰€æœ‰è¿™äº›åŒ…æ‹¬</p><ul><li>åŸºäº yaml é…ç½®çš„é›†ä¸­å­˜æ”¾</li><li>åŸºäºé¡¹ç›®çš„æ‰“åŒ…</li><li>ç»„ä»¶é—´çš„ä¾èµ–</li></ul><p>éƒ½å¯ä»¥é€šè¿‡ helm æ¥è¿›è¡Œè§£å†³</p></blockquote><h3 id="Helm-åŸºæœ¬æ¦‚å¿µ"><a href="#Helm-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Helm åŸºæœ¬æ¦‚å¿µ"></a>Helm åŸºæœ¬æ¦‚å¿µ</h3><blockquote><p>Helm å¯ä»¥ç†è§£ä¸º Kubernetes çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å‘ç°ã€å…±äº«å’Œä½¿ç”¨ä¸º Kubernetes æ„å»ºçš„åº”ç”¨ï¼Œå®ƒåŒ…å«å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ</p><ul><li>Chartï¼šä¸€ä¸ª Helm åŒ…ï¼Œå…¶ä¸­åŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨æ‰€éœ€è¦çš„é•œåƒã€ä¾èµ–å’Œèµ„æºå®šä¹‰ç­‰ï¼Œè¿˜å¯èƒ½åŒ…å« Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡å®šä¹‰</li><li>Release: åœ¨ Kubernetes é›†ç¾¤ä¸Šè¿è¡Œçš„ Chart çš„ä¸€ä¸ªå®ä¾‹ã€‚åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Šï¼Œä¸€ä¸ª Chart å¯ä»¥å®‰è£…å¾ˆå¤šæ¬¡æ¯æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ releaseã€‚ä¾‹å¦‚ä¸€ä¸ª MySQL Chartï¼Œå¦‚æœæƒ³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸¤ä¸ªæ•°æ®åº“ï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ª Chart å®‰è£…ä¸¤æ¬¡ã€‚æ¯æ¬¡å®‰è£…éƒ½ä¼šç”Ÿæˆè‡ªå·±çš„ Releaseï¼Œä¼šæœ‰è‡ªå·±çš„ Release åç§°</li><li>Repositoryï¼šç”¨äºå‘å¸ƒå’Œå­˜å‚¨ Chart çš„ä»“åº“</li></ul></blockquote><h4 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h4><ul><li>Helm æ˜¯ä¸€ä¸ª Chart ç®¡ç†å™¨: <a href="https://github.com/kubernetes/helm">GitHub - kubernetes&#x2F;helm: The Kubernetes Package Manager</a></li><li>Charts æ˜¯ä¸€ç»„é…ç½®å¥½çš„ Kubernetes èµ„æºï¼ˆå®šä¹‰ï¼‰ç»„åˆ</li><li>Release æ˜¯ä¸€ç»„å·²ç»éƒ¨ç½²åˆ° Kubernetes ä¸Šçš„èµ„æºé›†åˆ</li></ul><h4 id="Chart-çš„åŸºæœ¬ç»“æ„"><a href="#Chart-çš„åŸºæœ¬ç»“æ„" class="headerlink" title="Chart çš„åŸºæœ¬ç»“æ„"></a>Chart çš„åŸºæœ¬ç»“æ„</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ Chart.yaml</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ templates</span><br><span class="line">â”‚   â”œâ”€â”€ NOTES.txt</span><br><span class="line">â”‚   â”œâ”€â”€ _helpers.tpl</span><br><span class="line">â”‚   â”œâ”€â”€ deployment.yaml</span><br><span class="line">â”‚   â”œâ”€â”€ pvc.yaml</span><br><span class="line">â”‚   â”œâ”€â”€ secrets.yaml</span><br><span class="line">â”‚   â””â”€â”€ svc.yaml</span><br><span class="line">â””â”€â”€ values.yaml</span><br></pre></td></tr></table></figure><h4 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><ol><li>åˆ›å»ºå¯é…ç½®çš„ Release</li><li>å‡çº§ã€åˆ é™¤ã€æŸ¥çœ‹ç”± Helm åˆ›å»ºçš„ Release</li></ol><h4 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h4><ol><li><strong><code>Helm Client</code></strong> å®¢æˆ·ç«¯<ul><li>åˆ¶ä½œã€æ‹‰å–ã€æŸ¥æ‰¾å’ŒéªŒè¯ Chart</li><li>å®‰è£…æœåŠ¡ç«¯ Tiller</li><li>æŒ‡ç¤ºæœåŠ¡ç«¯ Tiller åšäº‹ï¼Œæ¯”å¦‚æ ¹æ® chart åˆ›å»ºä¸€ä¸ª Release</li></ul></li><li>helm æœåŠ¡ç«¯ <strong><code>tiller</code></strong><br>å®‰è£…åœ¨ Kubernetes é›†ç¾¤å†…çš„ä¸€ä¸ªåº”ç”¨ï¼Œ ç”¨æ¥æ‰§è¡Œå®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤ï¼Œç®¡ç† Release</li></ol><h3 id="Helmçš„å®‰è£…"><a href="#Helmçš„å®‰è£…" class="headerlink" title="Helmçš„å®‰è£…"></a>Helmçš„å®‰è£…</h3><h4 id="Helm-Client-å®‰è£…"><a href="#Helm-Client-å®‰è£…" class="headerlink" title="Helm Client å®‰è£…"></a><code>Helm Client</code> å®‰è£…</h4><p>ä¸‹è½½ helm çš„ç›¸å…³ç‰ˆæœ¬: <a href="https://github.com/kubernetes/helm/releases">https://github.com/kubernetes/helm/releases</a></p><p>å®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ä¸‹è½½ Helm </li><li>è§£åŒ…ï¼štar -zxvf helm-v2.11.0-linux-amd64.tgz</li><li>helm äºŒè¿›åˆ¶æ–‡ä»¶ç§»åˆ° &#x2F; usr&#x2F;local&#x2F;bin ç›®å½•</li></ol><h4 id="Helm-Tiller-å®‰è£…"><a href="#Helm-Tiller-å®‰è£…" class="headerlink" title="Helm Tiller  å®‰è£…"></a><code>Helm Tiller </code> å®‰è£…</h4><blockquote><p>å› ä¸º Kubernetes APIServer å¼€å¯äº† RBAC è®¿é—®æ§åˆ¶ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»º tiller ä½¿ç”¨çš„ service account: tiller å¹¶åˆ†é…åˆé€‚çš„è§’è‰²ç»™å®ƒã€‚è¿™é‡Œç®€å•èµ·è§ç›´æ¥åˆ†é… cluster-admin è¿™ä¸ªé›†ç¾¤å†…ç½®çš„ ClusterRole ç»™å®ƒã€‚åˆ›å»º rbac-config.yaml æ–‡ä»¶ï¼š</p></blockquote><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># rbac-config.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tiller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tiller</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">tiller</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨ helm éƒ¨ç½² tiller:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">helm init --service-account tiller --skip-refresh</span><br></pre></td></tr></table></figure><p>å¦‚æœç›´æ¥æ‰§è¡Œéƒ¨ç½²è¯­å¥ï¼Œè¦é“¾æ¥ <a href="https://kubernetes-charts.storage.googleapis.com/">https://kubernetes-charts.storage.googleapis.com</a> å»ä¸‹è½½é•œåƒï¼›åœ¨å›½å†…è¿™ä¸ªåœ°å€ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½å…¶ä»–é•œåƒï¼›docker pull fengzos&#x2F;tiller:v2.11.0 è¿™ä¸ªé•œåƒæ˜¯ç›´æ¥ä» gcr.io&#x2F;kubernetes-helm&#x2F;tiller:v2.11.0 ç»§æ‰¿è¿‡æ¥çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull fengzos/tiller</span><br><span class="line">helm init --service-account tiller --upgrade -i fengzos/tiller:latest  --skip-refresh</span><br></pre></td></tr></table></figure><h4 id="å¸®åŠ©æ–‡æ¡£"><a href="#å¸®åŠ©æ–‡æ¡£" class="headerlink" title="å¸®åŠ©æ–‡æ¡£"></a>å¸®åŠ©æ–‡æ¡£</h4><ol><li><code>helm help</code> æŸ¥çœ‹ helm æ”¯æŒçš„å‘½ä»¤</li><li><code>helm somecommand -h</code> æŸ¥çœ‹æŸä¸ªå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•</li><li><code>helm version</code> æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç‰ˆæœ¬ï¼Œå¦‚æœåªæ˜¾ç¤ºäº†å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼Œè¯´æ˜æ²¡æœ‰è¿ä¸ŠæœåŠ¡ç«¯ã€‚ å®ƒä¼šè‡ªåŠ¨å» K8s ä¸Š kube-system å‘½åç©ºé—´ä¸‹æŸ¥æ‰¾æ˜¯å¦æœ‰ Tiller çš„ Pod åœ¨è¿è¡Œï¼Œé™¤éä½ é€šè¿‡ <code>--tiller-namespace</code>æ ‡ç­¾ or <code>TILLER_NAMESPACE</code>ç¯å¢ƒå˜é‡æŒ‡å®š</li></ol><h3 id="Helmçš„ä½¿ç”¨"><a href="#Helmçš„ä½¿ç”¨" class="headerlink" title="Helmçš„ä½¿ç”¨"></a>Helmçš„ä½¿ç”¨</h3><h4 id="ä½¿ç”¨-Chart"><a href="#ä½¿ç”¨-Chart" class="headerlink" title="ä½¿ç”¨ Chart"></a>ä½¿ç”¨ Chart</h4><ul><li><code>helm search</code> æŸ¥æ‰¾å¯ç”¨çš„ Charts</li><li><code>helm inspect</code> æŸ¥çœ‹æŒ‡å®š Chart çš„åŸºæœ¬ä¿¡æ¯</li><li><code>helm install</code> æ ¹æ®æŒ‡å®šçš„ Chart éƒ¨ç½²ä¸€ä¸ª Release åˆ° K8s</li><li><code>helm create</code> åˆ›å»ºè‡ªå·±çš„ Chart</li><li><code>helm package</code> æ‰“åŒ… Chartï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…æ–‡ä»¶</li></ul><h4 id="ç®¡ç†-Release"><a href="#ç®¡ç†-Release" class="headerlink" title="ç®¡ç† Release"></a>ç®¡ç† Release</h4><ul><li><code>helm list</code> åˆ—å‡ºå·²ç»éƒ¨ç½²çš„ Release</li><li><code>helm delete [RELEASE]</code> åˆ é™¤ä¸€ä¸ª Release. å¹¶æ²¡æœ‰ç‰©ç†åˆ é™¤ï¼Œ å‡ºäºå®¡è®¡éœ€è¦ï¼Œå†å²å¯æŸ¥</li><li><code>helm delete --purge [RELEASE]</code> ç§»é™¤æ‰€æœ‰ä¸æŒ‡å®š Release ç›¸å…³çš„ K8sèµ„æºå’Œæ‰€æœ‰è¿™ä¸ª Release çš„è®°å½•</li><li><code>helm status [RELEASE]</code> æŸ¥çœ‹æŒ‡å®šçš„ Release ä¿¡æ¯ï¼Œå³ä½¿ä½¿ç”¨<code>helm delete</code>å‘½ä»¤åˆ é™¤çš„ Release.</li><li><code>helm upgrade</code> å‡çº§æŸä¸ª Release</li><li><code>helm rollback [RELEASE] [REVISION]</code> å›æ»š Release åˆ°æŒ‡å®šå‘å¸ƒåºåˆ—</li><li><code>helm get values [RELEASE]</code> æŸ¥çœ‹ Release çš„é…ç½®æ–‡ä»¶å€¼</li></ul><h4 id="ç®¡ç†-Chart-Repository"><a href="#ç®¡ç†-Chart-Repository" class="headerlink" title="ç®¡ç† Chart Repository"></a>ç®¡ç† Chart Repository</h4><ul><li><code>helm repo list</code></li><li><code>helm repo add [RepoName] [RepoUrl]</code></li><li><code>helm repo update</code></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ&quot;&gt;&lt;/a&gt;å…ˆåŒºåˆ†ä¸‹æ¦‚å¿µ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Docker&lt;/code&gt;&lt;/strong&gt;: é•œåƒæ˜¯æŠŠä¸€ä¸ªå•çº¯çš„ </summary>
      
    
    
    
    <category term="æŠ€æœ¯åŠ æ²¹ç«™" scheme="https://liei.cc/blog/categories/%E6%8A%80%E6%9C%AF%E5%8A%A0%E6%B2%B9%E7%AB%99/"/>
    
    
    <category term="Cloud Navite" scheme="https://liei.cc/blog/tags/cloud-navite/"/>
    
    <category term="Kubernetes" scheme="https://liei.cc/blog/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>vscode + sftp å¼€å‘ç¯å¢ƒåŒæ­¥å·®å¼‚æ–‡ä»¶</title>
    <link href="https://liei.cc/2018/sftp-sync-project.html"/>
    <id>https://liei.cc/2018/sftp-sync-project.html</id>
    <published>2018-09-15T14:15:15.000Z</published>
    <updated>2018-09-15T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><div class="tag-plugin note" ><div class="title"><strong>radiation,</strong></div><div class="body"><p>è§£å†³éœ€æ±‚ï¼š æœ¬åœ°æ˜¯ win10 ç³»ç»Ÿï¼Œä»£ç éœ€è¦åœ¨ linux ä¸‹è·‘ï¼Œåˆä¸æƒ³è£…è™šæ‹Ÿæœºæˆ–åŒç³»ç»Ÿï¼› æ‰€ä»¥ï¼Œé¡¹ç›®ç”¨åˆ°è¿æ¥è¿œç¨‹æµ‹è¯•æœåŠ¡å™¨è¿›è¡Œå¼€å‘è”è°ƒï¼Œéœ€è¦å®‰è£… SFTP&#x2F;FTP çš„æ‰©å±•æ’ä»¶æ‰èƒ½åŒæ­¥ä»£ç ï¼› è¿˜æœ‰å…¶ä»–å®ç°æ–¹æ³•ï¼Œå¦‚ï¼ŒGit å·¥ä½œæµã€winscpã€rzlz ç­‰ï¼Œä½†å¤§éƒ½ä¸å¤ªçµæ´»ï¼Œç”šè‡³éº»çƒ¦</p></div></div><h2 id="CentOS-7-é…ç½®ä½¿ç”¨-SFTP-æœåŠ¡å™¨"><a href="#CentOS-7-é…ç½®ä½¿ç”¨-SFTP-æœåŠ¡å™¨" class="headerlink" title="CentOS 7 é…ç½®ä½¿ç”¨ SFTP æœåŠ¡å™¨"></a>CentOS 7 é…ç½®ä½¿ç”¨ SFTP æœåŠ¡å™¨</h2><h3 id="ä½•ä¸º-SFTPï¼Ÿ"><a href="#ä½•ä¸º-SFTPï¼Ÿ" class="headerlink" title="ä½•ä¸º SFTPï¼Ÿ"></a>ä½•ä¸º SFTPï¼Ÿ</h3><p>SFTPï¼Œå³ SSH æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆ SSH File Transfer Protocol ï¼‰ï¼Œæˆ–è€…è¯´æ˜¯å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆ Secure File Transfer Protocol ï¼‰ã€‚SFTP æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ SSH å°è£…åè®®åŒ…ï¼Œé€šè¿‡å®‰å…¨è¿æ¥ä»¥ç›¸ä¼¼çš„æ–¹å¼å·¥ä½œã€‚å®ƒçš„ä¼˜åŠ¿åœ¨äºå¯ä»¥åˆ©ç”¨å®‰å…¨çš„è¿æ¥ä¼ è¾“æ–‡ä»¶ï¼Œè¿˜èƒ½æµè§ˆæœ¬åœ°å’Œè¿œç¨‹ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒSFTP éƒ½æ¯” FTP æ›´å¯å–ï¼Œå› ä¸ºå®ƒå…·æœ‰æœ€åŸºæœ¬çš„å®‰å…¨ç‰¹æ€§å’Œèƒ½åˆ©ç”¨ SSH è¿æ¥çš„èƒ½åŠ›ï¼ŒFTP æ˜¯ä¸€ç§ä¸å®‰å…¨çš„åè®®ï¼Œåªèƒ½åœ¨æœ‰é™çš„æƒ…å†µä¸‹æˆ–åœ¨æ‚¨ä¿¡ä»»çš„ç½‘ç»œä¸Šä½¿ç”¨ã€‚</p><p><strong>å…ˆå†³æ¡ä»¶ï¼š</strong></p><p>æœåŠ¡å™¨ <code>OpenSSH-Server</code> ç‰ˆæœ¬æœ€ä½ 4.8p1ï¼Œå› ä¸ºé…ç½®æƒé™éœ€è¦ç‰ˆæœ¬æ·»åŠ çš„æ–°é…ç½®é¡¹ <code>ChrootDirectory</code> æ¥å®Œæˆã€‚</p><p>å¦‚ä½•æŸ¥çœ‹ OpenSSH ç‰ˆæœ¬ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ssh -V</span></span><br><span class="line">OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç”¨æˆ·ä¿¡æ¯"><a href="#åˆ›å»ºç”¨æˆ·ä¿¡æ¯" class="headerlink" title="åˆ›å»ºç”¨æˆ·ä¿¡æ¯"></a>åˆ›å»ºç”¨æˆ·ä¿¡æ¯</h3><p>æ·»åŠ ç”¨æˆ·ç»„ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">groupadd sftp</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ ç”¨æˆ·ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">useradd -g sftp -s /sbin/nologin -M leeifme</span></span><br></pre></td></tr></table></figure><p>å‚æ•°æ³¨è§£ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-g              # åŠ å…¥ç”¨æˆ·ç»„</span><br><span class="line">-s              # æŒ‡å®šç”¨æˆ·ç™»å…¥åæ‰€ä½¿ç”¨çš„shell</span><br><span class="line">/sbin/nologin   # ç”¨æˆ·ä¸å…è®¸ç™»å½•</span><br><span class="line">-M              # ä¸è¦è‡ªåŠ¨å»ºç«‹ç”¨æˆ·çš„ç™»å…¥ç›®å½•</span><br></pre></td></tr></table></figure><p>è®¾ç½®ç”¨æˆ·å¯†ç ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">passwd leeifme</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç”¨æˆ·ç›®å½•å¹¶è®¾ç½®æƒé™"><a href="#åˆ›å»ºç”¨æˆ·ç›®å½•å¹¶è®¾ç½®æƒé™" class="headerlink" title="åˆ›å»ºç”¨æˆ·ç›®å½•å¹¶è®¾ç½®æƒé™"></a>åˆ›å»ºç”¨æˆ·ç›®å½•å¹¶è®¾ç½®æƒé™</h3><p>åˆ›å»º sftp ä¸»ç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> /home/danaos</span><br></pre></td></tr></table></figure><p>è®¾ç½® sftp ä¸»ç›®å½•æƒé™ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">chown</span> root:sftp /home/danaos</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å¤¹æ‰€æœ‰è€…å¿…é¡»æ˜¯ rootï¼Œç”¨æˆ·ç»„å¯ä»¥ä¸æ˜¯ root</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> 755 /home/danaos</span><br></pre></td></tr></table></figure><p>æƒé™ä¸èƒ½è¶…è¿‡ 755 ä½†ä¸åŒ…æ‹¬ 755ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç™»å½•æŠ¥é”™</p><h3 id="åˆ›å»ºä¸Šä¼ ç›®å½•å¹¶è®¾ç½®æƒé™"><a href="#åˆ›å»ºä¸Šä¼ ç›®å½•å¹¶è®¾ç½®æƒé™" class="headerlink" title="åˆ›å»ºä¸Šä¼ ç›®å½•å¹¶è®¾ç½®æƒé™"></a>åˆ›å»ºä¸Šä¼ ç›®å½•å¹¶è®¾ç½®æƒé™</h3><p>åœ¨<code>/home/danaos/</code>ä¸»ç›®å½•ä¸‹åˆ›å»º<code>archer</code>é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå¹¶è®¾ç½®æ‰€æœ‰è€…æ˜¯ï¼š<code>leeifme</code>ï¼Œç”¨æˆ·ç»„éš¶å±ï¼š<code>sftp</code>ï¼Œè¿™æ ·æ–°å¢çš„å¸å·æ‰èƒ½æœ‰ä¸Šä¼ ç¼–è¾‘çš„æƒé™ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p /home/danaos/archer</span><br><span class="line">$ <span class="built_in">chown</span> leeifme:sftp /home/danaos/archer</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-sshd-config-é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹-sshd-config-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ sshd_config é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ sshd_config é…ç½®æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim /etc/ssh/sshd_config</span></span><br></pre></td></tr></table></figure><p>å°†æ­¤è¡Œæ³¨é‡Šæ‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Subsystem sftp /usr/libexec/openssh/sftp-server</span></span><br></pre></td></tr></table></figure><p>åœ¨æ­¤è¡Œä¸‹é¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Subsystem sftp internal-sftp       <span class="comment"># æŒ‡å®šä½¿ç”¨sftpæœåŠ¡ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„internal-sftp</span></span><br><span class="line">Match Group sftp                   <span class="comment"># åŒ¹é…sftpç»„çš„ç”¨æˆ·,è‹¥è¦åŒ¹é…å¤šä¸ªç»„,å¯ç”¨é€—å·åˆ†å¼€</span></span><br><span class="line">ChrootDirectory /home/danaos       <span class="comment"># é™åˆ¶ç”¨æˆ·çš„æ ¹ç›®å½•</span></span><br><span class="line">ForceCommand internal-sftp         <span class="comment"># åªèƒ½ç”¨äºsftpç™»å½•</span></span><br><span class="line">AllowTcpForwarding no              <span class="comment"># ç¦æ­¢ç”¨æˆ·ä½¿ç”¨ç«¯å£è½¬å‘</span></span><br><span class="line">X11Forwarding no                   <span class="comment"># ç¦æ­¢ç”¨æˆ·ä½¿ç”¨ç«¯å£è½¬å‘</span></span><br></pre></td></tr></table></figure><h3 id="é‡å¯-SSH-æœåŠ¡"><a href="#é‡å¯-SSH-æœåŠ¡" class="headerlink" title="é‡å¯ SSH æœåŠ¡"></a>é‡å¯ SSH æœåŠ¡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿç™»å½•ã€ä¸Šä¼ ã€ä¸‹è½½ç­‰æ“ä½œ"><a href="#æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿç™»å½•ã€ä¸Šä¼ ã€ä¸‹è½½ç­‰æ“ä½œ" class="headerlink" title="æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿç™»å½•ã€ä¸Šä¼ ã€ä¸‹è½½ç­‰æ“ä½œ"></a>æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿç™»å½•ã€ä¸Šä¼ ã€ä¸‹è½½ç­‰æ“ä½œ</h3><p>åœ¨<code>10.28.204.61</code>æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç™»å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sftp leeifme@192.168.50.124</span><br><span class="line">leeifme@192.168.50.124<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Connected to leeifme@192.168.50.124.</span></span><br><span class="line"><span class="string">sftp&gt; ls</span></span><br><span class="line"><span class="string">archer</span></span><br><span class="line"><span class="string">sftp&gt; cd archer/</span></span><br><span class="line"><span class="string">sftp&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ </strong></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sftp&gt; put test.go</span><br><span class="line">Uploading test.go to /archer/test.go</span><br><span class="line">test.go             100% 3824   626.2KB/s   00:00</span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure><p><strong>ä¸‹è½½</strong></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sftp&gt; get test.go</span><br><span class="line">Fetching /archer/test.go to test.go</span><br><span class="line">/archer/oplog.go    100% 3824   475.1KB/s   00:00</span><br><span class="line">sftp&gt;</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤</strong></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sftp&gt; <span class="built_in">rm</span> test.go</span><br><span class="line">Removing test.go</span><br></pre></td></tr></table></figure><p><strong>æ›´å¤šå‘½ä»¤è¯·å‚é˜…</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">sftp&gt; </span><span class="language-bash"><span class="built_in">help</span></span></span><br></pre></td></tr></table></figure><h2 id="vscode-é…ç½®-sftp"><a href="#vscode-é…ç½®-sftp" class="headerlink" title="vscode é…ç½® sftp"></a>vscode é…ç½® sftp</h2><h3 id="ä¸‹è½½-sftp-æ’ä»¶"><a href="#ä¸‹è½½-sftp-æ’ä»¶" class="headerlink" title="ä¸‹è½½ sftp æ’ä»¶"></a>ä¸‹è½½ sftp æ’ä»¶</h3><ul><li>åœ¨ vscode ä¸­å¿«æ·é”® <code>ctrl+shift+P</code> æ‰“å¼€æŒ‡ä»¤çª—å£ï¼Œè¾“å…¥<code>extension:install</code>ï¼Œå›è½¦ï¼Œå·¦ä¾§å³æ‰“å¼€æ‰©å±•å®‰è£…çš„ç•Œé¢ </li><li>åœ¨æœç´¢æ¡†ä¸­è¾“å…¥<code>sftp</code>ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯éœ€è¦å®‰è£…çš„ï¼Œç‚¹å®‰è£…(å¯ä»¥å‚è€ƒä¸‹è½½æ•°ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„æ’ä»¶ï¼ŒåŠŸèƒ½å¤§éƒ½å¤§åŒå°å¼‚)</li></ul><h3 id="åœ¨-vscode-çš„å·¥ç¨‹ä¸­é…ç½®-sftp-json"><a href="#åœ¨-vscode-çš„å·¥ç¨‹ä¸­é…ç½®-sftp-json" class="headerlink" title="åœ¨ vscode çš„å·¥ç¨‹ä¸­é…ç½® sftp.json"></a>åœ¨ vscode çš„å·¥ç¨‹ä¸­é…ç½® sftp.json</h3><p>ç„¶åå¿«æ·é”® <code>ctrl+shift+P</code> æ‰“å¼€æŒ‡ä»¤çª—å£ï¼Œè¾“å…¥<code>sftp:config</code>ï¼Œå›è½¦ï¼Œå°±ä¼šåœ¨å½“å‰å·¥ä½œå·¥ç¨‹çš„<code>.vscode</code>æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ª<code>sftp.json</code>æ–‡ä»¶ï¼Œä¸çŸ¥é“å“ªå¤©ä¼¼ä¹æ˜¯æ’ä»¶æ›´æ–°äº†ï¼Œé»˜è®¤çš„æ–‡ä»¶éå¸¸ç©ºï¼Œæˆ‘ä»¬åªèƒ½æ‰‹åŠ¨é…ç½®æ–‡ä»¶çš„å‚æ•°äº†ã€‚é…ç½®å¥½<code>host, port, username, privateKeyPath, remotePath, ignore</code>è¿™å‚æ•°å³å¯ï¼š</p><ul><li>hostï¼šå·¥ä½œç«™çš„ IP åœ°å€</li><li>portï¼šssh çš„ç«¯å£</li><li>usernameï¼šå·¥ä½œç«™è‡ªå·±çš„ç”¨æˆ·å</li><li>privateKeyPathï¼šå­˜æ”¾åœ¨æœ¬åœ°çš„å·²é…ç½®å¥½çš„ç”¨äºç™»å½•å·¥ä½œç«™çš„å¯†é’¥æ–‡ä»¶ã€‚å’Œä¸‹é¢çš„ä½¿ç”¨å¯†ç äºŒé€‰ä¸€ï¼ˆå¯ä»¥æ˜¯ openssh æ ¼å¼çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ ppk æ ¼å¼çš„ï¼‰</li><li>passwordï¼šå·¥ä½œç«™è‡ªå·±çš„ç”¨æˆ·å¯†ç ã€‚ä½¿ç”¨å¯†é’¥å’Œä½¿ç”¨å¯†ç é€‰ç”¨ä¸€ç§å³å¯ï¼›ä½¿ç”¨å¯†ç çš„è¯å·¥ä½œç«™ä¸ç”¨é…ç½® sshï¼Œä½†ä½¿ç”¨å¯†é’¥çš„è¯å·¥ä½œç«™ä¸Šéœ€è¦é…ç½®å¥½ sshï¼Œpassword å°±å¯ä»¥å¡« null</li><li>protocolï¼šåè®®ç±»å‹ï¼Œé»˜è®¤é€‰<code>&quot;sftp&quot;</code></li><li>remotePathï¼šå·¥ä½œç«™ä¸Šä¸æœ¬åœ°å·¥ç¨‹åŒæ­¥çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œéœ€è¦å’Œæœ¬åœ°å·¥ç¨‹æ–‡ä»¶æ ¹ç›®å½•åŒåï¼Œä¸”åœ¨ä½¿ç”¨ sftp ä¸Šä¼ æ–‡ä»¶ä¹‹å‰è¦æ‰‹åŠ¨åœ¨å·¥ä½œç«™ä¸Šä½¿ç”¨mkdirç”Ÿæˆè¿™ä¸ªæ ¹ç›®å½•ï¼Œæ ¹ç›®å½•ä¸‹çš„å…¶ä»–å­ç›®å½•ä¼šè‡ªåŠ¨å¯¹åº”ç”Ÿæˆ</li><li>ignoreï¼šæŒ‡å®šåœ¨ä½¿ç”¨<code>sftp: sync to remote</code>çš„æ—¶å€™å¿½ç•¥çš„æ–‡ä»¶åŠæ–‡ä»¶å¤¹ï¼Œæ³¨æ„æ¯ä¸€è¡Œåé¢æœ‰é€—å·ï¼Œæœ€åä¸€è¡Œæ²¡æœ‰é€—å·</li><li>debugï¼š é»˜è®¤æ˜¯ falseï¼Œå¦‚æœè®¾ç½®ä¸º trueï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡èœå•çš„ æŸ¥çœ‹ -&gt; è¾“å‡º æ‰“å¼€è¾“å‡ºç•Œé¢ï¼Œçœ‹åˆ°æ‰“å°ï¼Œæ€€ç–‘è‡ªå·±è¿æ¥æœ‰é—®é¢˜çš„å¯ä»¥æ‰“å¼€çœ‹çœ‹</li><li>uploadOnSave: é»˜è®¤æ˜¯ falseï¼Œå»ºè®®è®¾ç½®æˆ trueï¼Œè¿™æ ·æ¯æ¬¡ä¿®æ”¹å ctrl+s ä¿å­˜åä¼šè‡ªåŠ¨åŒæ­¥ã€‚å¦åˆ™å°±éœ€è¦æ‰‹åŠ¨åŒæ­¥</li></ul><p>ä¸¾ä¸ªæ —å­ï¼šï¼ˆ<strong>è®°ä½ä¸èƒ½æœ‰ä»»ä½•æ³¨é‡Šå†…å®¹</strong>ï¼‰</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sftp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192.168.50.124&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leeifme&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XXXXXXXXXX&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remotePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;archer/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;watcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/&quot;</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;autoUpload&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;autoDelete&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> </span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ignore&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;**/.git/**&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;div class=&quot;tag-plugin note&quot; &gt;&lt;div class=&quot;title&quot;&gt;&lt;strong&gt;radiation,&lt;/stro</summary>
      
    
    
    
    <category term="æŠ˜è…¾ä¸æ­¢" scheme="https://liei.cc/blog/categories/%E6%8A%98%E8%85%BE%E4%B8%8D%E6%AD%A2/"/>
    
    
    <category term="VSCode" scheme="https://liei.cc/blog/tags/vscode/"/>
    
    <category term="Linux" scheme="https://liei.cc/blog/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>æš´åŠ›å­¦ä¹  k8s - é›†ç¾¤æ­å»º</title>
    <link href="https://liei.cc/2018/k8s-cluster-deploy.html"/>
    <id>https://liei.cc/2018/k8s-cluster-deploy.html</id>
    <published>2018-09-01T14:15:15.000Z</published>
    <updated>2018-09-01T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>å…¶å®ï¼Œæ­å»ºä¸€ä¸ª Kubernetesï¼ˆK8Sï¼‰é›†ç¾¤ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œä¸»è¦å›°éš¾æœ‰ä¸¤ä¸ªï¼š</p><ul><li>é‚£ä¸€é“åšåšçš„å¢™</li><li>å¯¹ K8S çš„çŸ¥è¯†ä¸ç†Ÿæ‚‰</li></ul><p>åªè¦èƒ½è§£å†³ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œæ­å»ºçš„è¿‡ç¨‹å®é™…ä¸Šå°±æ²¡æœ‰é‚£ä¹ˆå¤æ‚äº†ã€‚</p><p>æœ¬ç³»åˆ—æ˜¯æˆ‘åœ¨æ­å»ºè¿‡ç¨‹ä¸­è¸©çš„æ— æ•°å‘ ã€ä»¥åŠæŸ¥é˜…ä¼—å¤šç›¸å…³é—®é¢˜è§£å†³çš„æ–‡ç« çš„ä¸€äº›è®°å½•å’Œæ€»ç»“ã€‚</p></blockquote><h2 id="é›†ç¾¤è§„åˆ’"><a href="#é›†ç¾¤è§„åˆ’" class="headerlink" title="é›†ç¾¤è§„åˆ’"></a>é›†ç¾¤è§„åˆ’</h2><h3 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h3><ul><li>èŠ‚ç‚¹ç½‘ç»œï¼š 192.168.31.0&#x2F;24</li><li>service ç½‘ç»œï¼š 10.96.0.0&#x2F;12</li><li>pod ç½‘ç»œï¼š 10.244.0.0&#x2F;16</li></ul><h3 id="kubeadm-éƒ¨ç½²"><a href="#kubeadm-éƒ¨ç½²" class="headerlink" title="kubeadm éƒ¨ç½²"></a>kubeadm éƒ¨ç½²</h3><h4 id="åŸºæœ¬æƒ…å†µ"><a href="#åŸºæœ¬æƒ…å†µ" class="headerlink" title="åŸºæœ¬æƒ…å†µ"></a>åŸºæœ¬æƒ…å†µ</h4><ul><li>kubeadm é¡¹ç›®<a href="https://github.com/kubernetes/kubeadm">é“¾æ¥åœ°å€</a></li><li>masterã€nodeï¼š å®‰è£… <code>kubelet</code>ã€ <code>kubeadm</code>ã€ <code>docker</code></li><li>masterï¼š <code>kubeadm init</code></li><li>nodeï¼š <code>kubeadm join</code></li><li><code>apiserver</code>ã€<code>scheduler</code>ã€<code>Controller-manager</code>ã€<code>etcd</code> åœ¨ master ä¸Šä»¥ Pod è¿è¡Œ</li><li><code>kubeproxy</code> ä»¥ Pod æ–¹å¼è¿è¡Œåœ¨æ¯ä¸€ä¸ª node èŠ‚ç‚¹ä¸Šã€‚</li><li>ä»¥ä¸Š pod å‡ä¸ºé™æ€ Pod</li><li>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦è¿è¡Œ <code>flannel</code>ï¼ˆä¹Ÿæ˜¯ä»¥ Pod æ–¹å¼è¿è¡Œï¼‰ï¼Œä»¥æä¾› Pod ç½‘ç»œ</li><li>kubeadm çš„<a href="https://github.com/kubernetes/kubeadm/blob/master/docs/design/design_v1.10.md">ä»‹ç»</a></li></ul><h4 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h4><ol><li>masterï¼Œnode éœ€è¦å®‰è£… kubeletï¼Œ kubeadmï¼Œ docker</li><li>master èŠ‚ç‚¹ä¸Šè¿è¡Œ <code>kubeadm init</code></li><li>node èŠ‚ç‚¹ä¸Šè¿è¡Œ <code>kubeadm join</code> åŠ å…¥é›†ç¾¤</li></ol><h2 id="å‡†å¤‡ç¯å¢ƒ"><a href="#å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡ç¯å¢ƒ"></a>å‡†å¤‡ç¯å¢ƒ</h2><h3 id="æˆ‘çš„ç¯å¢ƒ"><a href="#æˆ‘çš„ç¯å¢ƒ" class="headerlink" title="æˆ‘çš„ç¯å¢ƒ"></a>æˆ‘çš„ç¯å¢ƒ</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master yum.repos.d]<span class="comment"># cat /etc/redhat-release </span></span><br><span class="line">CentOS Linux release 7.4.1708 (Core) </span><br><span class="line">[root@master yum.repos.d]<span class="comment"># uname -a</span></span><br><span class="line">Linux master 3.10.0-693.el7.x86_64 <span class="comment">#1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure><h3 id="èŠ‚ç‚¹è§£æ"><a href="#èŠ‚ç‚¹è§£æ" class="headerlink" title="èŠ‚ç‚¹è§£æ"></a>èŠ‚ç‚¹è§£æ</h3><p>é€šè¿‡ <code>/etc/hosts</code> æ–‡ä»¶è§£æ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">192.168.31.81 master.test.com master</span><br><span class="line">192.168.31.82 node01.test.com node01</span><br><span class="line">192.168.31.83 node02.test.com node02</span><br></pre></td></tr></table></figure><p><strong>é›†ç¾¤é€šè¿‡æ—¶é—´æœåŠ¡å™¨åšæ—¶é’ŸåŒæ­¥</strong>ï¼Œæˆ‘æ²¡åš</p><h3 id="èŠ‚ç‚¹äº’ä¿¡"><a href="#èŠ‚ç‚¹äº’ä¿¡" class="headerlink" title="èŠ‚ç‚¹äº’ä¿¡"></a>èŠ‚ç‚¹äº’ä¿¡</h3><p>å¯ä»¥æŒ‰ç…§æ­¤<a href="https://www.cnblogs.com/jyzhao/p/3781072.html">æ–‡æ¡£</a>é…ç½®èŠ‚ç‚¹äº’ä¿¡ï¼Œä¹Ÿæ²¡æœ‰åš</p><h3 id="é€‰æ‹©ç‰ˆæœ¬"><a href="#é€‰æ‹©ç‰ˆæœ¬" class="headerlink" title="é€‰æ‹©ç‰ˆæœ¬"></a>é€‰æ‹©ç‰ˆæœ¬</h3><p>ä½¿ç”¨ kubernetes v1.11.2</p><h2 id="å¼€å§‹éƒ¨ç½²"><a href="#å¼€å§‹éƒ¨ç½²" class="headerlink" title="å¼€å§‹éƒ¨ç½²"></a>å¼€å§‹éƒ¨ç½²</h2><p><strong>ç¡®ä¿ iptables firewalld ç­‰æœªå¯åŠ¨, ä¸”ä¸å¼€æœºè‡ªå¯åŠ¨</strong>ï¼Œå¯å‚è€ƒæˆ‘ä¹‹å‰çš„ CentOS å®‰è£…</p><h3 id="é…ç½®-yum-ä»“åº“"><a href="#é…ç½®-yum-ä»“åº“" class="headerlink" title="é…ç½® yum ä»“åº“"></a>é…ç½® yum ä»“åº“</h3><p>ä½¿ç”¨ aliyun æºï¼Œ<a href="https://opsx.alibaba.com/mirror">é“¾æ¥</a></p><h4 id="docker-æºä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–"><a href="#docker-æºä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–" class="headerlink" title="docker æºä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–"></a>docker æºä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line">wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><h4 id="kubernetes-æº"><a href="#kubernetes-æº" class="headerlink" title="kubernetes æº"></a>kubernetes æº</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master yum.repos.d]<span class="comment"># cat kubernetes.repo </span></span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes Repo</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æºæ˜¯å¦ç”Ÿæ•ˆ"><a href="#æŸ¥çœ‹æºæ˜¯å¦ç”Ÿæ•ˆ" class="headerlink" title="æŸ¥çœ‹æºæ˜¯å¦ç”Ÿæ•ˆ"></a>æŸ¥çœ‹æºæ˜¯å¦ç”Ÿæ•ˆ</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># yum clean all</span><br><span class="line"># yum repolist</span><br><span class="line">*****</span><br><span class="line">*****</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">kubernetes                                                         243/243</span><br><span class="line">repo id                         repo name                            status</span><br><span class="line">base/7/x86_64                   CentOS-7 - Base - 163.com            9,911</span><br><span class="line">docker-ce-stable/x86_64         Docker CE Stable - x86_64               16</span><br><span class="line">extras/7/x86_64                 CentOS-7 - Extras - 163.com            370</span><br><span class="line">kubernetes                      Kubernetes Repo                        243</span><br><span class="line">updates/7/x86_64                CentOS-7 - Updates - 163.com         1,054</span><br><span class="line">repolist: 11,594</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h3><p><strong>ä¸‰å°æœºå™¨éƒ½éœ€è¦å®‰è£…</strong></p><p>ä½¿ç”¨ <code>yum install docker-ce kubelet kubeadm kubectl</code> å®‰è£…</p><p>å®‰è£…çš„è½¯ä»¶åŒ…å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Installing : kubectl-1.11.2-0.x86_64                                 1/7 </span><br><span class="line">Installing : cri-tools-1.11.0-0.x86_64                               2/7 </span><br><span class="line">Installing : socat-1.7.3.2-2.el7.x86_64                              3/7 </span><br><span class="line">Installing : kubernetes-cni-0.6.0-0.x86_64                           4/7 </span><br><span class="line">Installing : kubelet-1.11.2-0.x86_64                                 5/7 </span><br><span class="line">Installing : kubeadm-1.11.2-0.x86_64                                 6/7 </span><br><span class="line">Installing : docker-ce-18.06.0.ce-3.el7.x86_64                       7/7 </span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-docker-æœåŠ¡ç­‰"><a href="#å¯åŠ¨-docker-æœåŠ¡ç­‰" class="headerlink" title="å¯åŠ¨ docker æœåŠ¡ç­‰"></a>å¯åŠ¨ docker æœåŠ¡ç­‰</h3><p>ç”±äºå›½å†…ç½‘ç»œåŸå› ï¼Œkubernetes çš„é•œåƒæ‰˜ç®¡åœ¨ google äº‘ä¸Šï¼Œæ— æ³•ç›´æ¥ä¸‹è½½ï¼Œéœ€è¦è®¾ç½® proxy<br>åœ¨ <code>/usr/lib/systemd/system/docker.service</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# cat /usr/lib/systemd/system/docker.service |grep PROXY</span><br><span class="line">Environment=&quot;HTTPS_PROXY=http://www.ik8s.io:10080&quot;</span><br><span class="line">Environment=&quot;NO_PROXY=127.0.0.0/8,192.168.31.0/24&quot;</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œå¯åŠ¨ docker</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure><p>ç¡®è®¤ proc çš„è¿™ä¸¤ä¸ªå‚æ•°å¦‚ä¸‹ï¼Œå‡ä¸º 1</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# cat /proc/sys/net/bridge/bridge-nf-call-iptables </span><br><span class="line">1</span><br><span class="line">[root@master ~]# cat /proc/sys/net/bridge/bridge-nf-call-ip6tables </span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">è§£å†³æ–¹æ³•ï¼šä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶æ˜¯çš„æœºå™¨ bridge æ¨¡å¼å¼€å¯</span><br><span class="line"></span><br><span class="line">è®¾ç½®æœºå™¨å¼€æœºå¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤</span><br><span class="line"></span><br><span class="line">ç¼–è¾‘ vim  /etc/rc.d/rc.local æ·»åŠ ä¸‹é¢ä¸¤æ¡å‘½ä»¤</span><br><span class="line"></span><br><span class="line">        echo 1 &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line"></span><br><span class="line">        echo 1 &gt; /proc/sys/net/bridge/bridge-nf-call-ip6tables</span><br><span class="line"></span><br><span class="line">centos7 éœ€è¦å¢åŠ æ‰§è¡Œæƒé™ï¼š</span><br><span class="line"></span><br><span class="line">        chmod +xã€€/etc/rc,d/rc.local</span><br><span class="line"></span><br><span class="line">é‡å¯ç³»ç»Ÿ</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-kubelet"><a href="#è®¾ç½®-kubelet" class="headerlink" title="è®¾ç½® kubelet"></a>è®¾ç½® kubelet</h3><p>æŸ¥çœ‹ kubelet å®‰è£…ç”Ÿæˆäº†å“ªäº›æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# rpm -ql kubelet</span><br><span class="line">/etc/kubernetes/manifests              # æ¸…å•ç›®å½•</span><br><span class="line">/etc/sysconfig/kubelet                 # é…ç½®æ–‡ä»¶</span><br><span class="line">/etc/systemd/system/kubelet.service    # unit file</span><br><span class="line">/usr/bin/kubelet                       # ä¸»ç¨‹åº</span><br></pre></td></tr></table></figure><p><strong>é»˜è®¤</strong>çš„é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# cat /etc/sysconfig/kubelet</span><br><span class="line">KUBELET_EXTRA_ARGS=</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ kubelet çš„é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# cat /etc/sysconfig/kubelet</span><br><span class="line">KUBELET_EXTRA_ARGS=&quot;--fail-swap-on=false&quot;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¿˜æ— æ³•æ­£å¸¸å¯åŠ¨ kubeletï¼Œå…ˆè®¾ç½® kubelet å¼€æœºè‡ªå¯åŠ¨ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š <code>systemctl enable kubelet</code> ã€‚</p><h3 id="kubeadm-init"><a href="#kubeadm-init" class="headerlink" title="kubeadm init"></a>kubeadm init</h3><p>åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=v1.11.2 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 --ignore-preflight-errors=Swap</span><br></pre></td></tr></table></figure><p>kubeadm init çš„è¾“å‡ºå¯è§äºæ­¤<a href="https://segmentfault.com/n/1330000016057102">é“¾æ¥</a></p><p>æ­¤å‘½ä»¤ï¼Œä¸‹è½½äº†å¦‚ä¸‹ image</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# docker images</span><br><span class="line">REPOSITORY                                 TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">k8s.gcr.io/kube-proxy-amd64                v1.11.2             46a3cd725628        7 days ago          97.8MB</span><br><span class="line">k8s.gcr.io/kube-apiserver-amd64            v1.11.2             821507941e9c        7 days ago          187MB</span><br><span class="line">k8s.gcr.io/kube-controller-manager-amd64   v1.11.2             38521457c799        7 days ago          155MB</span><br><span class="line">k8s.gcr.io/kube-scheduler-amd64            v1.11.2             37a1403e6c1a        7 days ago          56.8MB</span><br><span class="line">k8s.gcr.io/coredns                         1.1.3               b3b94275d97c        2 months ago        45.6MB</span><br><span class="line">k8s.gcr.io/etcd-amd64                      3.2.18              b8df3b177be2        4 months ago        219MB</span><br><span class="line">k8s.gcr.io/pause                           3.1                 da86e6ba6ca1        7 months ago        742kB</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæ­£åœ¨è¿è¡Œçš„ docker å¦‚ä¸‹</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">1c03e043e6b7        46a3cd725628           <span class="string">&quot;/usr/local/bin/kube??   3 minutes ago       Up 3 minutes                            k8s_kube-proxy_kube-proxy-6fgjm_kube-system_f85e8660-a090-11e8-8ee7-000c29f71e04_0</span></span><br><span class="line"><span class="string">5f166bd11566        k8s.gcr.io/pause:3.1   &quot;</span>/pause<span class="string">&quot;                 3 minutes ago       Up 3 minutes                            k8s_POD_kube-proxy-6fgjm_kube-system_f85e8660-a090-11e8-8ee7-000c29f71e04_0</span></span><br><span class="line"><span class="string">0f306f98cc52        b8df3b177be2           &quot;</span>etcd --advertise-cl??   3 minutes ago       Up 3 minutes                            k8s_etcd_etcd-master_kube-system_2cc1c8a24b68ab9b46bca47e153e74c6_0</span><br><span class="line">8f01317b9e20        37a1403e6c1a           <span class="string">&quot;kube-scheduler --ad??   3 minutes ago       Up 3 minutes                            k8s_kube-scheduler_kube-scheduler-master_kube-system_a00c35e56ebd0bdfcd77d53674a5d2a1_0</span></span><br><span class="line"><span class="string">4e6a71ab20d3        821507941e9c           &quot;</span>kube-apiserver --au??   3 minutes ago       Up 3 minutes                            k8s_kube-apiserver_kube-apiserver-master_kube-system_d25d40ebb427821464356bb27a38f487_0</span><br><span class="line">69e4c5dae335        38521457c799           <span class="string">&quot;kube-controller-man??   3 minutes ago       Up 3 minutes                            k8s_kube-controller-manager_kube-controller-manager-master_kube-system_6363f7ebf727b0b95d9a9ef72516a0e5_0</span></span><br><span class="line"><span class="string">da5981dc546a        k8s.gcr.io/pause:3.1   &quot;</span>/pause<span class="string">&quot;                 3 minutes ago       Up 3 minutes                            k8s_POD_kube-controller-manager-master_kube-system_6363f7ebf727b0b95d9a9ef72516a0e5_0</span></span><br><span class="line"><span class="string">b7a8fdc35029        k8s.gcr.io/pause:3.1   &quot;</span>/pause<span class="string">&quot;                 3 minutes ago       Up 3 minutes                            k8s_POD_kube-apiserver-master_kube-system_d25d40ebb427821464356bb27a38f487_0</span></span><br><span class="line"><span class="string">b09efc7ff7bd        k8s.gcr.io/pause:3.1   &quot;</span>/pause<span class="string">&quot;                 3 minutes ago       Up 3 minutes                            k8s_POD_kube-scheduler-master_kube-system_a00c35e56ebd0bdfcd77d53674a5d2a1_0</span></span><br><span class="line"><span class="string">ab11d6ffadab        k8s.gcr.io/pause:3.1   &quot;</span>/pause<span class="string">&quot;                 3 minutes ago       Up 3 minutes                            k8s_POD_etcd-master_kube-system_2cc1c8a24b68ab9b46bca47e153e74c6_0</span></span><br></pre></td></tr></table></figure><p>node èŠ‚ç‚¹å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åŠ å…¥é›†ç¾¤ <code>kubeadm join 192.168.31.81:6443 --token n84v6t.c7d83cn4mo2z8wyr --discovery-token-ca-cert-hash sha256:b946c145416fe1995e1d4d002c149e71a897acc7b106d94cee2920cb2c85ce29</code> </p><p>åœ¨ kubeadm init çš„<a href="https://segmentfault.com/a/1190000016026998">è¾“å‡º</a>ä¸­ï¼Œæç¤ºæˆ‘ä»¬éœ€è¦ä»¥æ™®é€šç”¨æˆ·åšå¦‚ä¸‹æ“ä½œï¼Œæˆ‘æ­¤æ—¶ç”¨ root æ‰§è¡Œ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># mkdir -p $HOME/.kube</span></span><br><span class="line">[root@master ~]<span class="comment"># cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯ä»¥é€šè¿‡ <code>kubelet get</code> è·å–å„ç§èµ„æºä¿¡æ¯ã€‚æ¯”å¦‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubectl get cs</span></span><br><span class="line">NAME                 STATUS    MESSAGE              ERROR</span><br><span class="line">scheduler            Healthy   ok                   </span><br><span class="line">controller-manager   Healthy   ok                   </span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">&quot;health&quot;</span>: <span class="string">&quot;true&quot;</span>&#125; </span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„ç›‘å¬çŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># ss -tnl</span></span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN      0      128    127.0.0.1:2379                  *:*                  </span><br><span class="line">LISTEN      0      128    127.0.0.1:10251                 *:*                  </span><br><span class="line">LISTEN      0      128    127.0.0.1:2380                  *:*                  </span><br><span class="line">LISTEN      0      128    127.0.0.1:10252                 *:*                  </span><br><span class="line">LISTEN      0      128       *:22                    *:*                  </span><br><span class="line">LISTEN      0      128    127.0.0.1:33881                 *:*                  </span><br><span class="line">LISTEN      0      100    127.0.0.1:25                    *:*                  </span><br><span class="line">LISTEN      0      128    192.168.18.128:10010                 *:*                  </span><br><span class="line">LISTEN      0      128    127.0.0.1:10248                 *:*                  </span><br><span class="line">LISTEN      0      128    127.0.0.1:10249                 *:*                  </span><br><span class="line">LISTEN      0      128      :::6443                 :::*                  </span><br><span class="line">LISTEN      0      128      :::10256                :::*                  </span><br><span class="line">LISTEN      0      128      :::22                   :::*                  </span><br><span class="line">LISTEN      0      100     ::1:25                   :::*                  </span><br><span class="line">LISTEN      0      128      :::10250                :::*         </span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„èŠ‚ç‚¹çŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME      STATUS     ROLES     AGE       VERSION</span><br><span class="line">master    NotReady   master    9m        v1.11.2</span><br></pre></td></tr></table></figure><p>çŠ¶æ€ä¸º <code>NotReady</code> ï¼Œ éœ€è¦éƒ¨ç½² flannelï¼Œ<a href="https://github.com/coreos/flannel">é“¾æ¥</a></p><h3 id="éƒ¨ç½²-flannel"><a href="#éƒ¨ç½²-flannel" class="headerlink" title="éƒ¨ç½² flannel"></a>éƒ¨ç½² flannel</h3><p>åœ¨æ–‡æ¡£ä¸­ï¼Œæ‰¾åˆ°å¦‚ä¸‹å‘½ä»¤ï¼Œéƒ¨ç½²</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span></span><br><span class="line">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class="line">serviceaccount/flannel created</span><br><span class="line">configmap/kube-flannel-cfg created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-amd64 created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-arm64 created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-arm created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-ppc64le created</span><br><span class="line">daemonset.extensions/kube-flannel-ds-s390x created</span><br></pre></td></tr></table></figure><p>æŒ‰å¦‚ä¸‹æ–¹æ³•æŸ¥çœ‹ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubectl get pods -n  kube-system</span></span><br><span class="line">NAME                             READY     STATUS    RESTARTS   AGE</span><br><span class="line">coredns-78fcdf6894-cv4gp         1/1       Running   0          13m</span><br><span class="line">coredns-78fcdf6894-wmd25         1/1       Running   0          13m</span><br><span class="line">etcd-master                      1/1       Running   0          49s</span><br><span class="line">kube-apiserver-master            1/1       Running   0          49s</span><br><span class="line">kube-controller-manager-master   1/1       Running   0          48s</span><br><span class="line">kube-flannel-ds-amd64-r42wr      1/1       Running   0          2m</span><br><span class="line">kube-proxy-6fgjm                 1/1       Running   0          13m</span><br><span class="line">kube-scheduler-master            1/1       Running   0          48s</span><br><span class="line">[root@master ~]<span class="comment"># docker images |grep flannel</span></span><br><span class="line">quay.io/coreos/flannel                     v0.10.0-amd64       f0fad859c909        6 months ago        44.6MB</span><br><span class="line">[root@master ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME      STATUS    ROLES     AGE       VERSION</span><br><span class="line">master    Ready     master    14m       v1.11.2</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ master èŠ‚ç‚¹çŠ¶æ€å˜ä¸º <code>Ready</code> ã€‚</p><h3 id="åœ¨-node-èŠ‚ç‚¹ä¸Šæ‰§è¡Œ-kubeadm-join-å‘½ä»¤"><a href="#åœ¨-node-èŠ‚ç‚¹ä¸Šæ‰§è¡Œ-kubeadm-join-å‘½ä»¤" class="headerlink" title="åœ¨ node èŠ‚ç‚¹ä¸Šæ‰§è¡Œ kubeadm join å‘½ä»¤"></a>åœ¨ node èŠ‚ç‚¹ä¸Šæ‰§è¡Œ <code>kubeadm join</code> å‘½ä»¤</h3><p>ä½¿ç”¨ master èŠ‚ç‚¹æ‰§è¡Œ <code>kubeadm init</code> å‘½ä»¤çš„è¾“å‡ºï¼Œåœ¨ node ä¸Šæ‰§è¡Œï¼Œä½¿å…¶åŠ å…¥é›†ç¾¤ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@node01 ~]<span class="comment">#   kubeadm join 192.168.18.128:6443 --token n84v6t.c7d83cn4mo2z8wyr --discovery-token-ca-cert-hash sha256:b946c145416fe1995e1d4d002c149e71a897acc7b106d94cee2920cb2c85ce29 --ignore-preflight-errors=Swap</span></span><br><span class="line"></span><br><span class="line">[preflight] running pre-flight checks</span><br><span class="line">    [WARNING RequiredIPVSKernelModulesAvailable]: the IPVS proxier will not be used, because the following required kernel modules are not loaded: [ip_vs ip_vs_rr ip_vs_wrr ip_vs_sh] or no <span class="built_in">builtin</span> kernel ipvs support: map[ip_vs_sh:&#123;&#125; nf_conntrack_ipv4:&#123;&#125; ip_vs:&#123;&#125; ip_vs_rr:&#123;&#125; ip_vs_wrr:&#123;&#125;]</span><br><span class="line">you can solve this problem with following methods:</span><br><span class="line"> 1. Run <span class="string">&#x27;modprobe -- &#x27;</span> to load missing kernel modules;</span><br><span class="line">2. Provide the missing <span class="built_in">builtin</span> kernel ipvs support</span><br><span class="line"></span><br><span class="line">    [WARNING Swap]: running with swap on is not supported. Please <span class="built_in">disable</span> swap</span><br><span class="line">I0815 22:02:30.751069   15460 kernel_validator.go:81] Validating kernel version</span><br><span class="line">I0815 22:02:30.751145   15460 kernel_validator.go:96] Validating kernel config</span><br><span class="line">    [WARNING SystemVerification]: docker version is greater than the most recently validated version. Docker version: 18.06.0-ce. Max validated version: 17.03</span><br><span class="line">[discovery] Trying to connect to API Server <span class="string">&quot;192.168.18.128:6443&quot;</span></span><br><span class="line">[discovery] Created cluster-info discovery client, requesting info from <span class="string">&quot;https://192.168.18.128:6443&quot;</span></span><br><span class="line">[discovery] Requesting info from <span class="string">&quot;https://192.168.18.128:6443&quot;</span> again to validate TLS against the pinned public key</span><br><span class="line">[discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server <span class="string">&quot;192.168.18.128:6443&quot;</span></span><br><span class="line">[discovery] Successfully established connection with API Server <span class="string">&quot;192.168.18.128:6443&quot;</span></span><br><span class="line">[kubelet] Downloading configuration <span class="keyword">for</span> the kubelet from the <span class="string">&quot;kubelet-config-1.11&quot;</span> ConfigMap <span class="keyword">in</span> the kube-system namespace</span><br><span class="line">[kubelet] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[preflight] Activating the kubelet service</span><br><span class="line">[tlsbootstrap] Waiting <span class="keyword">for</span> the kubelet to perform the TLS Bootstrap...</span><br><span class="line">[patchnode] Uploading the CRI Socket information <span class="string">&quot;/var/run/dockershim.sock&quot;</span> to the Node API object <span class="string">&quot;node01&quot;</span> as an annotation</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to master and a response</span><br><span class="line">  was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run <span class="string">&#x27;kubectl get nodes&#x27;</span> on the master to see this node <span class="built_in">join</span> the cluster.</span><br></pre></td></tr></table></figure><p>åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰§è¡Œå®Œæ¯•ä¸Šè¿°å‘½ä»¤åï¼Œåœ¨ master ä¸ŠæŸ¥çœ‹</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME      STATUS    ROLES     AGE       VERSION</span><br><span class="line">master    Ready     master    23m       v1.11.2</span><br><span class="line">node01    Ready     &lt;none&gt;    2m        v1.11.2</span><br><span class="line">node02    Ready     &lt;none&gt;    1m        v1.11.2</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²æˆåŠŸã€‚</p><h2 id="éƒ¨ç½²å®Œæˆåçš„è§‚å¯Ÿ"><a href="#éƒ¨ç½²å®Œæˆåçš„è§‚å¯Ÿ" class="headerlink" title="éƒ¨ç½²å®Œæˆåçš„è§‚å¯Ÿ"></a>éƒ¨ç½²å®Œæˆåçš„è§‚å¯Ÿ</h2><p><strong>æ£€æŸ¥ç°åœ¨æ­£åœ¨è¿è¡Œçš„ pod</strong></p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubectl get pods -n kube-system -o wide</span></span><br><span class="line">NAME                             READY     STATUS    RESTARTS   AGE       IP               NODE      NOMINATED NODE</span><br><span class="line">coredns-78fcdf6894-cv4gp         1/1       Running   0          28m       10.244.0.3       master    &lt;none&gt;</span><br><span class="line">coredns-78fcdf6894-wmd25         1/1       Running   0          28m       10.244.0.2       master    &lt;none&gt;</span><br><span class="line">etcd-master                      1/1       Running   0          15m       192.168.18.128   master    &lt;none&gt;</span><br><span class="line">kube-apiserver-master            1/1       Running   0          15m       192.168.18.128   master    &lt;none&gt;</span><br><span class="line">kube-controller-manager-master   1/1       Running   0          15m       192.168.18.128   master    &lt;none&gt;</span><br><span class="line">kube-flannel-ds-amd64-48rvq      1/1       Running   3          6m        192.168.18.130   node02    &lt;none&gt;</span><br><span class="line">kube-flannel-ds-amd64-7dw42      1/1       Running   3          7m        192.168.18.129   node01    &lt;none&gt;</span><br><span class="line">kube-flannel-ds-amd64-r42wr      1/1       Running   0          16m       192.168.18.128   master    &lt;none&gt;</span><br><span class="line">kube-proxy-6fgjm                 1/1       Running   0          28m       192.168.18.128   master    &lt;none&gt;</span><br><span class="line">kube-proxy-6mngv                 1/1       Running   0          7m        192.168.18.129   node01    &lt;none&gt;</span><br><span class="line">kube-proxy-9sh2n                 1/1       Running   0          6m        192.168.18.130   node02    &lt;none&gt;</span><br><span class="line">kube-scheduler-master            1/1       Running   0          15m       192.168.18.128   master    &lt;none&gt;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼š</p><ol><li>kube-apiserverï¼Œ kube-schedulerï¼Œ kube-controllerï¼Œetcd-master è¿è¡Œåœ¨ master ä¸Šï¼Œ</li><li>kube-flannel åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå‡æœ‰è¿è¡Œ</li><li>kube-proxy åœ¨ä¸‰ä¸ªèŠ‚ç‚¹å‡æœ‰è¿è¡Œ</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;å…¶å®ï¼Œæ­å»ºä¸€ä¸ª Kubernetesï¼ˆK8Sï¼‰é›†ç¾¤ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œä¸»è¦å›°éš¾æœ‰ä¸¤ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;</summary>
      
    
    
    
    <category term="æŠ˜è…¾ä¸æ­¢" scheme="https://liei.cc/blog/categories/%E6%8A%98%E8%85%BE%E4%B8%8D%E6%AD%A2/"/>
    
    
    <category term="Cloud Navite" scheme="https://liei.cc/blog/tags/cloud-navite/"/>
    
    <category term="Kubernetes" scheme="https://liei.cc/blog/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å¯äº‘åŸç”Ÿä¹‹é—¨</title>
    <link href="https://liei.cc/2018/open-cloud-native-study.html"/>
    <id>https://liei.cc/2018/open-cloud-native-study.html</id>
    <published>2018-08-25T14:15:15.000Z</published>
    <updated>2018-08-25T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ"><a href="#ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ"></a>ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ</h2><h3 id="CNCFç»„ç»‡"><a href="#CNCFç»„ç»‡" class="headerlink" title="CNCFç»„ç»‡"></a>CNCFç»„ç»‡</h3><p>åœ¨è®²äº‘åŸç”Ÿä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ CNCF ï¼Œå³äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼Œ2015å¹´ç”±è°·æ­Œç‰µå¤´æˆç«‹ï¼ŒåŸºé‡‘ä¼šæˆå‘˜ç›®å‰å·²æœ‰ä¸€ç™¾å¤šä¼ä¸šä¸æœºæ„ï¼ŒåŒ…æ‹¬äºšé©¬é€Šã€å¾®è½¯ã€‚æ€ç§‘ç­‰å·¨å¤´ã€‚ç›®å‰ CNCF æ‰€æ‰˜ç®¡çš„åº”ç”¨å·²è¾¾14ä¸ªï¼Œä¸‹å›¾ä¸ºå…¶å…¬å¸ƒçš„Cloud Native Landscapeï¼Œç»™å‡ºäº†äº‘åŸç”Ÿç”Ÿæ€çš„å‚è€ƒä½“ç³»ï¼š</p><img src = "https://leeifme-1252179361.cos.ap-shanghai.myqcloud.com/blog/CNCF.png"><h3 id="äº‘åŸç”Ÿ-Cloud-Native"><a href="#äº‘åŸç”Ÿ-Cloud-Native" class="headerlink" title="äº‘åŸç”Ÿ(Cloud Native)"></a>äº‘åŸç”Ÿ(Cloud Native)</h3><p>CNCF ç»™å‡ºäº†äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰å¤§ç‰¹å¾ï¼š</p><ul><li>å®¹å™¨åŒ–å°è£…ï¼šä»¥å®¹å™¨ä¸ºåŸºç¡€ï¼Œæé«˜æ•´ä½“å¼€å‘æ°´å¹³ï¼Œå½¢æˆä»£ç å’Œç»„ä»¶é‡ç”¨ï¼Œç®€åŒ–äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„ç»´æŠ¤ã€‚åœ¨å®¹å™¨ä¸­è¿è¡Œåº”ç”¨ç¨‹åºå’Œè¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåº”ç”¨ç¨‹åºéƒ¨ç½²çš„ç‹¬ç«‹å•å…ƒï¼Œå®ç°é«˜æ°´å¹³èµ„æºéš”ç¦»ã€‚</li><li>åŠ¨æ€ç®¡ç†ï¼šé€šè¿‡é›†ä¸­å¼çš„ç¼–æ’è°ƒåº¦ç³»ç»Ÿæ¥åŠ¨æ€çš„ç®¡ç†å’Œè°ƒåº¦ã€‚</li><li>é¢å‘å¾®æœåŠ¡ï¼šæ˜ç¡®æœåŠ¡é—´çš„ä¾èµ–ï¼Œäº’ç›¸è§£è€¦ã€‚</li></ul><p>äº‘åŸç”ŸåŒ…å«äº†ä¸€ç»„åº”ç”¨çš„æ¨¡å¼ï¼Œç”¨äºå¸®åŠ©ä¼ä¸šå¿«é€Ÿï¼ŒæŒç»­ï¼Œå¯é ï¼Œè§„æ¨¡åŒ–åœ°äº¤ä»˜ä¸šåŠ¡è½¯ä»¶ã€‚äº‘åŸç”Ÿç”±å¾®æœåŠ¡æ¶æ„ï¼ŒDevOps å’Œä»¥å®¹å™¨ä¸ºä»£è¡¨çš„æ•æ·åŸºç¡€æ¶æ„ç»„æˆã€‚è¿™è¾¹å¼•ç”¨ç½‘ä¸Šå…³äºäº‘åŸç”Ÿæ‰€éœ€è¦çš„èƒ½åŠ›å’Œç‰¹å¾æ€»ç»“ï¼š</p><img src = "https://leeifme-1252179361.cos.ap-shanghai.myqcloud.com/blog/yunyuansheng.jpg"><h3 id="åº”ç”¨éƒ¨ç½²è¿è¡Œæ¨¡å¼çš„å˜è¿"><a href="#åº”ç”¨éƒ¨ç½²è¿è¡Œæ¨¡å¼çš„å˜è¿" class="headerlink" title="åº”ç”¨éƒ¨ç½²è¿è¡Œæ¨¡å¼çš„å˜è¿"></a>åº”ç”¨éƒ¨ç½²è¿è¡Œæ¨¡å¼çš„å˜è¿</h3><blockquote><p>å­¦ä¹ ä¸€ä¸ªæ–°äº‹ç‰©ä¹‹å‰å‘¢ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆäº†è§£è¯¥äº‹ç‰©å‘å±•çš„å†ç¨‹å’Œè§„å¾‹ï¼Œ<code>Kubernetes</code> çš„å‡ºç°å°±æ˜¯åº”ç”¨éƒ¨ç½²è¿è¡Œæ¨¡å¼åœ¨å¤–éƒ¨æ¡ä»¶éœ€æ±‚å˜æ›´çš„æƒ…å†µä¸‹ï¼Œæ¼”åŒ–å‡ºæ¥çš„ç»“æœ</p></blockquote><p><strong>ç‰©ç†æœºæ¨¡å¼</strong>(ç‰©ç†æœº-æ“ä½œç³»ç»Ÿ-åº”ç”¨)</p><p><strong>è™šæ‹ŸåŒ–æ¨¡å¼</strong>(è™šæ‹Ÿæœº-åº”ç”¨)</p><p><strong>å®¹å™¨åŒ–æ¨¡å¼</strong></p><ul><li>ä»¥ Dockerä¸ºä»£è¡¨çš„å†…æ ¸å®¹å™¨æŠ€æœ¯ä¸æ˜¯æ–°æŠ€æœ¯,è€Œæ˜¯å°†å·²æœ‰æŠ€æœ¯(LXCã€ groupsã€ Union fs)è¿›è¡Œäº†æ›´å¥½çš„æ•´åˆå’ŒåŒ…è£…,å¹¶å½¢æˆäº†<br>ä¸€ç§æ ‡å‡†é•œåƒæ ¼å¼</li><li>ä¸VMç›¸æ¯”,å®¹å™¨å…·æœ‰å¼€å‘äº¤ä»˜æµç¨‹æ“ä½œå¯¹è±¡åŒæ­¥ã€æ‰§è¡Œæ›´ä¸ºé«˜æ•ˆèµ„æºå ç”¨æ›´ä¸ºé›†çº¦ç­‰ä¼˜åŠ¿ã€‚</li><li>è®¡ç®—åŸºæœ¬å•å…ƒç”±è™šæ‹Ÿæœºå˜ä¸ºäº†å®¹å™¨,è¶Šæ¥è¶Šå¤šåº”ç”¨çš„æ„å»ºã€éƒ¨ç½²ä¸è¿è¡Œé€‰æ‹©åœ¨å®¹å™¨ä¸­è¿›è¡Œã€‚</li></ul><p><strong>äº‘åŸç”Ÿæ¨¡å¼</strong></p><ul><li>éšç€å®¹å™¨æŠ€æœ¯çš„å²€ç°ä»¥åŠåº”ç”¨æ‰€é¢ä¸´çš„å¤–éƒ¨ç¯å¢ƒçš„å˜åŒ–,äº‘åŸç”Ÿé€æ¸æˆä¸ºä¸€ç§åº”ç”¨äº‘åŒ–å¼€å‘ã€éƒ¨ç½²å’Œè¿è¡Œçš„ä¸»æµæ–¹å¼</li><li>åŸºç¡€å‰æ:åº”ç”¨çš„å®¹å™¨åŒ–å’Œå¾®æœåŠ¡åŒ–ã€‚å®¹å™¨,ä½œä¸ºåº”ç”¨éƒ¨ç½²ã€è¿è¡Œå’Œç®¡ç†çš„åŸºæœ¬å•å…ƒ</li><li>æ ¸å¿ƒ:å€ŸåŠ©å®¹å™¨ç®¡ç†è‡ªåŠ¨åŒ–å¹³å°è¿›è¡ŒåŠ¨æ€ç¼–æ’å’Œèµ„æºä¼˜åŒ–åˆ©ç”¨</li></ul><h2 id="äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰å¤§ç‰¹å¾"><a href="#äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰å¤§ç‰¹å¾" class="headerlink" title="äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰å¤§ç‰¹å¾"></a>äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰å¤§ç‰¹å¾</h2><h3 id="å®¹å™¨åŒ–å°è£…"><a href="#å®¹å™¨åŒ–å°è£…" class="headerlink" title="å®¹å™¨åŒ–å°è£…"></a>å®¹å™¨åŒ–å°è£…</h3><p>æœ€è¿‘å‡ å¹´Dockerå®¹å™¨åŒ–æŠ€æœ¯å¾ˆç«ï¼Œç»å¸¸åœ¨å„ç§åœºåˆèƒ½å¤Ÿå¬åˆ°å…³äº <code>Docker</code> çš„åˆ†äº«ã€‚<code>Docker</code> è®©å¼€å‘å·¥ç¨‹å¸ˆå¯ä»¥å°†ä»–ä»¬çš„åº”ç”¨å’Œä¾èµ–å°è£…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ã€‚<code>Docker</code> èƒŒåçš„æƒ³æ³•æ˜¯åˆ›å»ºè½¯ä»¶ç¨‹åºå¯ç§»æ¤çš„è½»é‡å®¹å™¨ï¼Œè®©å…¶å¯ä»¥åœ¨ä»»ä½•å®‰è£…äº† <code>Docker</code> çš„æœºå™¨ä¸Šè¿è¡Œï¼Œè€Œä¸ç”¨å…³å¿ƒåº•å±‚æ“ä½œç³»ç»Ÿã€‚</p><p><code>Docker</code> å¯ä»¥è§£å†³è™šæ‹Ÿæœºèƒ½å¤Ÿè§£å†³çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿè§£å†³è™šæ‹Ÿæœºç”±äºèµ„æºè¦æ±‚è¿‡é«˜è€Œæ— æ³•è§£å†³çš„é—®é¢˜ã€‚å…¶ä¼˜åŠ¿åŒ…1æ‹¬ï¼š</p><ul><li>éš”ç¦»åº”ç”¨ä¾èµ–</li><li>åˆ›å»ºåº”ç”¨é•œåƒå¹¶è¿›è¡Œå¤åˆ¶</li><li>åˆ›å»ºå®¹æ˜“åˆ†å‘çš„å³å¯å³ç”¨çš„åº”ç”¨</li><li>å…è®¸å®ä¾‹ç®€å•ã€å¿«é€Ÿåœ°æ‰©å±•</li><li>æµ‹è¯•åº”ç”¨å¹¶éšåé”€æ¯å®ƒä»¬</li></ul><p>è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·å¯ä»¥é™ä½ç¯å¢ƒæ­å»ºçš„å¤æ‚åº¦ï¼Œä½†ä»ç„¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³ç¯å¢ƒçš„é—®é¢˜ã€‚åœ¨çœ‹ä¼¼ç¨³å®šè€Œæˆç†Ÿçš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ <code>Docker</code> çš„å¥½å¤„è¶Šæ¥è¶Šå¤šã€‚</p><h3 id="æœåŠ¡ç¼–æ’-åŠ¨æ€ç®¡ç†"><a href="#æœåŠ¡ç¼–æ’-åŠ¨æ€ç®¡ç†" class="headerlink" title="æœåŠ¡ç¼–æ’ åŠ¨æ€ç®¡ç†"></a>æœåŠ¡ç¼–æ’ åŠ¨æ€ç®¡ç†</h3><p><a href="https://jimmysong.io/posts/from-kubernetes-to-cloud-native/">Jimmy Song</a> å¯¹äº‘åŸç”Ÿæ¶æ„ä¸­è¿ç”¨æœåŠ¡ç¼–æ’çš„æ€»ç»“æ˜¯ï¼š</p><blockquote><p>Kubernetesâ€”â€”è®©å®¹å™¨åº”ç”¨è¿›å…¥å¤§è§„æ¨¡å·¥ä¸šç”Ÿäº§</p></blockquote><p>ç¼–æ’è°ƒåº¦çš„å¼€æºç»„ä»¶è¿˜æœ‰ï¼š<code>Kubernetes</code>ã€<code>Mesos</code> å’Œ <code>Docker Swarm</code>;</p><p>ä»–ä»¬ä¸ºäº‘åŸç”Ÿåº”ç”¨æä¾›çš„å¼ºæœ‰åŠ›çš„ç¼–æ’å’Œè°ƒåº¦èƒ½åŠ›ï¼Œå®ƒä»¬æ˜¯äº‘å¹³å°ä¸Šçš„åˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿã€‚åœ¨å•æœºä¸Šè¿è¡Œå®¹å™¨ï¼Œæ— æ³•å‘æŒ¥å®ƒçš„æœ€å¤§æ•ˆèƒ½ï¼Œåªæœ‰å½¢æˆé›†ç¾¤ï¼Œæ‰èƒ½æœ€å¤§ç¨‹åº¦å‘æŒ¥å®¹å™¨çš„è‰¯å¥½éš”ç¦»ã€èµ„æºåˆ†é…ä¸ç¼–æ’ç®¡ç†çš„ä¼˜åŠ¿</p><h3 id="å¾®æœåŠ¡æ¶æ„"><a href="#å¾®æœåŠ¡æ¶æ„" class="headerlink" title="å¾®æœåŠ¡æ¶æ„"></a>å¾®æœåŠ¡æ¶æ„</h3><p>è¿‘å‡ å¹´å¾®æœåŠ¡æ¶æ„ï¼ˆ<code>Micro-Service</code>ï¼Œ<code>Archeticture</code>ï¼‰æ˜¯æœ€æµè¡Œçš„æ¶æ„é£æ ¼ï¼Œæ—¨åœ¨é€šè¿‡å°†åŠŸèƒ½æ¨¡å—åˆ†è§£åˆ°å„ä¸ªç‹¬ç«‹çš„å­ç³»ç»Ÿä¸­ä»¥å®ç°è§£è€¦ï¼Œå®ƒå¹¶æ²¡æœ‰ä¸€æˆä¸å˜çš„è§„å®šï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®ä¸šåŠ¡æ¥åšè®¾è®¡ã€‚å¾®æœåŠ¡æ¶æ„æ˜¯å¯¹SOAçš„ä¼ æ‰¿ï¼Œæ˜¯SOAçš„å…·ä½“å®è·µæ–¹æ³•ã€‚å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ¯ä¸ªå¾®æœåŠ¡æ¨¡å—åªæ˜¯å¯¹ç®€å•ã€ç‹¬ç«‹ã€æ˜ç¡®çš„ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡REST APIè¿”å›å¤„ç†ç»“æœç»™å¤–éƒ¨ã€‚åœ¨å¾®æœåŠ¡æ¨å¹¿å®è·µè§’åº¦æ¥çœ‹ï¼Œå¾®æœåŠ¡å°†æ•´ä¸ªç³»ç»Ÿè¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†æˆæ›´å°çš„ç²’åº¦ï¼Œä¿æŒè¿™äº›æœåŠ¡ç‹¬ç«‹è¿è¡Œï¼Œåº”ç”¨å®¹å™¨åŒ–æŠ€æœ¯å°†å¾®æœåŠ¡ç‹¬ç«‹è¿è¡Œåœ¨å®¹å™¨ä¸­ã€‚è¿‡å»è®¾è®¡æ¶æ„æ—¶ï¼Œæ˜¯åœ¨å†…å­˜ä¸­ä»¥å‚æ•°æˆ–å¯¹è±¡çš„æ–¹å¼å®ç°ç²’åº¦ç»†åŒ–ã€‚å¾®æœåŠ¡ä½¿ç”¨å„ä¸ªå­æœåŠ¡æ§åˆ¶æ¨¡å—çš„æ€æƒ³ä»£æ›¿æ€»çº¿ã€‚ä¸åŒçš„ä¸šåŠ¡è¦æ±‚ï¼ŒæœåŠ¡æ§åˆ¶æ¨¡å—è‡³å°‘åŒ…å«æœåŠ¡çš„å‘å¸ƒã€æ³¨å†Œã€è·¯ç”±ã€ä»£ç†åŠŸèƒ½ã€‚</p><p>å®¹å™¨åŒ–çš„å‡ºç°ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¸¦åŠ¨äº†å¾®æœåŠ¡æ¶æ„ã€‚æ¶æ„æ¼”åŒ–ä»å•ä½“å¼åº”ç”¨åˆ°åˆ†å¸ƒå¼ï¼Œå†ä»åˆ†å¸ƒå¼æ¶æ„åˆ°äº‘åŸç”Ÿæ¶æ„ï¼Œå¾®æœåŠ¡åœ¨å…¶ä¸­æœ‰ç€ä¸å¯æˆ–ç¼ºçš„è§’è‰²ã€‚å¾®æœåŠ¡å¸¦ç»™æˆ‘ä»¬å¾ˆå¤šå¼€å‘å’Œéƒ¨ç½²ä¸Šçš„çµæ´»æ€§å’ŒæŠ€æœ¯å¤šæ ·æ€§ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†æœåŠ¡è°ƒç”¨çš„å¼€é”€ã€åˆ†å¸ƒå¼ç³»äº‹åŠ¡ã€è°ƒè¯•ä¸æœåŠ¡æ²»ç†æ–¹é¢çš„éš¾é¢˜ã€‚  </p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æŠ€æœ¯æ¶æ„çš„æ¼”å˜éå¸¸å¿«ï¼Œå„ç§æ–°çš„åè¯ä¹Ÿæ˜¯å±‚å‡ºä¸ç©·ã€‚æœ¬æ–‡ä¸»è¦æ˜¯å¯¹äº‘åŸç”Ÿçš„æ¦‚è¿°ã€‚äº‘åŸç”Ÿåº”ç”¨çš„ä¸‰å¤§ç‰¹å¾ï¼šå®¹å™¨åŒ–å°è£…ã€åŠ¨æ€ç®¡ç†ã€é¢å‘å¾®æœåŠ¡ã€‚é¦–å…ˆç”±CNCFç»„ç»‡ä»‹ç»äº†äº‘åŸç”Ÿçš„æ¦‚å¿µï¼Œç„¶ååˆ†åˆ«å¯¹è¿™ä¸‰ä¸ªç‰¹å¾è¿›è¡Œè¯¦è¿°ã€‚äº‘åŸç”Ÿæ¶æ„æ˜¯å½“ä¸‹å¾ˆç«çš„è®¨è®ºè¯é¢˜ï¼Œæ˜¯ä¸åŒæ€æƒ³çš„é›†åˆï¼Œé›†ç›®å‰å„ç§çƒ­é—¨æŠ€æœ¯ä¹‹å¤§æˆ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿ&lt;/h2&gt;&lt;h3 id=&quot;CNCFç»„ç»‡&quot;&gt;&lt;a href=&quot;#CNCFç»„ç»‡&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="è®¾è®¡å¼€å‘" scheme="https://liei.cc/blog/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Docker" scheme="https://liei.cc/blog/tags/docker/"/>
    
    <category term="Cloud Navite" scheme="https://liei.cc/blog/tags/cloud-navite/"/>
    
    <category term="Kubernetes" scheme="https://liei.cc/blog/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>ä¼˜åŒ–ç¡è§‰çš„æ²™å‘</title>
    <link href="https://liei.cc/2018/optimization-blog-theme.html"/>
    <id>https://liei.cc/2018/optimization-blog-theme.html</id>
    <published>2018-08-20T14:15:15.000Z</published>
    <updated>2018-08-20T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åšå®¢å¤ªä¹…æ²¡åŠ¨äº†ï¼Œåˆšå¥½æ²¡äº‹åšçš„æ—¶å€™ï¼Œå°±ç‰¹åˆ«æ”¹åšå®¢ä¸»é¢˜ï¼Œæ„Ÿè§‰åƒæ˜¯å¼ºè¿«ç—‡ï¼Œå¾—æ”¹~</p><p>ç©åšå®¢ä¹…äº†ï¼Œå°±åƒè°ˆæ‹çˆ±ï¼Œåˆšå¼€å§‹å¾ˆç¾å¥½ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œé—®é¢˜å°±å†’å‡ºæ¥ï¼Œæ€»æƒ³è®©å¥¹å˜çš„æ›´å¥½ï¼Œ</p><p>å…¶å®è¿™äº›éƒ½æ˜¯æ¬¡è¦çš„ï¼Œæˆ‘ä¹ŸçŸ¥é“æ›´åº”è¯¥ä¸“æ³¨æ–‡ç« çš„å†…å®¹ï¼Œå“â€¦â€¦</p></blockquote><h2 id="é›†æˆGitment"><a href="#é›†æˆGitment" class="headerlink" title="é›†æˆGitment"></a>é›†æˆGitment</h2><p><a href="https://github.com/imsun/gitment"><strong>Gitment</strong></a> æ˜¯ä½œè€…å®ç°çš„ä¸€æ¬¾åŸºäº GitHub Issues çš„è¯„è®ºç³»ç»Ÿã€‚æ”¯æŒåœ¨å‰ç«¯ç›´æ¥å¼•å…¥ï¼Œä¸éœ€è¦ä»»ä½•åç«¯ä»£ç ã€‚å¯ä»¥åœ¨é¡µé¢è¿›è¡Œç™»å½•ã€æŸ¥çœ‹ã€è¯„è®ºã€ç‚¹èµç­‰æ“ä½œï¼ŒåŒæ—¶æœ‰å®Œæ•´çš„ Markdown &#x2F; GFM å’Œä»£ç é«˜äº®æ”¯æŒã€‚å°¤ä¸ºé€‚åˆå„ç§åŸºäº GitHub&#x2F;Coding Pages çš„é™æ€åšå®¢æˆ–é¡¹ç›®é¡µé¢</p><ul><li><a href="https://github.com/imsun/gitment"><strong>é¡¹ç›®åœ°å€</strong></a></li><li><a href="https://imsun.github.io/gitment/"><strong>ç¤ºä¾‹é¡µé¢</strong></a></li></ul><p>å½“ç„¶ï¼Œäººå®¶ä½œè€…ä¹Ÿè¯´äº†ï¼Œç€è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™è€ƒè™‘è¿‡åˆ°åº•æœ‰æ²¡æœ‰æ»¥ç”¨ GitHub ï¼Œä¸ºæ­¤è¿˜ç‰¹åœ° Email äº†å®˜æ–¹ï¼ŒGitHub ç»™å‡ºçš„å›å¤æ˜¯ï¼š</p><blockquote><p>Weâ€™re pleased to see you making use of the tools and resources available on GitHub.</p></blockquote><p>æ‰€ä»¥å•Šï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œä¹Ÿè¦æªå°½èŒå®ˆï¼Œç»´æŠ¤ä¸€ä¸ªå¥½çš„å¼€æºç¯å¢ƒï¼Œå–„ç”¨ <code>GitHub</code></p><p>å¥½äº†ï¼Œè¯´å¤šäº†ï¼Œä¸‹é¢å¼€å§‹ï¼š</p><h3 id="æ³¨å†Œ-OAuth-Application"><a href="#æ³¨å†Œ-OAuth-Application" class="headerlink" title="æ³¨å†Œ OAuth Application"></a>æ³¨å†Œ OAuth Application</h3><p><a href="https://github.com/settings/applications/new">ç‚¹å‡»æ­¤å¤„</a> æ¥æ³¨å†Œä¸€ä¸ªæ–°çš„ OAuth Applicationï¼ŒæˆåŠŸä¹‹åå°±ä¼šæ‹¿åˆ° <code>Client ID</code> å’Œ <code>Client Secret</code></p><h3 id="ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># Plugins</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Gitment</span></span><br><span class="line"><span class="attr">gitment:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">owner:</span> <span class="string">your_id</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">your_repo</span></span><br><span class="line">  <span class="attr">client_id:</span> <span class="string">your_client_id</span></span><br><span class="line">  <span class="attr">client_secret:</span> <span class="string">your_client_secret</span></span><br></pre></td></tr></table></figure><h3 id="ä¸º-Gitment-æ·»åŠ -layout-å¸ƒå±€"><a href="#ä¸º-Gitment-æ·»åŠ -layout-å¸ƒå±€" class="headerlink" title="ä¸º Gitment æ·»åŠ  layout å¸ƒå±€"></a>ä¸º Gitment æ·»åŠ  layout å¸ƒå±€</h3><p>è¿™é‡Œä»¥æˆ‘çš„ä¸»é¢˜ <a href="https://github.com/probberechts/hexo-theme-cactus"><strong>cactus</strong></a> ä¸ºä¾‹ï¼Œåœ¨ <code>layout/_partial/comments.ejs</code> ä¸‹åˆ—ä»£æ·»åŠ ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;% if(is_post() || page.comments) &#123; %&gt;</span><br><span class="line">&lt;div id=&quot;gitment_title&quot; class=&quot;gitment_title&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;container&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;https://imsun.github.io/gitment/dist/gitment.browser.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  const myTheme = &#123;</span><br><span class="line">    render(state, instance) &#123;</span><br><span class="line">      const container = document.createElement(&#x27;div&#x27;);</span><br><span class="line">      container.lang = &quot;en-US&quot;;</span><br><span class="line">      container.className = &#x27;gitment-container gitment-root-container&#x27;;</span><br><span class="line">      container.appendChild(instance.renderHeader(state, instance));</span><br><span class="line">      container.appendChild(instance.renderEditor(state, instance));</span><br><span class="line">      container.appendChild(instance.renderComments(state, instance));</span><br><span class="line">      container.appendChild(instance.renderFooter(state, instance));</span><br><span class="line">      return container;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function showGitment() &#123;</span><br><span class="line">    $(&quot;#gitment_title&quot;).attr(&quot;style&quot;, &quot;display:none&quot;);</span><br><span class="line">    $(&quot;#container&quot;).attr(&quot;style&quot;, &quot;&quot;).addClass(&quot;gitment_container&quot;);</span><br><span class="line">    var gitment = new Gitment(&#123;</span><br><span class="line">      id: decodeURI(window.location.pathname),</span><br><span class="line">      theme: myTheme,</span><br><span class="line">      owner: &quot;&lt;%=theme.gitment.owner%&gt;&quot;,</span><br><span class="line">      repo: &quot;&lt;%=theme.gitment.repo%&gt;&quot;,</span><br><span class="line">      oauth: &#123;</span><br><span class="line">          client_id: &quot;&lt;%=theme.gitment.client_id%&gt;&quot;,</span><br><span class="line">          client_secret: &quot;&lt;%=theme.gitment.client_secret%&gt;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    gitment.render(&#x27;container&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  showGitment();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><h3 id="ä¸º-Gitment-æ·»åŠ æ ·å¼"><a href="#ä¸º-Gitment-æ·»åŠ æ ·å¼" class="headerlink" title="ä¸º Gitment æ·»åŠ æ ·å¼"></a>ä¸º Gitment æ·»åŠ æ ·å¼</h3><p><a href="https://github.com/leeifme/leeifme.github.io/blob/hexo/themes/cactus/source/css/_gitment.styl"><strong>_gitment.styl</strong></a> è¿™æ˜¯æˆ‘è‡ªå®šä¹‰çš„ Gitment çš„æ ·å¼æ–‡ä»¶ï¼Œæ¯”è¾ƒå¥‘åˆæˆ‘çš„ä¸»é¢˜ <code>cactus</code> ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ï¼›å°†æ ·å¼æ–‡ä»¶æ‹·è´åˆ° <code>source/css/</code> ç›®å½•ä¸‹</p><p><strong>å¼•å…¥ Gitment æ ·å¼</strong></p><p>åœ¨ <code>source/css/style.styl</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ï¼š</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&quot;_gitment.styl&quot;</span></span><br></pre></td></tr></table></figure><p>okï¼Œæ›´æ–°åšå®¢ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯„è®ºäº†</p><h2 id="ä¸»é¢˜é¦–é¡µæ·»åŠ -ä¸€è¨€"><a href="#ä¸»é¢˜é¦–é¡µæ·»åŠ -ä¸€è¨€" class="headerlink" title="ä¸»é¢˜é¦–é¡µæ·»åŠ  ä¸€è¨€"></a>ä¸»é¢˜é¦–é¡µæ·»åŠ  ä¸€è¨€</h2><blockquote><p>ä¸€è¨€ï¼šéšæœºä¸€å¥è¯å‰¯æ ‡é¢˜ï¼Œ</p><p>å¯ä»¥æ˜¯ä¸€æœ¬ä¹¦ï¼Œä¸€éƒ¨ç”µå½±ï¼Œä¸€å¥æ­Œè¯ï¼Œ</p><p>å¯ä»¥æ˜¯ä¸­æ–‡ï¼Œè‹±æ–‡ï¼Œæ—¥è¯­ï¼Œ</p><p>æ€»ä¹‹æ˜¯ä¸€å¥è¯</p></blockquote><p>æ„Ÿè°¢ä½œè€…ï¼š<a href="https://github.com/isecret"><strong>isecret</strong></a>ï¼Œæ˜¯ä»ä»–ä»–åˆ¶ä½œçš„ Hexo ä¸»é¢˜ <a href="https://github.com/isecret/Hola"><strong>Hola</strong></a> è·å–çš„çµæ„Ÿ</p><h3 id="ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶-1"><a href="#ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶-1" class="headerlink" title="ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># Plugins</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¸€è¨€</span></span><br><span class="line"><span class="attr">hitokoto:</span> <span class="string">enabled</span></span><br></pre></td></tr></table></figure><h3 id="ä¸ºä¸€è¨€æ·»åŠ -layout-å¸ƒå±€"><a href="#ä¸ºä¸€è¨€æ·»åŠ -layout-å¸ƒå±€" class="headerlink" title="ä¸ºä¸€è¨€æ·»åŠ  layout å¸ƒå±€"></a>ä¸ºä¸€è¨€æ·»åŠ  layout å¸ƒå±€</h3><p>åœ¨ <code>layout/index.styl</code> æ–‡ä»¶ä¸­çš„ <code>&lt;section id=&quot;about&quot;&gt;</code> å†…æ·»åŠ ï¼š</p><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (theme<span class="selector-class">.hitokoto</span> == <span class="string">&#x27;enabled&#x27;</span>) &#123; %&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      &lt;script&gt;</span><br><span class="line">          <span class="built_in">fetch</span>(<span class="string">&#x27;https://api.hitokoto.cn&#x27;</span>)</span><br><span class="line">              <span class="selector-class">.then</span>(function (res)&#123;</span><br><span class="line">                  return res<span class="selector-class">.json</span>();</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="selector-class">.then</span>(function (data) &#123;</span><br><span class="line">                  <span class="selector-tag">var</span> hitokoto = document<span class="selector-class">.getElementById</span>(<span class="string">&#x27;hitokoto&#x27;</span>);</span><br><span class="line">                  hitokoto<span class="selector-class">.innerText</span> =  data<span class="selector-class">.hitokoto</span> + <span class="string">&#x27; â€”â€”&#x27;</span> + <span class="string">&#x27;ã€&#x27;</span> + data<span class="selector-class">.from</span> + <span class="string">&#x27;ã€&#x27;</span>;</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="selector-class">.catch</span>(function (err) &#123;</span><br><span class="line">                  console<span class="selector-class">.error</span>(err);</span><br><span class="line">              &#125;);</span><br><span class="line">      &lt;/script&gt;</span><br><span class="line">      &lt;<span class="selector-tag">a</span> id=<span class="string">&quot;hitokoto&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line"> &lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p><a href="https://leeif.me/"><strong>æ¼”ç¤ºåœ°å€</strong></a> </p><h2 id="gulp-æ–‡ä»¶å‹ç¼©"><a href="#gulp-æ–‡ä»¶å‹ç¼©" class="headerlink" title="gulp æ–‡ä»¶å‹ç¼©"></a>gulp æ–‡ä»¶å‹ç¼©</h2><h3 id="å®‰è£…-npm-ä¾èµ–ç»„ä»¶"><a href="#å®‰è£…-npm-ä¾èµ–ç»„ä»¶" class="headerlink" title="å®‰è£… npm ä¾èµ–ç»„ä»¶"></a>å®‰è£… npm ä¾èµ–ç»„ä»¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span></span><br><span class="line"></span><br><span class="line">npm install gulp -g</span><br><span class="line">npm install gulp-minify-css gulp-uglify gulp-htmlmin gulp-htmlclean gulp --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å—ä½œç”¨</span></span><br><span class="line">gulp-htmlclean // æ¸…ç†html</span><br><span class="line">gulp-htmlmin // å‹ç¼©html</span><br><span class="line">gulp-minify-css // å‹ç¼©css</span><br><span class="line">gulp-uglify // æ··æ·†js</span><br><span class="line">gulp-imagemin // å‹ç¼©å›¾ç‰‡</span><br></pre></td></tr></table></figure><h3 id="æ–°å»º-gulp-é…ç½®"><a href="#æ–°å»º-gulp-é…ç½®" class="headerlink" title="æ–°å»º gulp é…ç½®"></a>æ–°å»º gulp é…ç½®</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* åœ¨ç«™ç‚¹æ ¹ç›®å½•æ·»åŠ  gulpfile.js æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> minifycss = <span class="built_in">require</span>(<span class="string">&#x27;gulp-minify-css&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">&#x27;gulp-uglify&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlmin&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlclean&#x27;</span>);</span><br><span class="line"><span class="comment">// å‹ç¼© public ç›®å½• css</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-css&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.css&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">minifycss</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å‹ç¼© public ç›®å½• html</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-html&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.html&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">htmlclean</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">         <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="attr">minifyJS</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">         <span class="attr">minifyURLs</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å‹ç¼© public/js ç›®å½• js</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-js&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.js&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// æ‰§è¡Œ gulp å‘½ä»¤æ—¶æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;default&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;minify-html&#x27;</span>,<span class="string">&#x27;minify-css&#x27;</span>,<span class="string">&#x27;minify-js&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²å‘½ä»¤"><a href="#éƒ¨ç½²å‘½ä»¤" class="headerlink" title="éƒ¨ç½²å‘½ä»¤"></a>éƒ¨ç½²å‘½ä»¤</h3><p>åœ¨ç«™ç‚¹æ ¹ç›®å½•æ‰§è¡Œ <code>gulp</code> å‘½ä»¤ï¼Œå°±èƒ½å‹ç¼© <code>public</code> æ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶äº†</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo g &amp;&amp; gulp;</span><br><span class="line">hexo d;</span><br></pre></td></tr></table></figure><blockquote><p>åç»­æœ‰å…¶ä»–ä¼˜åŒ–ï¼Œä¼šæŒç»­æ›´æ–°çš„â€¦â€¦</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åšå®¢å¤ªä¹…æ²¡åŠ¨äº†ï¼Œåˆšå¥½æ²¡äº‹åšçš„æ—¶å€™ï¼Œå°±ç‰¹åˆ«æ”¹åšå®¢ä¸»é¢˜ï¼Œæ„Ÿè§‰åƒæ˜¯å¼ºè¿«ç—‡ï¼Œå¾—æ”¹~&lt;/p&gt;
&lt;p&gt;ç©åšå®¢ä¹…äº†ï¼Œå°±åƒè°ˆæ‹çˆ±ï¼Œåˆšå¼€å§‹å¾ˆç¾å¥½ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œé—®é¢˜å°±å†’å‡ºæ¥ï¼Œæ€»æƒ³è®©å¥¹å˜çš„æ›´å¥½ï¼Œ&lt;/p&gt;
&lt;p&gt;å…¶å®è¿™äº›éƒ½æ˜¯æ¬¡è¦çš„ï¼Œæˆ‘ä¹ŸçŸ¥é“æ›´åº”è¯¥ä¸“æ³¨æ–‡ç« çš„å†…å®¹ï¼Œå“â€¦â€¦&lt;/p</summary>
      
    
    
    
    <category term="æŠ˜è…¾ä¸æ­¢" scheme="https://liei.cc/blog/categories/%E6%8A%98%E8%85%BE%E4%B8%8D%E6%AD%A2/"/>
    
    
    <category term="Hexo" scheme="https://liei.cc/blog/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>ä½ å’Œå¤§ä½¬ä¹‹é—´å°±å·®ä¸€ä¸ª vim</title>
    <link href="https://liei.cc/2018/vim-common-hotkey.html"/>
    <id>https://liei.cc/2018/vim-common-hotkey.html</id>
    <published>2018-08-15T14:15:15.000Z</published>
    <updated>2018-08-15T14:15:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¿›å…¥-vim"><a href="#è¿›å…¥-vim" class="headerlink" title="è¿›å…¥ vim"></a>è¿›å…¥ vim</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>vim filename</td><td>æ‰“å¼€æˆ–æ–°å»ºæ–‡ä»¶, å¹¶å°†å…‰æ ‡ç½®äºç¬¬ä¸€è¡Œé¦–</td></tr><tr><td>vim +n filename</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å°†å…‰æ ‡ç½®äºç¬¬ n è¡Œé¦–</td></tr><tr><td>vim + filename</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å°†å…‰æ ‡ç½®äºæœ€åä¸€è¡Œé¦–</td></tr><tr><td>vim +&#x2F;pattern filename</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å°†å…‰æ ‡ç½®äºç¬¬ä¸€ä¸ªä¸ pattern åŒ¹é…çš„ä¸²å¤„</td></tr><tr><td>vim -r filename</td><td>åœ¨ä¸Šæ¬¡æ­£ç”¨ vim ç¼–è¾‘æ—¶å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œæ¢å¤ filename</td></tr><tr><td>vim filenameâ€¦.filename</td><td>æ‰“å¼€å¤šä¸ªæ–‡ä»¶ï¼Œä¾æ¬¡ç¼–è¾‘</td></tr></tbody></table><h2 id="vim-é…ç½®"><a href="#vim-é…ç½®" class="headerlink" title="vim é…ç½®"></a>vim é…ç½®</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>:set number &#x2F; set nonumber</td><td>æ˜¾ç¤º &#x2F; ä¸æ˜¾ç¤ºè¡Œå·</td></tr><tr><td>:set ruler &#x2F;set noruler</td><td>æ˜¾ç¤º &#x2F; ä¸æ˜¾ç¤ºæ ‡å°º</td></tr><tr><td>:set hlsearch</td><td>é«˜äº®æ˜¾ç¤ºæŸ¥æ‰¾åˆ°çš„å•è¯</td></tr><tr><td>:set nohlsearch</td><td>å…³é—­é«˜äº®æ˜¾ç¤º</td></tr><tr><td>:syntax on</td><td>è¯­æ³•é«˜äº®</td></tr><tr><td>:set nu</td><td>æ˜¾ç¤ºè¡Œå·</td></tr><tr><td>:set tabstop&#x3D;8</td><td>è®¾ç½® tab å¤§å°, 8 ä¸ºæœ€å¸¸ç”¨æœ€æ™®éçš„è®¾ç½®</td></tr><tr><td>:set softtabstop&#x3D;8</td><td>4:4 ä¸ªç©ºæ ¼, 8: æ­£å¸¸çš„åˆ¶è¡¨ç¬¦, 12: ä¸€ä¸ªåˆ¶è¡¨ç¬¦ 4 ä¸ªç©ºæ ¼, 16: ä¸¤ä¸ªåˆ¶è¡¨ç¬¦</td></tr><tr><td>:set autoindent</td><td>è‡ªåŠ¨ç¼©è¿›</td></tr><tr><td>:set cindent</td><td>C è¯­è¨€æ ¼å¼é‡Œé¢çš„è‡ªåŠ¨ç¼©è¿›</td></tr></tbody></table><h2 id="ç§»åŠ¨å…‰æ ‡"><a href="#ç§»åŠ¨å…‰æ ‡" class="headerlink" title="ç§»åŠ¨å…‰æ ‡"></a>ç§»åŠ¨å…‰æ ‡</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>k nk</td><td>ä¸Š å‘ä¸Šç§»åŠ¨ n è¡Œ</td></tr><tr><td>j nj</td><td>ä¸‹ å‘ä¸‹ç§»åŠ¨ n è¡Œ</td></tr><tr><td>h nh</td><td>å·¦ å‘å·¦ç§»åŠ¨ n è¡Œ</td></tr><tr><td>l nl</td><td>å³ å‘å³ç§»åŠ¨ n è¡Œ</td></tr><tr><td>Space</td><td>å…‰æ ‡å³ç§»ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>Backspace</td><td>å…‰æ ‡å·¦ç§»ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>Enter</td><td>å…‰æ ‡ä¸‹ç§»ä¸€è¡Œ</td></tr><tr><td>w&#x2F;W</td><td>å…‰æ ‡å³ç§»ä¸€ä¸ªå­—è‡³å­—é¦–</td></tr><tr><td>b&#x2F;B</td><td>å…‰æ ‡å·¦ç§»ä¸€ä¸ªå­—è‡³å­—é¦–</td></tr><tr><td>e æˆ– E</td><td>å…‰æ ‡å³ç§»ä¸€ä¸ªå­—è‡³å­—å°¾</td></tr><tr><td>)</td><td>å…‰æ ‡ç§»è‡³å¥å°¾</td></tr><tr><td>(</td><td>å…‰æ ‡ç§»è‡³å¥é¦–</td></tr><tr><td>}</td><td>å…‰æ ‡ç§»è‡³æ®µè½å¼€å¤´</td></tr><tr><td>{</td><td>å…‰æ ‡ç§»è‡³æ®µè½ç»“å°¾</td></tr><tr><td>n$</td><td>å…‰æ ‡ç§»è‡³ç¬¬ n è¡Œå°¾</td></tr><tr><td>H</td><td>å…‰æ ‡ç§»è‡³å±å¹•é¡¶è¡Œ</td></tr><tr><td>M</td><td>å…‰æ ‡ç§»è‡³å±å¹•ä¸­é—´è¡Œ</td></tr><tr><td>L</td><td>å…‰æ ‡ç§»è‡³å±å¹•æœ€åè¡Œ</td></tr><tr><td>0</td><td>ï¼ˆæ³¨æ„æ˜¯æ•°å­—é›¶ï¼‰å…‰æ ‡ç§»è‡³å½“å‰è¡Œé¦–</td></tr><tr><td>^</td><td>ç§»åŠ¨å…‰æ ‡åˆ°è¡Œé¦–ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦ä¸Šå»</td></tr><tr><td>$</td><td>å…‰æ ‡ç§»è‡³å½“å‰è¡Œå°¾</td></tr><tr><td>gg</td><td>ç§»åˆ°ç¬¬ä¸€è¡Œ</td></tr><tr><td>G</td><td>ç§»åˆ°æœ€åä¸€è¡Œ</td></tr><tr><td>f</td><td>ç§»åŠ¨å…‰æ ‡åˆ°å½“å‰è¡Œçš„å­—ç¬¦ a ä¸Š</td></tr><tr><td>F</td><td>ç›¸å</td></tr><tr><td>%</td><td>ç§»åŠ¨åˆ°ä¸åˆ¶åŒ¹é…çš„æ‹¬å·ä¸Šå»ï¼ˆï¼‰ï¼Œ{}ï¼Œ[]ï¼Œ&lt;&gt; ç­‰</td></tr><tr><td>nG</td><td>ç§»åŠ¨åˆ°ç¬¬ n è¡Œä¸Š</td></tr><tr><td>G</td><td>åˆ°æœ€åä¸€è¡Œ</td></tr></tbody></table><h2 id="å±å¹•æ»šåŠ¨"><a href="#å±å¹•æ»šåŠ¨" class="headerlink" title="å±å¹•æ»šåŠ¨"></a>å±å¹•æ»šåŠ¨</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Ctrl+u</td><td>å‘æ–‡ä»¶é¦–ç¿»åŠå±</td></tr><tr><td>Ctrl+d</td><td>å‘æ–‡ä»¶å°¾ç¿»åŠå±</td></tr><tr><td>Ctrl+f</td><td>å‘æ–‡ä»¶å°¾ç¿»ä¸€å±</td></tr><tr><td>Ctrlï¼‹b</td><td>å‘æ–‡ä»¶é¦–ç¿»ä¸€å±</td></tr><tr><td>nz</td><td>å°†ç¬¬ n è¡Œæ»šè‡³å±å¹•é¡¶éƒ¨ï¼Œä¸æŒ‡å®š n æ—¶å°†å½“å‰è¡Œæ»šè‡³å±å¹•é¡¶éƒ¨</td></tr></tbody></table><h2 id="æ’å…¥æ–‡æœ¬ç±»"><a href="#æ’å…¥æ–‡æœ¬ç±»" class="headerlink" title="æ’å…¥æ–‡æœ¬ç±»"></a>æ’å…¥æ–‡æœ¬ç±»</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>i</td><td>åœ¨å…‰æ ‡å‰</td></tr><tr><td>I</td><td>åœ¨å½“å‰è¡Œé¦–</td></tr><tr><td>a</td><td>å…‰æ ‡å</td></tr><tr><td>A</td><td>åœ¨å½“å‰è¡Œå°¾</td></tr><tr><td>o</td><td>åœ¨å½“å‰è¡Œä¹‹ä¸‹æ–°å¼€ä¸€è¡Œ</td></tr><tr><td>O</td><td>åœ¨å½“å‰è¡Œä¹‹ä¸Šæ–°å¼€ä¸€è¡Œ</td></tr><tr><td>r</td><td>æ›¿æ¢å½“å‰å­—ç¬¦</td></tr><tr><td>R</td><td>æ›¿æ¢å½“å‰å­—ç¬¦åŠå…¶åçš„å­—ç¬¦ï¼Œç›´è‡³æŒ‰ ESC é”®</td></tr><tr><td>s</td><td>ä»å½“å‰å…‰æ ‡ä½ç½®å¤„å¼€å§‹ï¼Œä»¥è¾“å…¥çš„æ–‡æœ¬æ›¿ä»£æŒ‡å®šæ•°ç›®çš„å­—ç¬¦</td></tr><tr><td>S</td><td>åˆ é™¤æŒ‡å®šæ•°ç›®çš„è¡Œï¼Œå¹¶ä»¥æ‰€è¾“å…¥æ–‡æœ¬ä»£æ›¿ä¹‹</td></tr><tr><td>ncw&#x2F;nCW</td><td>ä¿®æ”¹æŒ‡å®šæ•°ç›®çš„å­—</td></tr><tr><td>nCC</td><td>ä¿®æ”¹æŒ‡å®šæ•°ç›®çš„è¡Œ</td></tr></tbody></table><h2 id="åˆ é™¤å‘½ä»¤"><a href="#åˆ é™¤å‘½ä»¤" class="headerlink" title="åˆ é™¤å‘½ä»¤"></a>åˆ é™¤å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>x&#x2F;X</td><td>åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼Œx åˆ é™¤å…‰æ ‡åçš„ï¼Œè€Œ X åˆ é™¤å…‰æ ‡å‰çš„</td></tr><tr><td>dw</td><td>åˆ é™¤ä¸€ä¸ªå•è¯ (åˆ é™¤å…‰æ ‡ä½ç½®åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å§‹çš„ä½ç½®)</td></tr><tr><td>dnw</td><td>åˆ é™¤ n ä¸ªå•è¯</td></tr><tr><td>dne</td><td>ä¹Ÿå¯ï¼Œåªæ˜¯åˆ é™¤åˆ°å•è¯å°¾</td></tr><tr><td>do</td><td>åˆ è‡³è¡Œé¦–</td></tr><tr><td>d$</td><td>åˆ è‡³è¡Œå°¾</td></tr><tr><td>dd</td><td>åˆ é™¤ä¸€è¡Œ</td></tr><tr><td>ndd</td><td>åˆ é™¤å½“å‰è¡ŒåŠå…¶å n-1 è¡Œ</td></tr><tr><td>dnl</td><td>å‘å³åˆ é™¤ n ä¸ªå­—æ¯</td></tr><tr><td>dnh</td><td>å‘å·¦åˆ é™¤ n ä¸ªå­—æ¯</td></tr><tr><td>dnj</td><td>å‘ä¸‹åˆ é™¤ n è¡Œ, å½“å‰è¡Œ + å…¶ä¸Š n è¡Œ</td></tr><tr><td>dnk</td><td>å‘ä¸Šåˆ é™¤ n è¡Œ, å½“æœŸè¡Œ + å…¶ä¸‹ n è¡Œ</td></tr><tr><td>cnw[word]</td><td>å°† n ä¸ª word æ”¹å˜ä¸º word</td></tr><tr><td>C$</td><td>æ”¹å˜åˆ°è¡Œå°¾</td></tr><tr><td>cc</td><td>æ”¹å˜æ•´è¡Œ</td></tr><tr><td>shift+j</td><td>åˆ é™¤è¡Œå°¾çš„æ¢è¡Œç¬¦ï¼Œä¸‹ä¸€è¡Œæ¥ä¸Šæ¥äº†</td></tr></tbody></table><h2 id="å¤åˆ¶ç²˜è´´"><a href="#å¤åˆ¶ç²˜è´´" class="headerlink" title="å¤åˆ¶ç²˜è´´"></a>å¤åˆ¶ç²˜è´´</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>p</td><td>ç²˜è´´ç”¨ x æˆ– d åˆ é™¤çš„æ–‡æœ¬</td></tr><tr><td>ynw</td><td>å¤åˆ¶ n ä¸ªå•è¯</td></tr><tr><td>yy</td><td>å¤åˆ¶ä¸€è¡Œ</td></tr><tr><td>ynl</td><td>å¤åˆ¶ n ä¸ªå­—ç¬¦</td></tr><tr><td>y$</td><td>å¤åˆ¶å½“å‰å…‰æ ‡è‡³è¡Œå°¾å¤„</td></tr><tr><td>nyy</td><td>æ‹·è´ n è¡Œ</td></tr></tbody></table><h2 id="æ’¤é”€"><a href="#æ’¤é”€" class="headerlink" title="æ’¤é”€"></a>æ’¤é”€</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>u</td><td>æ’¤é”€å‰ä¸€æ¬¡çš„æ“ä½œ</td></tr><tr><td>shif+u(U)</td><td>æ’¤é”€å¯¹è¯¥è¡Œçš„æ‰€æœ‰æ“ä½œ</td></tr></tbody></table><h2 id="æœç´¢åŠæ›¿æ¢"><a href="#æœç´¢åŠæ›¿æ¢" class="headerlink" title="æœç´¢åŠæ›¿æ¢"></a>æœç´¢åŠæ›¿æ¢</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>&#x2F;pattern</td><td>ä»å…‰æ ‡å¼€å§‹å¤„å‘æ–‡ä»¶å°¾æœç´¢ pattern</td></tr><tr><td>?pattern</td><td>ä»å…‰æ ‡å¼€å§‹å¤„å‘æ–‡ä»¶é¦–æœç´¢ pattern</td></tr><tr><td>n</td><td>åœ¨åŒä¸€æ–¹å‘é‡å¤ä¸Šä¸€æ¬¡æœç´¢å‘½ä»¤</td></tr><tr><td>N</td><td>åœ¨åæ–¹å‘ä¸Šé‡å¤ä¸Šä¸€æ¬¡æœç´¢å‘½ä»¤</td></tr><tr><td>cw newword</td><td>æ›¿æ¢ä¸º newword</td></tr><tr><td>n</td><td>ç»§ç»­æŸ¥æ‰¾</td></tr><tr><td>.</td><td>æ‰§è¡Œæ›¿æ¢</td></tr><tr><td>:s&#x2F;p1&#x2F;p2&#x2F;g</td><td>å°†å½“å‰è¡Œä¸­æ‰€æœ‰ p1 å‡ç”¨ p2 æ›¿ä»£, g è¡¨ç¤ºæ‰§è¡Œ ç”¨ c è¡¨ç¤ºéœ€è¦ç¡®è®¤</td></tr><tr><td>:n1,n2 s&#x2F;p1&#x2F;p2&#x2F;g</td><td>å°†ç¬¬ n1 è‡³ n2 è¡Œä¸­æ‰€æœ‰ p1 å‡ç”¨ p2 æ›¿ä»£</td></tr><tr><td>:g&#x2F;p1&#x2F;s&#x2F;&#x2F;p2&#x2F;g</td><td>å°†æ–‡ä»¶ä¸­æ‰€æœ‰ p1 å‡ç”¨ p2 æ›¿æ¢</td></tr><tr><td>:1,$ s&#x2F;string1&#x2F;string2&#x2F;g</td><td>åœ¨å…¨æ–‡ä¸­å°† string1 æ›¿æ¢ä¸º string2</td></tr></tbody></table><h2 id="ä¹¦ç­¾"><a href="#ä¹¦ç­¾" class="headerlink" title="ä¹¦ç­¾"></a>ä¹¦ç­¾</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>m[a-z]</td><td>åœ¨æ–‡ä¸­åšæ ‡è®°ï¼Œæ ‡è®°å·å¯ä¸º a-z çš„ 26 ä¸ªå­—æ¯</td></tr><tr><td>&#96;a</td><td>ç§»åŠ¨åˆ°æ ‡è®° a å¤„</td></tr></tbody></table><h2 id="visual-æ¨¡å¼"><a href="#visual-æ¨¡å¼" class="headerlink" title="visual æ¨¡å¼"></a>visual æ¨¡å¼</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>v</td><td>è¿›å…¥ visual æ¨¡å¼</td></tr><tr><td>V</td><td>è¿›å…¥è¡Œçš„ visual æ¨¡å¼</td></tr><tr><td>ctrl+v</td><td>è¿›å¦‚å—æ“ä½œæ¨¡å¼ç”¨ o å’Œ O æ”¹å˜é€‰æ‹©çš„è¾¹çš„å¤§å°</td></tr><tr><td>åœ¨æ‰€æœ‰è¡Œæ’å…¥ç›¸åŒçš„å†…å®¹å¦‚ include&lt;</td><td>å°†å…‰æ ‡ç§»åˆ°å¼€å§‹æ’å…¥çš„ä½ç½®ï¼ŒæŒ‰ CTRL+V è¿›å…¥ VISUAL æ¨¡å¼ï¼Œé€‰æ‹©å¥½æ¨¡å—åæŒ‰ Iï¼ˆshift+i)ï¼Œåæ’å…¥è¦æ’å…¥çš„æ–‡æœ¬ï¼ŒæŒ‰ [ESC] å®Œæˆ</td></tr></tbody></table><h2 id="è¡Œæ–¹å¼å‘½ä»¤"><a href="#è¡Œæ–¹å¼å‘½ä»¤" class="headerlink" title="è¡Œæ–¹å¼å‘½ä»¤"></a>è¡Œæ–¹å¼å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>:n1,n2 co n3 æˆ–è€… :n1,n2 copy n3</td><td>å°† n1 è¡Œåˆ° n2 è¡Œä¹‹é—´çš„å†…å®¹æ‹·è´åˆ°ç¬¬ n3 è¡Œä¸‹</td></tr><tr><td>:n1,n2 m n3 æˆ–è€… :n1,n2 move n3</td><td>å°† n1 è¡Œåˆ° n2 è¡Œä¹‹é—´çš„å†…å®¹ç§»è‡³åˆ°ç¬¬ n3 è¡Œä¸‹</td></tr><tr><td>:n1,n2 d</td><td>å°† n1 è¡Œåˆ° n2 è¡Œä¹‹é—´çš„å†…å®¹åˆ é™¤</td></tr><tr><td>:n1,n2 w!command</td><td>å°†æ–‡ä»¶ä¸­ n1 è¡Œè‡³ n2 è¡Œçš„å†…å®¹ä½œä¸º command çš„è¾“å…¥å¹¶æ‰§è¡Œä¹‹</td></tr><tr><td>è‹¥ä¸æŒ‡å®š n1ï¼Œn2ï¼Œåˆ™è¡¨ç¤ºå°†æ•´ä¸ªæ–‡ä»¶å†…å®¹ä½œä¸º command çš„è¾“å…¥</td><td></td></tr></tbody></table><h2 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>q[a-z]</td><td>å¼€å§‹è®°å½•ä½†å‰å¼€å§‹çš„æ“ä½œä¸ºå®ï¼Œåç§°å¯ä¸ºã€a-zã€‘ï¼Œç„¶åç”¨ q ç»ˆæ­¢å½•åˆ¶å®</td></tr><tr><td>reg</td><td>æ˜¾ç¤ºå½“å‰å®šä¹‰çš„æ‰€æœ‰çš„å®ï¼Œç”¨ @[a-z] æ¥åœ¨å½“å‰å…‰æ ‡å¤„æ‰§è¡Œå® [a-z]</td></tr></tbody></table><h2 id="çª—å£æ“ä½œ"><a href="#çª—å£æ“ä½œ" class="headerlink" title="çª—å£æ“ä½œ"></a>çª—å£æ“ä½œ</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>:split</td><td>åˆ†å‰²ä¸€ä¸ªçª—å£</td></tr><tr><td>:split file.c</td><td>ä¸ºå¦ä¸€ä¸ªæ–‡ä»¶ file.c åˆ†éš”çª—å£</td></tr><tr><td>:nsplit file.c</td><td>ä¸ºå¦ä¸€ä¸ªæ–‡ä»¶ file.c åˆ†éš”çª—å£ï¼Œå¹¶æŒ‡å®šå…¶è¡Œæ•°</td></tr><tr><td>ctrlï¼‹w</td><td>åœ¨çª—å£ä¸­åˆ‡æ¢</td></tr><tr><td>:close</td><td>å…³é—­å½“å‰çª—å£</td></tr></tbody></table><h2 id="æ–‡ä»¶åŠå…¶ä»–"><a href="#æ–‡ä»¶åŠå…¶ä»–" class="headerlink" title="æ–‡ä»¶åŠå…¶ä»–"></a>æ–‡ä»¶åŠå…¶ä»–</h2><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>:q</td><td>é€€å‡º vi</td></tr><tr><td>:q!</td><td>ä¸ä¿å­˜æ–‡ä»¶å¹¶é€€å‡º vi</td></tr><tr><td>:e filename</td><td>æ‰“å¼€æ–‡ä»¶ filename è¿›è¡Œç¼–è¾‘</td></tr><tr><td>:e!</td><td>æ”¾å¼ƒä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œé‡æ–°è½½å…¥è¯¥æ–‡ä»¶ç¼–è¾‘</td></tr><tr><td>:w</td><td>ä¿å­˜å½“å‰æ–‡ä»¶</td></tr><tr><td>:wq</td><td>å­˜ç›˜é€€å‡º</td></tr><tr><td>:ZZ</td><td>ä¿å­˜å½“å‰æ–‡æ¡£å¹¶é€€å‡º VIM</td></tr><tr><td>:!command</td><td>æ‰§è¡Œ shell å‘½ä»¤ command</td></tr><tr><td>:r!command</td><td>å°†å‘½ä»¤ command çš„è¾“å‡ºç»“æœæ”¾åˆ°å½“å‰è¡Œ</td></tr><tr><td>:read file.c</td><td>å°†æ–‡ä»¶ file.c çš„å†…å®¹æ’å…¥åˆ°å½“å‰å…‰æ ‡æ‰€åœ¨çš„ä¸‹é¢</td></tr></tbody></table><h2 id="å¸¸ç”¨æ­£åˆ™"><a href="#å¸¸ç”¨æ­£åˆ™" class="headerlink" title="å¸¸ç”¨æ­£åˆ™"></a>å¸¸ç”¨æ­£åˆ™</h2><ul><li>åˆ é™¤è¡Œå°¾ç©ºæ ¼ï¼š<code>:%s/\s+$//g</code></li><li>åˆ é™¤è¡Œé¦–å¤šä½™ç©ºæ ¼ï¼š<code>%s/^\s*//</code> æˆ–è€… <code>%s/^ *//</code></li><li>åˆ é™¤æ²’æœ‰å…§å®¹çš„ç©ºè¡Œï¼š<code>%s/^$//</code> æˆ–è€… <code>g/^$/d</code></li><li>åˆ é™¤åŒ…å«æœ‰ç©ºæ ¼ç»„æˆçš„ç©ºè¡Œï¼š<code>%s/^\s*$//</code> æˆ–è€… <code>g/^\s*$/d</code></li><li>åˆ é™¤ä»¥ç©ºæ ¼æˆ– TAB å¼€å¤´åˆ°ç»“å°¾çš„ç©ºè¡Œï¼š<code>%s/^[ |\t]*$//</code> æˆ–è€… <code>g/^[ |\t]*$/d</code></li><li>æ¸…ç©ºæŸä¸€è¡Œæˆ–å¤šè¡Œæ–‡æœ¬ï¼š<code>:n1,n2 s/\w//g</code></li><li>ç»™ä¸€è¡Œæˆ–å¤šè¡Œé¦–å­—ç¬¦æ·»åŠ æ³¨é‡Šï¼š<code>n1,n2 s/^/#/g</code></li><li>ç»™ä¸€è¡Œæˆ–å¤šè¡Œé¦–å­—ç¬¦åˆ é™¤æ³¨é‡Šï¼š<code>n1,n2 s/^#//g</code></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è¿›å…¥-vim&quot;&gt;&lt;a href=&quot;#è¿›å…¥-vim&quot; class=&quot;headerlink&quot; title=&quot;è¿›å…¥ vim&quot;&gt;&lt;/a&gt;è¿›å…¥ vim&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‘½ä»¤&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thea</summary>
      
    
    
    
    <category term="å®‰åˆ©ç³»åˆ—" scheme="https://liei.cc/blog/categories/%E5%AE%89%E5%88%A9%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Linux" scheme="https://liei.cc/blog/tags/linux/"/>
    
    <category term="Vim" scheme="https://liei.cc/blog/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>gin-swagger è‡ªåŠ¨åŒ–æ„å»º API æ–‡æ¡£</title>
    <link href="https://liei.cc/2018/gin-swagger-build-document.html"/>
    <id>https://liei.cc/2018/gin-swagger-build-document.html</id>
    <published>2018-07-27T20:36:25.000Z</published>
    <updated>2018-07-27T20:36:25.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‰åç«¯çš„äº¤äº’ä¸€èˆ¬æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œåç«¯æš´éœ²å‡º API åï¼Œäº¤ç»™å‰ç«¯ï¼Œå‰ç«¯æ ¹æ® API çš„å“åº”ï¼Œç¼–å†™å‰ç«¯é¡µé¢ï¼Œä¸€å®šç¨‹åº¦ä¸Š API æ˜¯å‰åç«¯çš„äº¤äº’æ¡¥æ¢ã€‚ </p></blockquote><p>API æ–‡æ¡£ä¸»è¦è¦åŒ…å«:</p><ul><li>è·¯ç”±ï¼šåŒ…æ‹¬è·¯å¾„å‚æ•°ã€è¯·æ±‚å‚æ•°ã€è¿˜æ˜¯è¯·æ±‚ä½“å‚æ•°</li><li>åŠ¨ä½œï¼šHTTP è¯·æ±‚åŠ¨ä½œï¼ŒGETã€POSTã€DELETEã€PUT</li><li>å“åº”ï¼šè¯·æ±‚ä¹‹åçš„è¿”å›å€¼åŒ…å«å“ªäº›ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯ JSON</li></ul><p>swagger å¯ä»¥å°†ä»£ç å’Œ api æ–‡æ¡£ç»´æŠ¤åœ¨ä¸€èµ·ï¼Œé€šè¿‡è®¿é—®æœåŠ¡è¿›ç¨‹çš„ swagger é¡µé¢å°±å¯ä»¥å¾—åˆ°å®Œå–„çš„ api æ–‡æ¡£ï¼Œè¿˜å¯ä»¥ç›´æ¥ Try outã€‚ </p><h2 id="docæ–‡æ¡£"><a href="#docæ–‡æ¡£" class="headerlink" title="docæ–‡æ¡£"></a>docæ–‡æ¡£</h2><ul><li><a href="https://github.com/swaggo/gin-swagger"><strong>gin-swagger</strong></a></li><li><a href="https://swaggo.github.io/swaggo.io/declarative_comments_format/"><strong>swagger-doc</strong></a></li></ul><h2 id="åšæ³•"><a href="#åšæ³•" class="headerlink" title="åšæ³•"></a>åšæ³•</h2><ol><li>è¦çŸ¥é“ swagger æ³¨é‡Šçš„è¯­æ³•</li><li>å¦‚ä½•åœ¨ gin å†…æ€ä¹ˆä½¿ç”¨</li></ol><p>æ³¨é‡Šè¯­æ³•è¿™ä¸ªï¼Œå…¨é æŸ¥æ–‡æ¡£ã€‚å¯¹ç€æ–‡æ¡£æ¥ã€‚</p><p>å½“ç„¶æˆ‘è§‰å¾—æœ€å¥½çš„æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Œæ˜¯æ¨¡ä»¿ï¼Œæ‰¾ä¸€ä¸ªåˆ«äººå·²ç»å†™å¥½çš„ï¼Œä¿®ä¿®æ”¹æ”¹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼Œç¼–è¯‘é€šè¿‡åæ˜¯ä¸æ˜¯ä½ é¢„æœŸçš„ç»“æœã€‚ä¸æ˜¯çš„è¯ï¼Œç»§ç»­ä¿®ä¿®æ”¹æ”¹ï¼Œå†ç¼–è¯‘ï¼Œå†çœ‹æ˜¯ä¸æ˜¯ä½ å¸Œæœ›çš„ç»“æœã€‚å¦‚æ­¤åå¤ã€‚</p><p><img src="http://orj2jcr7i.bkt.clouddn.com/blog/180727/2im5i3b45e.png?imageslim" alt="mark"></p><h4 id="1-ç¼–å†™å…¨å±€ä¿¡æ¯æ³¨é‡Šï¼Œåœ¨ä¸»å‡½æ•°ä¸Šç¼–å†™"><a href="#1-ç¼–å†™å…¨å±€ä¿¡æ¯æ³¨é‡Šï¼Œåœ¨ä¸»å‡½æ•°ä¸Šç¼–å†™" class="headerlink" title="1. ç¼–å†™å…¨å±€ä¿¡æ¯æ³¨é‡Šï¼Œåœ¨ä¸»å‡½æ•°ä¸Šç¼–å†™"></a>1. ç¼–å†™å…¨å±€ä¿¡æ¯æ³¨é‡Šï¼Œåœ¨ä¸»å‡½æ•°ä¸Šç¼–å†™</h4><p>æ ¼å¼ï¼š<code>// @param info</code></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @title Swagger Example API</span></span><br><span class="line"><span class="comment">// @version 1.0</span></span><br><span class="line"><span class="comment">// @description This is a sample server Petstore server.</span></span><br><span class="line"><span class="comment">// @termsOfService http://swagger.io/terms/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @contact.name API Support</span></span><br><span class="line"><span class="comment">// @contact.url http://www.swagger.io/support</span></span><br><span class="line"><span class="comment">// @contact.email support@swagger.io</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @license.name Apache 2.0</span></span><br><span class="line"><span class="comment">// @license.url http://www.apache.org/licenses/LICENSE-2.0.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// @host 127.0.0.1:8080</span></span><br><span class="line"><span class="comment">// @BasePath /v1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    r.GET(<span class="string">&quot;/docs/*any&quot;</span>, ginSwagger.WrapHandler(swaggerFiles.Handler))</span><br><span class="line">    r.GET(<span class="string">&quot;v1/hello/:name&quot;</span>, Name)</span><br><span class="line">    r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">r.GET(&quot;/docs/*any&quot;, ginSwagger.WrapHandler(swaggerFiles.Handler))</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè·¯ç”±å’Œå“åº”éœ€è¦æœ‰ï¼Œè·¯ç”±éšä¾¿çš„å®šä¹‰ï¼Œä½†æˆ‘è§‰å¾—æˆ‘è¿™ç§æ–¹å¼ä¸€ç›®äº†ç„¶ï¼ŒçŸ¥é“æ˜¯æ–‡æ¡£ã€‚</p><p>å…¶ä»–æ³¨é‡Šå¯¹ç…§ç€å‚è€ƒæ–‡æ¡£å³å¯ã€‚</p><h4 id="2-ç¼–å†™åº”ç”¨æ³¨é‡Š"><a href="#2-ç¼–å†™åº”ç”¨æ³¨é‡Š" class="headerlink" title="2. ç¼–å†™åº”ç”¨æ³¨é‡Š"></a>2. ç¼–å†™åº”ç”¨æ³¨é‡Š</h4><p>å³åœ¨å“åº”å‡½æ•°çš„ä¸Šæ–¹ç¼–å†™æ³¨é‡Š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Name will print hello name</span></span><br><span class="line"><span class="comment">// @Summary Print</span></span><br><span class="line"><span class="comment">// @Accept json</span></span><br><span class="line"><span class="comment">// @Tags Name</span></span><br><span class="line"><span class="comment">// @Security Bearer</span></span><br><span class="line"><span class="comment">// @Produce  json</span></span><br><span class="line"><span class="comment">// @Param name path string true &quot;name&quot;</span></span><br><span class="line"><span class="comment">// @Resource Name</span></span><br><span class="line"><span class="comment">// @Router /hello/&#123;name&#125; [get]</span></span><br><span class="line"><span class="comment">// @Success 200 &#123;object&#125; main.Message</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Name</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    name := c.Param(<span class="string">&quot;name&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> message Message</span><br><span class="line"></span><br><span class="line">    message = Message&#123;</span><br><span class="line">        MessageInfo: fmt.Sprintf(<span class="string">&quot;hello %s&quot;</span>, name),</span><br><span class="line">    &#125;</span><br><span class="line">    c.JSON(http.StatusOK, message.Serializer())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ€å¥½æŠŠå“åº”ä½“ç»Ÿä¸€æˆç»“æ„ä½“çš„å½¢å¼ã€‚å³</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">    MessageInfo <span class="type">string</span> <span class="string">`json:&quot;message&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Message)</span></span> Serializer()Message&#123;</span><br><span class="line">    <span class="keyword">return</span> Message&#123;</span><br><span class="line">        MessageInfo: m.MessageInfo,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-ç›®å½•ä¸‹-æ‰§è¡Œå‘½ä»¤"><a href="#3-ç›®å½•ä¸‹-æ‰§è¡Œå‘½ä»¤" class="headerlink" title="3. ç›®å½•ä¸‹ æ‰§è¡Œå‘½ä»¤"></a>3. ç›®å½•ä¸‹ æ‰§è¡Œå‘½ä»¤</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">swag init</span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨ç”Ÿæˆ docs æ–‡ä»¶å¤¹ï¼Œå†…å« swagger.json ã€swagger.json ã€ docs.go</p><p>ç¼–è¯‘ä¸é€šè¿‡ï¼ŒæŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œä¿®æ”¹æ³¨é‡Šã€‚</p><h4 id="4-å¯¼å…¥ç”Ÿæˆçš„-docs-æ–‡ä»¶"><a href="#4-å¯¼å…¥ç”Ÿæˆçš„-docs-æ–‡ä»¶" class="headerlink" title="4. å¯¼å…¥ç”Ÿæˆçš„ docs æ–‡ä»¶"></a>4. å¯¼å…¥ç”Ÿæˆçš„ docs æ–‡ä»¶</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/swaggo/gin-swagger&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/swaggo/gin-swagger/swaggerFiles&quot;</span></span><br><span class="line"></span><br><span class="line">    _ <span class="string">&quot;./docs&quot;</span> <span class="comment">// docs is generated by Swag CLI, you have to import it.</span></span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å³è¿™ä¸ª  <code>./docs</code></p><h4 id="5-go-run-main-go"><a href="#5-go-run-main-go" class="headerlink" title="5. go run main.go"></a>5. go run main.go</h4><p>è®¿é—®ï¼š<code>http://127.0.0.1:8080/docs/index.html</code></p><p>å³å¯æŸ¥çœ‹ swagger æ–‡æ¡£ã€‚</p><p><img src="http://orj2jcr7i.bkt.clouddn.com/blog/180727/hidH469gKB.png?imageslim" alt="mark"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‰åç«¯çš„äº¤äº’ä¸€èˆ¬æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œåç«¯æš´éœ²å‡º API åï¼Œäº¤ç»™å‰ç«¯ï¼Œå‰ç«¯æ ¹æ® API çš„å“åº”ï¼Œç¼–å†™å‰ç«¯é¡µé¢ï¼Œä¸€å®šç¨‹åº¦ä¸Š API æ˜¯å‰åç«¯çš„äº¤äº’æ¡¥æ¢ã€‚ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;API æ–‡æ¡£ä¸»è¦è¦åŒ…å«:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è·¯ç”±ï¼š</summary>
      
    
    
    
    <category term="æŠ€æœ¯åŠ æ²¹ç«™" scheme="https://liei.cc/blog/categories/%E6%8A%80%E6%9C%AF%E5%8A%A0%E6%B2%B9%E7%AB%99/"/>
    
    
    <category term="Go" scheme="https://liei.cc/blog/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>é«˜æ€§èƒ½çš„ Go Web æ¡†æ¶ - gin</title>
    <link href="https://liei.cc/2018/gin-go-web-frame.html"/>
    <id>https://liei.cc/2018/gin-go-web-frame.html</id>
    <published>2018-07-26T20:36:25.000Z</published>
    <updated>2018-07-26T20:36:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Gin-çš„ä½¿ç”¨"><a href="#Gin-çš„ä½¿ç”¨" class="headerlink" title="Gin çš„ä½¿ç”¨"></a>Gin çš„ä½¿ç”¨</h2><h3 id="å®‰è£…å’Œæ›´æ–°"><a href="#å®‰è£…å’Œæ›´æ–°" class="headerlink" title="å®‰è£…å’Œæ›´æ–°"></a>å®‰è£…å’Œæ›´æ–°</h3><p>é¦–æ¬¡å®‰è£…ï¼Œä½¿ç”¨ <code>go get</code>å‘½ä»¤è·å–å³å¯ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ go get github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure><p>æ›´æ–°å°±æ˜¯å¸¸è§„çš„ <code>go get -u</code>ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure><h3 id="å¿«é€Ÿè¿è¡Œ"><a href="#å¿«é€Ÿè¿è¡Œ" class="headerlink" title="å¿«é€Ÿè¿è¡Œ"></a>å¿«é€Ÿè¿è¡Œ</h3><p>åœ¨ä½ çš„ main åŒ…ä¸­ï¼Œå¼•å…¥ gin åŒ…å¹¶åˆå§‹åŒ–ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å¼•æ“</span></span><br><span class="line">    engine := gin.Default()</span><br><span class="line">    <span class="comment">// æ³¨å†Œä¸€ä¸ªè·¯ç”±å’Œå¤„ç†å‡½æ•°</span></span><br><span class="line">    engine.Any(<span class="string">&quot;/&quot;</span>, WebRoot)</span><br><span class="line">    <span class="comment">// ç»‘å®šç«¯å£ï¼Œç„¶åå¯åŠ¨åº”ç”¨</span></span><br><span class="line">    engine.Run(<span class="string">&quot;:9205&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ ¹è¯·æ±‚å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment">* æ‰€æœ‰æœ¬æ¬¡è¯·æ±‚ç›¸å…³çš„æ–¹æ³•éƒ½åœ¨ context ä¸­ï¼Œå®Œç¾</span></span><br><span class="line"><span class="comment">* è¾“å‡ºå“åº” hello, world</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WebRoot</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">    context.String(http.StatusOK, <span class="string">&quot;hello, world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæœ€ç®€å•çš„åº”ç”¨å°±å†™å¥½äº†ï¼Œæ¥è¿è¡Œä¸‹è¯•è¯•:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ go run</span><br><span class="line">[GIN-debug] Listening and serving HTTP on :9205</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://127.0.0.1:9205/">http://127.0.0.1:9205</a> ï¼Œå°±å¯ä»¥å¾—åˆ°å“åº” â€œhello, worldâ€ ã€‚</p><h2 id="è·¯ç”±-Router"><a href="#è·¯ç”±-Router" class="headerlink" title="è·¯ç”± (Router)"></a>è·¯ç”± (Router)</h2><h3 id="Restful-Api"><a href="#Restful-Api" class="headerlink" title="Restful Api"></a>Restful Api</h3><p>ä½ å¯ä»¥æ³¨å†Œè·¯ç”±æ–¹æ³•æœ‰ GET, POST, PUT, PATCH, DELETE å’Œ OPTIONS.</p><p>ä½¿ç”¨å¾ˆç®€å•ï¼Œç›´æ¥è°ƒç”¨åŒåçš„æ–¹æ³•å³å¯ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    router := gin.Default()</span><br><span class="line"></span><br><span class="line">    router.GET(<span class="string">&quot;/someGet&quot;</span>, getting)</span><br><span class="line">    router.POST(<span class="string">&quot;/somePost&quot;</span>, posting)</span><br><span class="line">    router.PUT(<span class="string">&quot;/somePut&quot;</span>, putting)</span><br><span class="line">    router.DELETE(<span class="string">&quot;/someDelete&quot;</span>, deleting)</span><br><span class="line">    router.PATCH(<span class="string">&quot;/somePatch&quot;</span>, patching)</span><br><span class="line">    router.HEAD(<span class="string">&quot;/someHead&quot;</span>, head)</span><br><span class="line">    router.OPTIONS(<span class="string">&quot;/someOptions&quot;</span>, options)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é»˜è®¤ç»‘å®š :8080</span></span><br><span class="line">    router.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€è·¯ç”±ï¼ˆå‚æ•°è·¯ç”±ï¼‰"><a href="#åŠ¨æ€è·¯ç”±ï¼ˆå‚æ•°è·¯ç”±ï¼‰" class="headerlink" title="åŠ¨æ€è·¯ç”±ï¼ˆå‚æ•°è·¯ç”±ï¼‰"></a>åŠ¨æ€è·¯ç”±ï¼ˆå‚æ•°è·¯ç”±ï¼‰</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åŠ¨æ€çš„è·¯ç”±ï¼Œå¦‚ <code>/user/:id</code>ï¼Œé€šè¿‡è°ƒç”¨çš„ url æ¥ä¼ å…¥ä¸åŒçš„ id . åœ¨ Gin ä¸­å¾ˆå®¹æ˜“å¤„ç†è¿™ç§è·¯ç”±ï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    router := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å†Œä¸€ä¸ªåŠ¨æ€è·¯ç”±</span></span><br><span class="line">      <span class="comment">// å¯ä»¥åŒ¹é… /user/leeifme</span></span><br><span class="line">      <span class="comment">// ä¸èƒ½åŒ¹é… /user å’Œ /user/</span></span><br><span class="line">    router.GET(<span class="string">&quot;/user/:name&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ c.Param(key) è·å– url å‚æ•°</span></span><br><span class="line">        name := c.Param(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        c.String(http.StatusOK, <span class="string">&quot;Hello %s&quot;</span>, name)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ³¨å†Œä¸€ä¸ªé«˜çº§çš„åŠ¨æ€è·¯ç”±</span></span><br><span class="line">    <span class="comment">// è¯¥è·¯ç”±ä¼šåŒ¹é… /user/leeifme/ å’Œ /user/leeifme/send</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰ä»»ä½•è·¯ç”±åŒ¹é…åˆ° /user/leeifme, é‚£ä¹ˆä»–å°±ä¼šé‡å®šå‘åˆ° /user/leeifme/ï¼Œä»è€Œè¢«è¯¥æ–¹æ³•åŒ¹é…åˆ°</span></span><br><span class="line">    router.GET(<span class="string">&quot;/user/:name/*action&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        name := c.Param(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        action := c.Param(<span class="string">&quot;action&quot;</span>)</span><br><span class="line">        message := name + <span class="string">&quot; is &quot;</span> + action</span><br><span class="line">        c.String(http.StatusOK, message)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±ç»„"><a href="#è·¯ç”±ç»„" class="headerlink" title="è·¯ç”±ç»„"></a>è·¯ç”±ç»„</h3><p>ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæœ‰ç»Ÿä¸€å‰ç¼€çš„ url çš„éœ€æ±‚ï¼Œå…¸å‹çš„å¦‚ Api æ¥å£ç‰ˆæœ¬å· <code>/v1/something</code>ã€‚Gin å¯ä»¥ä½¿ç”¨ Group æ–¹æ³•ç»Ÿä¸€å½’ç±»åˆ°è·¯ç”±ç»„ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    router := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªç»„å‰ç¼€</span></span><br><span class="line">      <span class="comment">// /v1/login å°±ä¼šåŒ¹é…åˆ°è¿™ä¸ªç»„</span></span><br><span class="line">    v1 := router.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        v1.POST(<span class="string">&quot;/login&quot;</span>, loginEndpoint)</span><br><span class="line">        v1.POST(<span class="string">&quot;/submit&quot;</span>, submitEndpoint)</span><br><span class="line">        v1.POST(<span class="string">&quot;/read&quot;</span>, readEndpoint)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªç»„å‰ç¼€</span></span><br><span class="line">      <span class="comment">// ä¸ç”¨èŠ±æ‹¬å·åŒ…èµ·æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸Šé¢é‚£ç§åªæ˜¯çœ‹èµ·æ¥ä¼šç»Ÿä¸€ä¸€ç‚¹ã€‚çœ‹ä½ ä¸ªäººå–œå¥½</span></span><br><span class="line">    v2 := router.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">    v2.POST(<span class="string">&quot;/login&quot;</span>, loginEndpoint)</span><br><span class="line">    v2.POST(<span class="string">&quot;/submit&quot;</span>, submitEndpoint)</span><br><span class="line">    v2.POST(<span class="string">&quot;/read&quot;</span>, readEndpoint)</span><br><span class="line"></span><br><span class="line">    router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br></pre></td></tr></table></figure><h2 id="ä¸­é—´ä»¶-Middleware"><a href="#ä¸­é—´ä»¶-Middleware" class="headerlink" title="ä¸­é—´ä»¶ (Middleware)"></a>ä¸­é—´ä»¶ (Middleware)</h2><p>golang çš„ net&#x2F;http è®¾è®¡çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯ç‰¹åˆ«å®¹æ˜“æ„å»ºä¸­é—´ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸­é—´ä»¶åªå¯¹æ³¨å†Œè¿‡çš„è·¯ç”±å‡½æ•°èµ·ä½œç”¨ã€‚å¯¹äºåˆ†ç»„è·¯ç”±ï¼ŒåµŒå¥—ä½¿ç”¨ä¸­é—´ä»¶ï¼Œå¯ä»¥é™å®šä¸­é—´ä»¶çš„ä½œç”¨èŒƒå›´ã€‚ä¸­é—´ä»¶åˆ†ä¸ºå…¨å±€ä¸­é—´ä»¶ï¼Œå•ä¸ªè·¯ç”±ä¸­é—´ä»¶å’Œç¾¤ç»„ä¸­é—´ä»¶ã€‚ </p><p>ç°ä»£åŒ–çš„ Web ç¼–ç¨‹ï¼Œä¸­é—´ä»¶å·²ç»æ˜¯å¿…ä¸å¯å°‘çš„äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼ï¼ŒéªŒè¯ Auth å’Œèº«ä»½é‰´åˆ«ï¼Œé›†ä¸­å¤„ç†è¿”å›çš„æ•°æ®ç­‰ç­‰ã€‚Gin æä¾›äº† Middleware çš„åŠŸèƒ½ï¼Œå¹¶ä¸è·¯ç”±ç´§ç´§ç›¸è¿ã€‚</p><h3 id="å•ä¸ªè·¯ç”±ä¸­é—´ä»¶"><a href="#å•ä¸ªè·¯ç”±ä¸­é—´ä»¶" class="headerlink" title="å•ä¸ªè·¯ç”±ä¸­é—´ä»¶"></a>å•ä¸ªè·¯ç”±ä¸­é—´ä»¶</h3><p>å•ä¸ªè·¯ç”±ä½¿ç”¨ä¸­é—´ä»¶ï¼Œåªéœ€è¦åœ¨æ³¨å†Œè·¯ç”±çš„æ—¶å€™æŒ‡å®šè¦æ‰§è¡Œçš„ä¸­é—´ä»¶å³å¯ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    router := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å†Œä¸€ä¸ªè·¯ç”±ï¼Œä½¿ç”¨äº† middleware1ï¼Œmiddleware2 ä¸¤ä¸ªä¸­é—´ä»¶</span></span><br><span class="line">    router.GET(<span class="string">&quot;/someGet&quot;</span>, middleware1, middleware2, handler)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// é»˜è®¤ç»‘å®š :8080</span></span><br><span class="line">    router.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">&quot;exec handler&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œæµç¨‹æ§åˆ¶"><a href="#æ‰§è¡Œæµç¨‹æ§åˆ¶" class="headerlink" title="æ‰§è¡Œæµç¨‹æ§åˆ¶"></a>æ‰§è¡Œæµç¨‹æ§åˆ¶</h3><p>ç”¨ä¸Šé¢çš„å®ä¾‹ä»£ç ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸­é—´ä»¶æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">&quot;exec middleware1&quot;</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//ä½ å¯ä»¥å†™ä¸€äº›é€»è¾‘ä»£ç </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ‰§è¡Œè¯¥ä¸­é—´ä»¶ä¹‹åçš„é€»è¾‘</span></span><br><span class="line">    c.Next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œä¸­é—´ä»¶çš„å†™æ³•å’Œè·¯ç”±çš„ Handler å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å¤šè°ƒç”¨ <code>c.Next()</code>ã€‚</p><p>æ­£æ˜¯æœ‰ä¸ª<code>c.Next()</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸­é—´ä»¶ä¸­æ§åˆ¶è°ƒç”¨é€»è¾‘çš„å˜åŒ–ï¼Œçœ‹ä¸‹é¢çš„ <code>middleware2</code> ä»£ç ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware2</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">&quot;arrive at middleware2&quot;</span>)</span><br><span class="line">    <span class="comment">// æ‰§è¡Œè¯¥ä¸­é—´ä»¶ä¹‹å‰ï¼Œå…ˆè·³åˆ°æµç¨‹çš„ä¸‹ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">    c.Next()</span><br><span class="line">    <span class="comment">// æµç¨‹ä¸­çš„å…¶ä»–é€»è¾‘å·²ç»æ‰§è¡Œå®Œäº†</span></span><br><span class="line">    log.Println(<span class="string">&quot;exec middleware2&quot;</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//ä½ å¯ä»¥å†™ä¸€äº›é€»è¾‘ä»£ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>middleware2</code>ä¸­ï¼Œæ‰§è¡Œåˆ° <code>c.Next()</code>æ—¶ï¼ŒGin ä¼šç›´æ¥è·³åˆ°æµç¨‹çš„ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œç­‰åˆ°è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œåï¼Œæ‰ä¼šå›æ¥æ¥ç€æ‰§è¡Œ <code>middleware2</code> å‰©ä¸‹çš„ä»£ç ã€‚</p><p>æ‰€ä»¥è¯·æ±‚ä¸Šé¢æ³¨å†Œçš„è·¯ç”± url <code>/someGet</code> ï¼Œè¯·æ±‚å…ˆåˆ°è¾¾<code>middleware1</code>ï¼Œç„¶ååˆ°è¾¾ <code>middleware2</code>ï¼Œä½†æ­¤æ—¶ <code>middleware2</code>è°ƒç”¨äº† <code>c.Next()</code>ï¼Œæ‰€ä»¥ <code>middleware2</code>çš„ä»£ç å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œè€Œæ˜¯è·³åˆ°äº† <code>handler</code>ï¼Œç­‰ <code>handler</code>æ‰§è¡Œå®Œæˆåï¼Œè·³å›åˆ° <code>middleware2</code>ï¼Œæ‰§è¡Œ <code>middleware2</code>å‰©ä¸‹çš„ä»£ç ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¾“å‡º:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exec</span> middleware1</span><br><span class="line">arrive at middleware2</span><br><span class="line"><span class="built_in">exec</span> handler</span><br><span class="line"><span class="built_in">exec</span> middleware2</span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±ç»„ä½¿ç”¨ä¸­é—´ä»¶"><a href="#è·¯ç”±ç»„ä½¿ç”¨ä¸­é—´ä»¶" class="headerlink" title="è·¯ç”±ç»„ä½¿ç”¨ä¸­é—´ä»¶"></a>è·¯ç”±ç»„ä½¿ç”¨ä¸­é—´ä»¶</h3><p>è·¯ç”±ç»„ä½¿ç”¨ä¸­é—´ä»¶å’Œå•ä¸ªè·¯ç”±ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯è¦æŠŠä¸­é—´ä»¶æ”¾åˆ° <code>Group</code> ä¸Š.</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    router := gin.Default()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªç»„å‰ç¼€, å¹¶ä½¿ç”¨ middleware1 ä¸­é—´ä»¶</span></span><br><span class="line">      <span class="comment">// è®¿é—® /v2/login å°±ä¼šæ‰§è¡Œ middleware1 å‡½æ•°</span></span><br><span class="line">    v2 := router.Group(<span class="string">&quot;/v2&quot;</span>, middleware1)</span><br><span class="line">    v2.POST(<span class="string">&quot;/login&quot;</span>, loginEndpoint)</span><br><span class="line">    v2.POST(<span class="string">&quot;/submit&quot;</span>, submitEndpoint)</span><br><span class="line">    v2.POST(<span class="string">&quot;/read&quot;</span>, readEndpoint)</span><br><span class="line"></span><br><span class="line">    router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœç•¥çš„ä»£ç  ...</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Gin-çš„ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#Gin-çš„ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;Gin çš„ä½¿ç”¨&quot;&gt;&lt;/a&gt;Gin çš„ä½¿ç”¨&lt;/h2&gt;&lt;h3 id=&quot;å®‰è£…å’Œæ›´æ–°&quot;&gt;&lt;a href=&quot;#å®‰è£…å’Œæ›´æ–°&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    <category term="æŠ€æœ¯åŠ æ²¹ç«™" scheme="https://liei.cc/blog/categories/%E6%8A%80%E6%9C%AF%E5%8A%A0%E6%B2%B9%E7%AB%99/"/>
    
    
    <category term="Go" scheme="https://liei.cc/blog/tags/go/"/>
    
  </entry>
  
</feed>
