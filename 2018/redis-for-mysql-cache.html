<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 6.3.0"><meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.17.2"><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://fastly.jsdelivr.net"><link rel="preconnect" href="https://fastly.jsdelivr.net" crossorigin><link rel="dns-prefetch" href="//unpkg.com"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#f8f8f8"><title>åˆå­¦ Redis ä½œç¼“å­˜å±‚ - LLIEI0X</title><meta name="description" content="é¡¹ç›®éœ€æ±‚ï¼šæ•°æ®åº“ç”¨çš„æ˜¯MySQLï¼Œè€ƒè™‘ç”¨Redis&#x2F;memcachedåšæ•°æ®åº“çš„ç¼“å­˜å±‚ã€‚åœ¨è¯»DBå‰ï¼Œå…ˆè¯»ç¼“å­˜å±‚ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å†è¯»DBï¼Œç„¶åå†™å…¥ç¼“å­˜å±‚å¹¶è¿”å›ã€‚  æ€è·¯ï¼š###ç¼“å­˜è¯»å–æµç¨‹  å…ˆåˆ°ç¼“å­˜ä¸­æŸ¥æ•°æ®                          ç¼“å­˜ä¸­ä¸å­˜åœ¨åˆ™åˆ°å®é™…æ•°æ®æºä¸­å–ï¼Œå–å‡ºæ¥åæ”¾å…¥ç¼“å­˜                      ä¸‹æ¬¡å†æ¥å–åŒæ ·ä¿¡æ¯æ—¶åˆ™å¯ç›´æ¥"><meta property="og:type" content="article"><meta property="og:title" content="åˆå­¦ Redis ä½œç¼“å­˜å±‚"><meta property="og:url" content="https://liei.cc/2018/redis-for-mysql-cache.html"><meta property="og:site_name" content="LLIEI0X"><meta property="og:description" content="é¡¹ç›®éœ€æ±‚ï¼šæ•°æ®åº“ç”¨çš„æ˜¯MySQLï¼Œè€ƒè™‘ç”¨Redis&#x2F;memcachedåšæ•°æ®åº“çš„ç¼“å­˜å±‚ã€‚åœ¨è¯»DBå‰ï¼Œå…ˆè¯»ç¼“å­˜å±‚ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å†è¯»DBï¼Œç„¶åå†™å…¥ç¼“å­˜å±‚å¹¶è¿”å›ã€‚  æ€è·¯ï¼š###ç¼“å­˜è¯»å–æµç¨‹  å…ˆåˆ°ç¼“å­˜ä¸­æŸ¥æ•°æ®                          ç¼“å­˜ä¸­ä¸å­˜åœ¨åˆ™åˆ°å®é™…æ•°æ®æºä¸­å–ï¼Œå–å‡ºæ¥åæ”¾å…¥ç¼“å­˜                      ä¸‹æ¬¡å†æ¥å–åŒæ ·ä¿¡æ¯æ—¶åˆ™å¯ç›´æ¥"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2018-05-15T23:32:45.000Z"><meta property="article:modified_time" content="2018-05-15T23:32:45.000Z"><meta property="article:author" content="lliei0x"><meta property="article:tag" content="Go"><meta property="article:tag" content="Redis"><meta name="twitter:card" content="summary"><link rel="alternate" href="/atom.xml" title="LLIEI0X" type="application/atom+xml"><link rel="stylesheet" href="/css/main.css"><link rel="shortcut icon" href="https://leeifme.oss-cn-shanghai.aliyuncs.com/blog/2021/20220614145243.ico"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.6.0/lxgwwenkaiscreen.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/fontsource-jetbrains-mono@4.0.0/500.css"></head><body><div class="l_body" id="start"><aside class="l_left" layout="post"><header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.2/avatar/round/rainbow64@3x.webp)"></div><img no-lazy class="avatar" src="https://s2.loli.net/2022/12/01/haMivpAzGlRnYEr.jpg" onerror="javascript:this.classList.add('error');this.src='https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">LLIEI0X</div><div class="sub normal cap">â˜” slow to respond</div><div class="sub hover cap" style="opacity:0">ğŸŒµ Live long and prosper</div></a></div><nav class="menu dis-select"><a class="nav-item active" href="/">æ–‡ç« </a><a class="nav-item" href="/wiki/">ä¸“æ </a><a class="nav-item" href="/notes/">ç¬”è®°</a><a class="nav-item" href="/more/">æ›´å¤š</a></nav></header><div class="widgets"><widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" placeholder="ç«™å†…æ£€ç´¢"></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div></div></widget><widget class="widget-wrapper toc single" id="toc"><div class="widget-header cap dis-select"><span class="name">åˆå­¦ Redis ä½œç¼“å­˜å±‚</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="toc-text">æ€è·¯ï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E7%BC%93%E5%AD%98%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-text">åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%81%9A%E5%A4%84%E7%90%86"><span class="toc-text">å¯¹æ•°æ®åšå¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-text">æ€è€ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E7%AB%8B%E5%88%BB%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98"><span class="toc-text">å†™å…¥æ•°æ®æ˜¯å¦ç«‹åˆ»æ›´æ–°ç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96-Set-%E5%92%8C-SortedSet-%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98"><span class="toc-text">è¯»å– Set å’Œ SortedSet æ•°æ®ç¼“å­˜å¤±æ•ˆé—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD-Redis-%E5%81%9A%E7%BC%93%E5%AD%98"><span class="toc-text">åœ¨é¡¹ç›®ä¸­ Redis åšç¼“å­˜</span></a></li></ol></li></ol></div></div></widget></div><footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/lliei" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.svgporn.com/logos/numpy.svg"></a><a class="social" href="https://t.me/lliei0x" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.svgporn.com/logos/mps-icon.svg"></a><a class="social" href="https://twitter.com/lliei0x" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.svgporn.com/logos/msw-icon.svg"></a><a class="social" href="mailto:i@liei.cc" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.svgporn.com/logos/modx-icon.svg"></a><a class="social" href="/more/#comments" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.svgporn.com/logos/storyblok-icon.svg"></a></div></footer></aside><div class="l_main"><div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a><span class="sep"></span><a class="cap breadcrumb" href="/">æ–‡ç« </a><span class="sep"></span><a class="cap breadcrumb-link" href="/blog/categories/%E6%8A%80%E6%9C%AF%E5%8A%A0%E6%B2%B9%E7%AB%99/">æŠ€æœ¯åŠ æ²¹ç«™</a></div><div id="post-meta">å‘å¸ƒäº&nbsp;<time datetime="2018-05-15T23:32:45.000Z">2018å¹´5æœˆ15æ—¥</time></div></div><article class="md-text content post"><h1 class="article-title"><span>åˆå­¦ Redis ä½œç¼“å­˜å±‚</span></h1><blockquote><p>é¡¹ç›®éœ€æ±‚ï¼šæ•°æ®åº“ç”¨çš„æ˜¯MySQLï¼Œè€ƒè™‘ç”¨Redis&#x2F;memcachedåšæ•°æ®åº“çš„ç¼“å­˜å±‚ã€‚åœ¨è¯»DBå‰ï¼Œå…ˆè¯»ç¼“å­˜å±‚ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å†è¯»DBï¼Œç„¶åå†™å…¥ç¼“å­˜å±‚å¹¶è¿”å›ã€‚</p></blockquote><h2 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h2><p>###ç¼“å­˜è¯»å–æµç¨‹</p><ol><li>å…ˆåˆ°ç¼“å­˜ä¸­æŸ¥æ•°æ®</li><li>ç¼“å­˜ä¸­ä¸å­˜åœ¨åˆ™åˆ°å®é™…æ•°æ®æºä¸­å–ï¼Œå–å‡ºæ¥åæ”¾å…¥ç¼“å­˜</li><li>ä¸‹æ¬¡å†æ¥å–åŒæ ·ä¿¡æ¯æ—¶åˆ™å¯ç›´æ¥ä»ç¼“å­˜ä¸­è·å–</li></ol><p>###ç¼“å­˜æ›´æ–°æµç¨‹</p><ol><li>æ›´æ–°æ•°æ®åº“</li><li>ä½¿ç¼“å­˜è¿‡æœŸæˆ–å¤±æ•ˆï¼Œè¿™æ ·ä¼šä¿ƒä½¿ä¸‹æ¬¡æŸ¥è¯¢æ•°æ®æ—¶åœ¨ç¼“å­˜ä¸­æŸ¥ä¸åˆ°è€Œé‡æ–°ä»æ•°æ®åº“å»ä¸€æ¬¡ã€‚</li></ol><p>###é€šç”¨ç¼“å­˜æœºåˆ¶</p><ol><li>ç”¨æŸ¥è¯¢çš„æ–¹æ³•å + å‚æ•°ä½œä¸ºæŸ¥è¯¢æ—¶çš„ key value å¯¹ä¸­çš„ key å€¼</li><li>å‘ memcache æˆ– redis ä¹‹ç±»çš„ nosql æ•°æ®åº“ï¼ˆæˆ–è€…å†…å­˜ hashmapï¼‰æ’å…¥æ•°æ®3ã€å–æ•°æ®æ—¶ä¹Ÿç”¨æ–¹æ³•å + å‚æ•°ä½œä¸º key å‘ç¼“å­˜æ•°æ®æºè·å–ä¿¡æ¯ã€‚</li></ol><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><h3 id="åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">dataList, err := dataRedis.Get(CacheKey).Result()</span><br><span class="line"><span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">    <span class="comment">// ä¸å­˜åœ¨redis key</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Errorf(<span class="string">&quot;Get cache err, cache_key: %s, error: %s&quot;</span>, CacheKey, err)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜å€¼ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> dataList == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>, <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> dataList, <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="å¯¹æ•°æ®åšå¤„ç†"><a href="#å¯¹æ•°æ®åšå¤„ç†" class="headerlink" title="å¯¹æ•°æ®åšå¤„ç†"></a>å¯¹æ•°æ®åšå¤„ç†</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">CacheKey := <span class="string">&quot;key&quot;</span></span><br><span class="line">Data, isTrue := isGetDataCache(CacheKey)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isTrue &#123;</span><br><span class="line">    <span class="comment">// ä»`redis`ä¸­è·å–æ•°æ®ç›´æ¥è¿”å›</span></span><br><span class="line">    err := json.Unmarshal([]<span class="type">byte</span>(Data), &amp;dataList)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Errorf(<span class="string">&quot;Json unmarshal datalist err:%s&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span> dataList</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ä»dbä¸­è·å–æ•°æ®</span></span><br><span class="line">    dataList = GetDataWhere(<span class="string">&quot;`deleted`=0 order by sort limit ? offset ?&quot;</span>, limit, offset)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°redisç¼“å­˜</span></span><br><span class="line">    err := dataRedis.Set(CacheKey, xutil.ToJSONString(dataList), <span class="number">1</span>*time.Minute).Err()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Errorf(<span class="string">&quot;Set rediscache error:%s&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span> dataList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dataList</span><br></pre></td></tr></table></figure><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><h3 id="å†™å…¥æ•°æ®æ˜¯å¦ç«‹åˆ»æ›´æ–°ç¼“å­˜"><a href="#å†™å…¥æ•°æ®æ˜¯å¦ç«‹åˆ»æ›´æ–°ç¼“å­˜" class="headerlink" title="å†™å…¥æ•°æ®æ˜¯å¦ç«‹åˆ»æ›´æ–°ç¼“å­˜"></a>å†™å…¥æ•°æ®æ˜¯å¦ç«‹åˆ»æ›´æ–°ç¼“å­˜</h3><p>å¦‚æœéœ€è¦ç«‹åˆ»æ›´æ–°ç¼“å­˜çš„è¯ï¼Œä½¿ç”¨ findAndModify è·å–æœ€æ–°ç»“æœå¹¶è®¾ç½®è¿›ç¼“å­˜ä¸­ï¼Œä½†è¿™å¸¦æ¥äº†ä¸€ä¸ªå¼Šç«¯ï¼Œæœ‰äº›å¹¶ä¸æ˜¯çƒ­æ•°æ®ï¼Œè¿™æ—¶å€™æ”¾è¿›äº† redis ä¼šå¯¼è‡´å ç”¨å†…å­˜ï¼Œå¦‚æœè®¾ç½®è¿‡å¿«ï¼Œredis å†…å­˜çš„ä½¿ç”¨é‡å¢é•¿å¾—éå¸¸å¿«ï¼›å¥½å¤„éœ€è¦ä¸å¦ä¸€ç§æ–¹å¼å¯¹æ¯”æ‰æ˜æ˜¾ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯å†™å…¥æ•°æ®åç«‹åˆ»åˆ æ‰è¯¥ç¼“å­˜ï¼Œç­‰å¾…æœ‰éœ€è¦æ‰å†åŠ è½½ç¼“å­˜ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ redis å ç”¨ç¼“å­˜ä¸ä¼šè¿‡é«˜ï¼Œæ€»æ˜¯ä¿ç•™ç€çƒ­æ•°æ®ï¼Œå¼Šç«¯å°±æ˜¯åŠ è½½ç¼“å­˜è¯»å–ä»åº“çš„æ•°æ®è¿˜æ˜¯æœªåŒæ­¥çš„ï¼Œè¿™æ ·å¯¼è‡´è„æ•°æ®ï¼Œæ‰€ä»¥å‰è€…çš„ç›´æ¥æ›´æ–°ä¿è¯äº†ä¸ä¼šæ˜¯è„æ•°æ®ã€‚è‡³äºé‡‡å–é‚£ç§æ–¹å¼ï¼Œè¦çœ‹ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æœä¸éœ€è¦æœ€æ–°çš„æ•°æ®ï¼Œæœ€æ–¹ä¾¿æ˜¯åˆ é™¤æ‰è¯¥ç¼“å­˜å°±å¯ä»¥äº†ï¼Œå¦åˆ™å°±éœ€è¦ç«‹åˆ»æ›´æ–°ç¼“å­˜æ•°æ®ï¼Œå¦‚æœé”®æ•°é‡ç‰¹åˆ«å¤šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´çŸ­ä¸€äº›ï¼Œå°½å¿«é‡Šæ”¾ redis çš„å†…å­˜å ç”¨ã€‚</p><h3 id="è¯»å–-Set-å’Œ-SortedSet-æ•°æ®ç¼“å­˜å¤±æ•ˆé—®é¢˜"><a href="#è¯»å–-Set-å’Œ-SortedSet-æ•°æ®ç¼“å­˜å¤±æ•ˆé—®é¢˜" class="headerlink" title="è¯»å– Set å’Œ SortedSet æ•°æ®ç¼“å­˜å¤±æ•ˆé—®é¢˜"></a>è¯»å– Set å’Œ SortedSet æ•°æ®ç¼“å­˜å¤±æ•ˆé—®é¢˜</h3><p>è¿™ç§å¤§æ•°æ®é›†åˆï¼Œæ— æ³•å•ä¸ªæ“ä½œå°±å¯ä»¥åˆ¤æ–­å…¶ key å­˜åœ¨è¿˜æ˜¯è¯¥ key æ˜¯å¦æœ‰å€¼ã€‚é€šå¸¸éœ€è¦ä¸¤ä¸ªæ“ä½œï¼šåŠ è½½å’Œè·å–éœ€è¦çš„æ•°æ®ã€‚é—®é¢˜å°±å‡ºç°åœ¨åŠ è½½å’Œè·å–çš„é—´éš™ä¸­ï¼Œè¿™ä¸ªé—´éš™ç¼“å­˜åˆšå¥½è¿‡æœŸï¼Œå°±ä¼šå‡ºç°æ•°æ®é”™è¯¯çš„åæœï¼Œæˆ‘è§‰å¾—æœ€ä½³å®è·µæ˜¯è¿™æ ·: ä¿è¯åœ¨æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿™äº›æ•°æ®é›†åˆä¸ä¼šç¼“å­˜è¿‡æœŸã€‚åƒæˆ‘ä»¬ä½¿ç”¨æ’è¡Œæ¦œçš„æ—¶å€™ç”¨åˆ°å¤§é‡äº† SortedSetï¼Œå½“æ—¶è®¾ç½®äº† 1 å¤©å°±è¿‡æœŸï¼Œè¿™æ ·å¯¼è‡´å‡ºç°æ’è¡Œæ¦œæ•°æ®å‡ºç°ä¸å…¨çš„é—®é¢˜ã€‚åˆå¦‚ Set ä¿å­˜ç€æ¯”èµ›åå•çš„æ•°æ®ï¼Œå‘ç° key æ˜¯å­˜åœ¨ï¼Œä¸å†åŠ è½½æ•°æ®ï¼Œå‡†å¤‡åˆ¤æ–­æŸä¸ªé¡¹æ˜¯å¦å­˜åœ¨è¯¥ set çš„æ—¶å€™ï¼Œè¿™ä¸ª set å°±è¿‡æœŸäº†ï¼Œç”¨sismemberå°±ä¼šè¿”å›Falseï¼Œå°±æ— æ³•åˆ¤æ–­è¿™ä¸ª False çš„æ„æ€æ˜¯è¯¥æ•°æ®é¡¹ä¸å­˜åœ¨è¯¥ set é‡Œé¢è¿˜æ˜¯è¯¥ set çš„ key å·²ç»è¿‡æœŸäº†ã€‚</p><h3 id="åœ¨é¡¹ç›®ä¸­-Redis-åšç¼“å­˜"><a href="#åœ¨é¡¹ç›®ä¸­-Redis-åšç¼“å­˜" class="headerlink" title="åœ¨é¡¹ç›®ä¸­ Redis åšç¼“å­˜"></a>åœ¨é¡¹ç›®ä¸­ Redis åšç¼“å­˜</h3><ul><li>é¦–å…ˆï¼Œå¯¹äºæ•°æ®ç¼“å­˜ä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½ç¼“å­˜åˆ° redis å°±æ˜¯å¥½çš„ï¼Œè€Œæ˜¯è¦é’ˆå¯¹ä¸€äº›æ”¹åŠ¨ä¸å¤§æˆ–è€…è®¿é—®ç‡å¤§çš„æ•°æ®è¿›è¡Œç¼“å­˜æ¥å‡å°‘å…³ç³»å‹æ•°æ®åº“çš„å‹åŠ›ã€‚</li><li>redis ä½œä¸ºç¼“å­˜ä½¿ç”¨ï¼Œä¸ä½œæ•°æ®åº“ç”¨é€”ï¼Œéµå¾ªä»¥ä¸‹è§„åˆ™ï¼šå¦‚æœç¼“å­˜æ²¡æœ‰æ•°æ®ï¼Œå³åŠ è½½æ•°æ®åˆ°ç¼“å­˜ï¼Œå¹¶ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</li><li>å‡¡æ˜¯å¯ä»¥ç”¨ String ä¿å­˜çš„ï¼Œå°½é‡å°†æ•°æ®ç”¨json.dumpsä¹‹åå†æ”¾è¿› Stringï¼Œå¦‚æœéœ€è¦ Set å’Œ SortedSet å°±éœ€è¦è­¦æƒ•ç¼“å­˜ key åˆšå¥½è¿‡æœŸæ—¶å€™ï¼Œä¼šæœ‰ä¸€å®šè¯»å–é”™è¯¯çš„é—®é¢˜ï¼Œè¿™ä¸ªæ— æ³•é¿å…ã€‚</li><li>å¯¹äºä¸€äº›ä¸åˆ†é¡µï¼Œä¸éœ€è¦å®æ—¶ï¼ˆéœ€è¦å¤šè¡¨æŸ¥è¯¢ï¼‰çš„åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ—è¡¨ç»“æœç¼“å­˜åˆ° redis ä¸­ï¼Œè®¾å®šä¸€å®šç¼“å­˜æ—¶é—´ä½œä¸ºè¯¥æ•°æ®çš„å­˜æ´»æ—¶é—´ã€‚ç”¨è·å–è¯¥åˆ—è¡¨çš„æ–¹æ³•åä½œä¸º keyï¼Œåˆ—è¡¨ç»“æœä¸º valueï¼›è¿™ç§æƒ…å†µåªè¯•ç”¨äºä¸ç»å¸¸æ›´æ–°ä¸”ä¸éœ€è¦å®æ—¶çš„æƒ…å†µä¸‹ã€‚</li><li>ä¸éœ€è¦å®æ—¶çš„ï¼Œéœ€è¦åˆ†é¡µçš„åˆ—è¡¨ï¼šå¯ä»¥æŠŠåˆ†é¡µçš„ç»“æœåˆ—è¡¨æ”¾åˆ°ä¸€ä¸ª mapï¼ˆkey ä¸ºåˆ†é¡µæ ‡è¯†ï¼Œvalue ä¸ºåˆ†é¡µç»“æœï¼‰ä¸­ï¼Œç„¶åå°†è¯¥ map å­˜åˆ° redis çš„ list ä¸­ï¼ˆç”¨è¯¥æ–¹æ³•åä¸º keyï¼‰ã€‚ç„¶åç»™è¯¥ list è®¾ç½®ä¸€ä¸ªç¼“å­˜å­˜æ´»æ—¶é—´ï¼ˆç”¨ expireï¼‰ã€‚è¿™æ ·é€šè¿‡æ–¹æ³•å lrange å‡ºæ¥å°±èƒ½è·å–å­˜æœ‰åˆ†é¡µåˆ—è¡¨çš„æ•°æ®ï¼Œéå†è¯¥ listï¼Œé€šè¿‡éå† list ä¸­ map çš„ key åˆ¤æ–­è¯¥åˆ†é¡µæ•°æ®æ˜¯å¦åœ¨ç¼“å­˜å†…ï¼Œæ˜¯åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™ rpush è¿›å»ã€‚è¿™ç§åšæ³•èƒ½è§£å†³æ¯”å¦‚ 1-5 é¡µçš„æ•°æ®å·²ç»é‡æ–°åŠ è½½ï¼Œè€Œ 6-10 é¡µçš„æ•°æ®ä¾ç„¶æ˜¯ç¼“å­˜çš„æ•°æ®è€Œå¯¼è‡´è„æ•°æ®çš„æƒ…å†µã€‚</li></ul><div class="article-footer reveal fs14"><section id="license"><div class="header"><span>è®¸å¯åè®®</span></div><div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></div></section><section id="share"><div class="header"><span>åˆ†äº«æ–‡ç« </span></div><div class="body"><div class="link"><input class="copy-area" readonly id="copy-link" value="https://liei.cc/2018/redis-for-mysql-cache.html"></div><div class="social-wrap dis-select"><a class="social share-item wechat" onclick="util.toggle(&quot;qrcode-wechat&quot)"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/social/b32ef3da1162a.svg"></a><a class="social share-item weibo" target="_blank" rel="external nofollow noopener noreferrer" href="https://service.weibo.com/share/share.php?url=https://liei.cc/2018/redis-for-mysql-cache.html&title=åˆå­¦ Redis ä½œç¼“å­˜å±‚ - LLIEI0X&summary=
é¡¹ç›®éœ€æ±‚ï¼šæ•°æ®åº“ç”¨çš„æ˜¯MySQLï¼Œè€ƒè™‘ç”¨Redis&#x2F;memcachedåšæ•°æ®åº“çš„ç¼“å­˜å±‚ã€‚åœ¨è¯»DBå‰ï¼Œå…ˆè¯»ç¼“å­˜å±‚ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å†è¯»DBï¼Œç„¶åå†™å…¥ç¼“å­˜å±‚å¹¶è¿”å›ã€‚

æ€è·¯ï¼š###ç¼“å­˜è¯»å–æµç¨‹

å…ˆåˆ°ç¼“å­˜ä¸­æŸ¥æ•°æ®   ..."><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/social/80c07e4dbb303.svg"></a><a class="social share-item email" href="mailto:?subject=åˆå­¦ Redis ä½œç¼“å­˜å±‚ - LLIEI0X&amp;body=https://liei.cc/2018/redis-for-mysql-cache.html"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/social/a1b00e20f425d.svg"></a><a class="social share-item link" onclick="util.copy(&quot;copy-link&quot;, &quot;å¤åˆ¶æˆåŠŸ&quot;)"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/social/8411ed322ced6.svg"></a></div><div class="qrcode" id="qrcode-wechat" style="visibility:hidden;height:0"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=https://liei.cc/2018/redis-for-mysql-cache.html"></div></div></section></div></article><div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">è¾ƒæ–°æ–‡ç« </div><a href="/2018/docker-common-command%20.html">Docker å¸¸ç”¨å‘½ä»¤è®°å½•</a></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2018/babun-windows-tool.html">Windows åˆ©å™¨ - babun</a></div></section></div><div class="related-wrap reveal" id="related-posts"><section class="header"><div class="title cap theme">æ‚¨å¯èƒ½æ„Ÿå…´è¶£çš„æ–‡ç« </div></section><section class="body"><div class="related-posts"><a class="item" href="/2018/gin-go-web-frame.html" title="é«˜æ€§èƒ½çš„ Go Web æ¡†æ¶ - gin"><span class="title">é«˜æ€§èƒ½çš„ Go Web æ¡†æ¶ - gin</span></a><a class="item" href="/2018/gin-swagger-build-document.html" title="gin-swagger è‡ªåŠ¨åŒ–æ„å»º API æ–‡æ¡£"><span class="title">gin-swagger è‡ªåŠ¨åŒ–æ„å»º API æ–‡æ¡£</span></a><a class="item" href="/2019/go-channel-select.html" title="Select -- æ— é˜»å¡è¯»å†™ channel"><span class="title">Select -- æ— é˜»å¡è¯»å†™ channel</span></a><a class="item" href="/2019/go-concurrent-model.html" title="Go å¹¶å‘æ¨¡å‹"><span class="title">Go å¹¶å‘æ¨¡å‹</span></a><a class="item" href="/2018/docker-common-command .html" title="Docker å¸¸ç”¨å‘½ä»¤è®°å½•"><span class="title">Docker å¸¸ç”¨å‘½ä»¤è®°å½•</span></a></div></section></div><div class="related-wrap md-text reveal" id="comments"><div class="cmt-title cap theme">å¿«æ¥å‚ä¸è®¨è®ºå§</div><div class="cmt-body giscus"><svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg><div id="giscus" data-repo="lliei/lliei.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk4OTQ2MTcwNQ==" data-category="Announcements" data-category-id="DIC_kwDOBVUTyc4CS3i-" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="dark_tritanopia" data-lang="en" data-loading="lazy" crossorigin="anonymous"></div></div></div><footer class="page-footer reveal fs12"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs14">åšå®¢</span><a href="/">è¿‘æœŸ</a><a href="/blog/categories/">åˆ†ç±»</a><a href="/blog/tags/">æ ‡ç­¾</a><a href="/blog/archives/">å½’æ¡£</a></div><div class="sitemap-group"><span class="fs14">é¡¹ç›®</span><a href="/wiki/">ä¸“æ </a><a href="/notes/">ç¬”è®°</a></div><div class="sitemap-group"><span class="fs14">ç¤¾äº¤</span><a href="/">å‹é“¾</a><a href="/about/">ç•™è¨€æ¿</a><a target="_blank" rel="noopener" href="https://twitter.com/leeifme">Twitter</a><a target="_blank" rel="noopener" href="https://t.me/leeifme">Telegrem</a></div><div class="sitemap-group"><span class="fs14">æ›´å¤š</span><a href="/about/">å…³äºæœ¬ç«™</a><a target="_blank" rel="noopener" href="https://github.com/leeifme">GitHub</a></div></div><div class="text"><p>æœ¬ç«™ç”± <a href="/">@anonymity</a> ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> ä¸»é¢˜åˆ›å»ºã€‚<br>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></div></footer><div class="float-panel mobile-only blur" style="display:none"><button type="button" class="sidebar-toggle mobile" onclick="sidebar.toggle()"><svg class="icon" style="width:1em;height:1em;vertical-align:middle;fill:currentColor;overflow:hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg></button></div></div></div><div class="scripts"><script type="text/javascript">if(stellar={loadCSS:(e,s,t,n)=>{var l,a=window.document,i=a.createElement("link");if(s)l=s;else{var r=(a.body||a.getElementsByTagName("head")[0]).childNodes;l=r[r.length-1]}var o=a.styleSheets;if(n)for(var c in n)n.hasOwnProperty(c)&&i.setAttribute(c,n[c]);i.rel="stylesheet",i.href=e,i.media="only x",function e(s){if(a.body)return s();setTimeout((function(){e(s)}))}((function(){l.parentNode.insertBefore(i,s?l:l.nextSibling)}));var d=function(e){for(var s=i.href,t=o.length;t--;)if(o[t].href===s)return e();setTimeout((function(){d(e)}))};function p(){i.addEventListener&&i.removeEventListener("load",p),i.media=t||"all"}return i.addEventListener&&i.addEventListener("load",p),i.onloadcssdefined=d,d(p),i},loadScript:(e,s)=>new Promise((t,n)=>{var l=document.createElement("script");if(l.src=e,s)for(let e of Object.keys(s))l[e]=s[e];else l.async=!0;l.onerror=n,l.onload=l.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(l.onload=l.onreadystatechange=null,t())},document.head.appendChild(l)}),jQuery:e=>{"undefined"==typeof jQuery?stellar.loadScript(stellar.plugins.jQuery).then(e):e()}},stellar.version="1.17.2",stellar.github="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.17.2",stellar.config={date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"}},stellar.plugins={jQuery:"https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"},stellar.search={},stellar.search.service="local_search","local_search"==stellar.search.service){let e=Object.assign({},{field:"all",path:"/search.json",content:!0,codeblock:!0,sort:"-date"});stellar.search[stellar.search.service]=e}stellar.plugins.stellar=Object.assign({sites:"/js/plugins/sites.js",friends:"/js/plugins/friends.js",ghinfo:"/js/plugins/ghinfo.js",timeline:"/js/plugins/timeline.js",linkcard:"/js/plugins/linkcard.js",fcircle:"/js/plugins/fcircle.js",weibo:"/js/plugins/weibo.js"}),stellar.plugins.marked=Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js"),stellar.plugins.lazyload=Object.assign({enable:!0,js:"https://fastly.jsdelivr.net/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js",transition:"blur"}),stellar.plugins.swiper=Object.assign({enable:!0,css:"https://unpkg.com/swiper@6/swiper-bundle.min.css",js:"https://unpkg.com/swiper@6/swiper-bundle.min.js"}),stellar.plugins.preload=Object.assign({enable:!0,service:"flying_pages",instant_page:"https://fastly.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js",flying_pages:"https://fastly.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"}),stellar.plugins.fancybox=Object.assign({enable:!0,js:"https://fastly.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js",css:"https://fastly.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css",selector:".swiper-slide img"})</script><script src="/js/main.js" async></script><script>function loadJS(){const e=document.querySelectorAll("#comments #giscus");0!==e.length&&e.forEach((e,t)=>{try{e.innerHTML=""}catch(e){console.log(e)}var n=document.createElement("script");n.src="https://giscus.app/client.js",n.async=!0;for(let t of Object.keys(e.attributes)){let c=e.attributes[t];!1===["class","id"].includes(c.name)&&n.setAttribute(c.name,c.value)}e.appendChild(n)})}window.addEventListener("DOMContentLoaded",e=>{loadJS()})</script></div></body></html>